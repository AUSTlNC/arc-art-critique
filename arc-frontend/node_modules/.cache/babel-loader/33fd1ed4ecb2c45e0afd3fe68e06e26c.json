{"ast":null,"code":"/*!\n * FilePondPluginImagePreview 4.6.10\n * Licensed under MIT, https://opensource.org/licenses/MIT/\n * Please visit https://pqina.nl/filepond/ for details.\n */\n\n/* eslint-disable */\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() : typeof define === 'function' && define.amd ? define(factory) : (global = global || self, global.FilePondPluginImagePreview = factory());\n})(this, function () {\n  'use strict'; // test if file is of type image and can be viewed in canvas\n\n  var isPreviewableImage = function isPreviewableImage(file) {\n    return /^image/.test(file.type);\n  };\n\n  function _typeof(obj) {\n    if (typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol') {\n      _typeof = function (obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function (obj) {\n        return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  var REACT_ELEMENT_TYPE;\n\n  function _jsx(type, props, key, children) {\n    if (!REACT_ELEMENT_TYPE) {\n      REACT_ELEMENT_TYPE = typeof Symbol === 'function' && Symbol.for && Symbol.for('react.element') || 0xeac7;\n    }\n\n    var defaultProps = type && type.defaultProps;\n    var childrenLength = arguments.length - 3;\n\n    if (!props && childrenLength !== 0) {\n      props = {\n        children: void 0\n      };\n    }\n\n    if (props && defaultProps) {\n      for (var propName in defaultProps) {\n        if (props[propName] === void 0) {\n          props[propName] = defaultProps[propName];\n        }\n      }\n    } else if (!props) {\n      props = defaultProps || {};\n    }\n\n    if (childrenLength === 1) {\n      props.children = children;\n    } else if (childrenLength > 1) {\n      var childArray = new Array(childrenLength);\n\n      for (var i = 0; i < childrenLength; i++) {\n        childArray[i] = arguments[i + 3];\n      }\n\n      props.children = childArray;\n    }\n\n    return {\n      $$typeof: REACT_ELEMENT_TYPE,\n      type: type,\n      key: key === undefined ? null : '' + key,\n      ref: null,\n      props: props,\n      _owner: null\n    };\n  }\n\n  function _asyncIterator(iterable) {\n    var method;\n\n    if (typeof Symbol === 'function') {\n      if (Symbol.asyncIterator) {\n        method = iterable[Symbol.asyncIterator];\n        if (method != null) return method.call(iterable);\n      }\n\n      if (Symbol.iterator) {\n        method = iterable[Symbol.iterator];\n        if (method != null) return method.call(iterable);\n      }\n    }\n\n    throw new TypeError('Object is not async iterable');\n  }\n\n  function _AwaitValue(value) {\n    this.wrapped = value;\n  }\n\n  function _AsyncGenerator(gen) {\n    var front, back;\n\n    function send(key, arg) {\n      return new Promise(function (resolve, reject) {\n        var request = {\n          key: key,\n          arg: arg,\n          resolve: resolve,\n          reject: reject,\n          next: null\n        };\n\n        if (back) {\n          back = back.next = request;\n        } else {\n          front = back = request;\n          resume(key, arg);\n        }\n      });\n    }\n\n    function resume(key, arg) {\n      try {\n        var result = gen[key](arg);\n        var value = result.value;\n        var wrappedAwait = value instanceof _AwaitValue;\n        Promise.resolve(wrappedAwait ? value.wrapped : value).then(function (arg) {\n          if (wrappedAwait) {\n            resume('next', arg);\n            return;\n          }\n\n          settle(result.done ? 'return' : 'normal', arg);\n        }, function (err) {\n          resume('throw', err);\n        });\n      } catch (err) {\n        settle('throw', err);\n      }\n    }\n\n    function settle(type, value) {\n      switch (type) {\n        case 'return':\n          front.resolve({\n            value: value,\n            done: true\n          });\n          break;\n\n        case 'throw':\n          front.reject(value);\n          break;\n\n        default:\n          front.resolve({\n            value: value,\n            done: false\n          });\n          break;\n      }\n\n      front = front.next;\n\n      if (front) {\n        resume(front.key, front.arg);\n      } else {\n        back = null;\n      }\n    }\n\n    this._invoke = send;\n\n    if (typeof gen.return !== 'function') {\n      this.return = undefined;\n    }\n  }\n\n  if (typeof Symbol === 'function' && Symbol.asyncIterator) {\n    _AsyncGenerator.prototype[Symbol.asyncIterator] = function () {\n      return this;\n    };\n  }\n\n  _AsyncGenerator.prototype.next = function (arg) {\n    return this._invoke('next', arg);\n  };\n\n  _AsyncGenerator.prototype.throw = function (arg) {\n    return this._invoke('throw', arg);\n  };\n\n  _AsyncGenerator.prototype.return = function (arg) {\n    return this._invoke('return', arg);\n  };\n\n  function _wrapAsyncGenerator(fn) {\n    return function () {\n      return new _AsyncGenerator(fn.apply(this, arguments));\n    };\n  }\n\n  function _awaitAsyncGenerator(value) {\n    return new _AwaitValue(value);\n  }\n\n  function _asyncGeneratorDelegate(inner, awaitWrap) {\n    var iter = {},\n        waiting = false;\n\n    function pump(key, value) {\n      waiting = true;\n      value = new Promise(function (resolve) {\n        resolve(inner[key](value));\n      });\n      return {\n        done: false,\n        value: awaitWrap(value)\n      };\n    }\n\n    if (typeof Symbol === 'function' && Symbol.iterator) {\n      iter[Symbol.iterator] = function () {\n        return this;\n      };\n    }\n\n    iter.next = function (value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump('next', value);\n    };\n\n    if (typeof inner.throw === 'function') {\n      iter.throw = function (value) {\n        if (waiting) {\n          waiting = false;\n          throw value;\n        }\n\n        return pump('throw', value);\n      };\n    }\n\n    if (typeof inner.return === 'function') {\n      iter.return = function (value) {\n        return pump('return', value);\n      };\n    }\n\n    return iter;\n  }\n\n  function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n      var info = gen[key](arg);\n      var value = info.value;\n    } catch (error) {\n      reject(error);\n      return;\n    }\n\n    if (info.done) {\n      resolve(value);\n    } else {\n      Promise.resolve(value).then(_next, _throw);\n    }\n  }\n\n  function _asyncToGenerator(fn) {\n    return function () {\n      var self = this,\n          args = arguments;\n      return new Promise(function (resolve, reject) {\n        var gen = fn.apply(self, args);\n\n        function _next(value) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'next', value);\n        }\n\n        function _throw(err) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);\n        }\n\n        _next(undefined);\n      });\n    };\n  }\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError('Cannot call a class as a function');\n    }\n  }\n\n  function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if ('value' in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  function _createClass(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n    return Constructor;\n  }\n\n  function _defineEnumerableProperties(obj, descs) {\n    for (var key in descs) {\n      var desc = descs[key];\n      desc.configurable = desc.enumerable = true;\n      if ('value' in desc) desc.writable = true;\n      Object.defineProperty(obj, key, desc);\n    }\n\n    if (Object.getOwnPropertySymbols) {\n      var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n      for (var i = 0; i < objectSymbols.length; i++) {\n        var sym = objectSymbols[i];\n        var desc = descs[sym];\n        desc.configurable = desc.enumerable = true;\n        if ('value' in desc) desc.writable = true;\n        Object.defineProperty(obj, sym, desc);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defaults(obj, defaults) {\n    var keys = Object.getOwnPropertyNames(defaults);\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n      var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n      if (value && value.configurable && obj[key] === undefined) {\n        Object.defineProperty(obj, key, value);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defineProperty(obj, key, value) {\n    if (key in obj) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n    } else {\n      obj[key] = value;\n    }\n\n    return obj;\n  }\n\n  function _extends() {\n    _extends = Object.assign || function (target) {\n      for (var i = 1; i < arguments.length; i++) {\n        var source = arguments[i];\n\n        for (var key in source) {\n          if (Object.prototype.hasOwnProperty.call(source, key)) {\n            target[key] = source[key];\n          }\n        }\n      }\n\n      return target;\n    };\n\n    return _extends.apply(this, arguments);\n  }\n\n  function _objectSpread(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n      var ownKeys = Object.keys(source);\n\n      if (typeof Object.getOwnPropertySymbols === 'function') {\n        ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n          return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n      }\n\n      ownKeys.forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    }\n\n    return target;\n  }\n\n  function _inherits(subClass, superClass) {\n    if (typeof superClass !== 'function' && superClass !== null) {\n      throw new TypeError('Super expression must either be null or a function');\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) _setPrototypeOf(subClass, superClass);\n  }\n\n  function _inheritsLoose(subClass, superClass) {\n    subClass.prototype = Object.create(superClass.prototype);\n    subClass.prototype.constructor = subClass;\n    subClass.__proto__ = superClass;\n  }\n\n  function _getPrototypeOf(o) {\n    _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n      return o.__proto__ || Object.getPrototypeOf(o);\n    };\n    return _getPrototypeOf(o);\n  }\n\n  function _setPrototypeOf(o, p) {\n    _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n      o.__proto__ = p;\n      return o;\n    };\n\n    return _setPrototypeOf(o, p);\n  }\n\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === 'function') return true;\n\n    try {\n      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  function _construct(Parent, args, Class) {\n    if (isNativeReflectConstruct()) {\n      _construct = Reflect.construct;\n    } else {\n      _construct = function _construct(Parent, args, Class) {\n        var a = [null];\n        a.push.apply(a, args);\n        var Constructor = Function.bind.apply(Parent, a);\n        var instance = new Constructor();\n        if (Class) _setPrototypeOf(instance, Class.prototype);\n        return instance;\n      };\n    }\n\n    return _construct.apply(null, arguments);\n  }\n\n  function _isNativeFunction(fn) {\n    return Function.toString.call(fn).indexOf('[native code]') !== -1;\n  }\n\n  function _wrapNativeSuper(Class) {\n    var _cache = typeof Map === 'function' ? new Map() : undefined;\n\n    _wrapNativeSuper = function _wrapNativeSuper(Class) {\n      if (Class === null || !_isNativeFunction(Class)) return Class;\n\n      if (typeof Class !== 'function') {\n        throw new TypeError('Super expression must either be null or a function');\n      }\n\n      if (typeof _cache !== 'undefined') {\n        if (_cache.has(Class)) return _cache.get(Class);\n\n        _cache.set(Class, Wrapper);\n      }\n\n      function Wrapper() {\n        return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n      }\n\n      Wrapper.prototype = Object.create(Class.prototype, {\n        constructor: {\n          value: Wrapper,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n      return _setPrototypeOf(Wrapper, Class);\n    };\n\n    return _wrapNativeSuper(Class);\n  }\n\n  function _instanceof(left, right) {\n    if (right != null && typeof Symbol !== 'undefined' && right[Symbol.hasInstance]) {\n      return right[Symbol.hasInstance](left);\n    } else {\n      return left instanceof right;\n    }\n  }\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : {\n      default: obj\n    };\n  }\n\n  function _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};\n\n            if (desc.get || desc.set) {\n              Object.defineProperty(newObj, key, desc);\n            } else {\n              newObj[key] = obj[key];\n            }\n          }\n        }\n      }\n\n      newObj.default = obj;\n      return newObj;\n    }\n  }\n\n  function _newArrowCheck(innerThis, boundThis) {\n    if (innerThis !== boundThis) {\n      throw new TypeError('Cannot instantiate an arrow function');\n    }\n  }\n\n  function _objectDestructuringEmpty(obj) {\n    if (obj == null) throw new TypeError('Cannot destructure undefined');\n  }\n\n  function _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n\n    for (i = 0; i < sourceKeys.length; i++) {\n      key = sourceKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      target[key] = source[key];\n    }\n\n    return target;\n  }\n\n  function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n\n    var key, i;\n\n    if (Object.getOwnPropertySymbols) {\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\n        key = sourceSymbolKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  function _assertThisInitialized(self) {\n    if (self === void 0) {\n      throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    }\n\n    return self;\n  }\n\n  function _possibleConstructorReturn(self, call) {\n    if (call && (typeof call === 'object' || typeof call === 'function')) {\n      return call;\n    }\n\n    return _assertThisInitialized(self);\n  }\n\n  function _superPropBase(object, property) {\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\n      object = _getPrototypeOf(object);\n      if (object === null) break;\n    }\n\n    return object;\n  }\n\n  function _get(target, property, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.get) {\n      _get = Reflect.get;\n    } else {\n      _get = function _get(target, property, receiver) {\n        var base = _superPropBase(target, property);\n\n        if (!base) return;\n        var desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.get) {\n          return desc.get.call(receiver);\n        }\n\n        return desc.value;\n      };\n    }\n\n    return _get(target, property, receiver || target);\n  }\n\n  function set(target, property, value, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.set) {\n      set = Reflect.set;\n    } else {\n      set = function set(target, property, value, receiver) {\n        var base = _superPropBase(target, property);\n\n        var desc;\n\n        if (base) {\n          desc = Object.getOwnPropertyDescriptor(base, property);\n\n          if (desc.set) {\n            desc.set.call(receiver, value);\n            return true;\n          } else if (!desc.writable) {\n            return false;\n          }\n        }\n\n        desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n        if (desc) {\n          if (!desc.writable) {\n            return false;\n          }\n\n          desc.value = value;\n          Object.defineProperty(receiver, property, desc);\n        } else {\n          _defineProperty(receiver, property, value);\n        }\n\n        return true;\n      };\n    }\n\n    return set(target, property, value, receiver);\n  }\n\n  function _set(target, property, value, receiver, isStrict) {\n    var s = set(target, property, value, receiver || target);\n\n    if (!s && isStrict) {\n      throw new Error('failed to set property');\n    }\n\n    return value;\n  }\n\n  function _taggedTemplateLiteral(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    return Object.freeze(Object.defineProperties(strings, {\n      raw: {\n        value: Object.freeze(raw)\n      }\n    }));\n  }\n\n  function _taggedTemplateLiteralLoose(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    strings.raw = raw;\n    return strings;\n  }\n\n  function _temporalRef(val, name) {\n    if (val === _temporalUndefined) {\n      throw new ReferenceError(name + ' is not defined - temporal dead zone');\n    } else {\n      return val;\n    }\n  }\n\n  function _readOnlyError(name) {\n    throw new Error('\"' + name + '\" is read-only');\n  }\n\n  function _classNameTDZError(name) {\n    throw new Error('Class \"' + name + '\" cannot be referenced in computed property keys.');\n  }\n\n  var _temporalUndefined = {};\n\n  function _slicedToArray(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n  }\n\n  function _slicedToArrayLoose(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimitLoose(arr, i) || _nonIterableRest();\n  }\n\n  function _toArray(arr) {\n    return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n  }\n\n  function _toConsumableArray(arr) {\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n  }\n\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) {\n      for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n      return arr2;\n    }\n  }\n\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n\n  function _iterableToArray(iter) {\n    if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === '[object Arguments]') return Array.from(iter);\n  }\n\n  function _iterableToArrayLimit(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i['return'] != null) _i['return']();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  function _iterableToArrayLimitLoose(arr, i) {\n    var _arr = [];\n\n    for (var _iterator = arr[Symbol.iterator](), _step; !(_step = _iterator.next()).done;) {\n      _arr.push(_step.value);\n\n      if (i && _arr.length === i) break;\n    }\n\n    return _arr;\n  }\n\n  function _nonIterableSpread() {\n    throw new TypeError('Invalid attempt to spread non-iterable instance');\n  }\n\n  function _nonIterableRest() {\n    throw new TypeError('Invalid attempt to destructure non-iterable instance');\n  }\n\n  function _skipFirstGeneratorNext(fn) {\n    return function () {\n      var it = fn.apply(this, arguments);\n      it.next();\n      return it;\n    };\n  }\n\n  function _toPrimitive(input, hint) {\n    if (typeof input !== 'object' || input === null) return input;\n    var prim = input[Symbol.toPrimitive];\n\n    if (prim !== undefined) {\n      var res = prim.call(input, hint || 'default');\n      if (typeof res !== 'object') return res;\n      throw new TypeError('@@toPrimitive must return a primitive value.');\n    }\n\n    return (hint === 'string' ? String : Number)(input);\n  }\n\n  function _toPropertyKey(arg) {\n    var key = _toPrimitive(arg, 'string');\n\n    return typeof key === 'symbol' ? key : String(key);\n  }\n\n  function _initializerWarningHelper(descriptor, context) {\n    throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and set to use loose mode. ' + 'To use proposal-class-properties in spec mode with decorators, wait for ' + 'the next major version of decorators in stage 2.');\n  }\n\n  function _initializerDefineProperty(target, property, descriptor, context) {\n    if (!descriptor) return;\n    Object.defineProperty(target, property, {\n      enumerable: descriptor.enumerable,\n      configurable: descriptor.configurable,\n      writable: descriptor.writable,\n      value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n    });\n  }\n\n  function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n    var desc = {};\n    Object.keys(descriptor).forEach(function (key) {\n      desc[key] = descriptor[key];\n    });\n    desc.enumerable = !!desc.enumerable;\n    desc.configurable = !!desc.configurable;\n\n    if ('value' in desc || desc.initializer) {\n      desc.writable = true;\n    }\n\n    desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n      return decorator(target, property, desc) || desc;\n    }, desc);\n\n    if (context && desc.initializer !== void 0) {\n      desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n      desc.initializer = undefined;\n    }\n\n    if (desc.initializer === void 0) {\n      Object.defineProperty(target, property, desc);\n      desc = null;\n    }\n\n    return desc;\n  }\n\n  var id = 0;\n\n  function _classPrivateFieldLooseKey(name) {\n    return '__private_' + id++ + '_' + name;\n  }\n\n  function _classPrivateFieldLooseBase(receiver, privateKey) {\n    if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n      throw new TypeError('attempted to use private field on non-instance');\n    }\n\n    return receiver;\n  }\n\n  function _classPrivateFieldGet(receiver, privateMap) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.get) {\n      return descriptor.get.call(receiver);\n    }\n\n    return descriptor.value;\n  }\n\n  function _classPrivateFieldSet(receiver, privateMap, value) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.set) {\n      descriptor.set.call(receiver, value);\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      descriptor.value = value;\n    }\n\n    return value;\n  }\n\n  function _classStaticPrivateFieldSpecGet(receiver, classConstructor, descriptor) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return descriptor.value;\n  }\n\n  function _classStaticPrivateFieldSpecSet(receiver, classConstructor, descriptor, value) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    if (!descriptor.writable) {\n      throw new TypeError('attempted to set read only private field');\n    }\n\n    descriptor.value = value;\n    return value;\n  }\n\n  function _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return method;\n  }\n\n  function _classStaticPrivateMethodSet() {\n    throw new TypeError('attempted to set read only static private field');\n  }\n\n  function _decorate(decorators, factory, superClass, mixins) {\n    var api = _getDecoratorsApi();\n\n    if (mixins) {\n      for (var i = 0; i < mixins.length; i++) {\n        api = mixins[i](api);\n      }\n    }\n\n    var r = factory(function initialize(O) {\n      api.initializeInstanceElements(O, decorated.elements);\n    }, superClass);\n    var decorated = api.decorateClass(_coalesceClassElements(r.d.map(_createElementDescriptor)), decorators);\n    api.initializeClassElements(r.F, decorated.elements);\n    return api.runClassFinishers(r.F, decorated.finishers);\n  }\n\n  function _getDecoratorsApi() {\n    _getDecoratorsApi = function () {\n      return api;\n    };\n\n    var api = {\n      elementsDefinitionOrder: [['method'], ['field']],\n      initializeInstanceElements: function (O, elements) {\n        ['method', 'field'].forEach(function (kind) {\n          elements.forEach(function (element) {\n            if (element.kind === kind && element.placement === 'own') {\n              this.defineClassElement(O, element);\n            }\n          }, this);\n        }, this);\n      },\n      initializeClassElements: function (F, elements) {\n        var proto = F.prototype;\n        ['method', 'field'].forEach(function (kind) {\n          elements.forEach(function (element) {\n            var placement = element.placement;\n\n            if (element.kind === kind && (placement === 'static' || placement === 'prototype')) {\n              var receiver = placement === 'static' ? F : proto;\n              this.defineClassElement(receiver, element);\n            }\n          }, this);\n        }, this);\n      },\n      defineClassElement: function (receiver, element) {\n        var descriptor = element.descriptor;\n\n        if (element.kind === 'field') {\n          var initializer = element.initializer;\n          descriptor = {\n            enumerable: descriptor.enumerable,\n            writable: descriptor.writable,\n            configurable: descriptor.configurable,\n            value: initializer === void 0 ? void 0 : initializer.call(receiver)\n          };\n        }\n\n        Object.defineProperty(receiver, element.key, descriptor);\n      },\n      decorateClass: function (elements, decorators) {\n        var newElements = [];\n        var finishers = [];\n        var placements = {\n          static: [],\n          prototype: [],\n          own: []\n        };\n        elements.forEach(function (element) {\n          this.addElementPlacement(element, placements);\n        }, this);\n        elements.forEach(function (element) {\n          if (!_hasDecorators(element)) return newElements.push(element);\n          var elementFinishersExtras = this.decorateElement(element, placements);\n          newElements.push(elementFinishersExtras.element);\n          newElements.push.apply(newElements, elementFinishersExtras.extras);\n          finishers.push.apply(finishers, elementFinishersExtras.finishers);\n        }, this);\n\n        if (!decorators) {\n          return {\n            elements: newElements,\n            finishers: finishers\n          };\n        }\n\n        var result = this.decorateConstructor(newElements, decorators);\n        finishers.push.apply(finishers, result.finishers);\n        result.finishers = finishers;\n        return result;\n      },\n      addElementPlacement: function (element, placements, silent) {\n        var keys = placements[element.placement];\n\n        if (!silent && keys.indexOf(element.key) !== -1) {\n          throw new TypeError('Duplicated element (' + element.key + ')');\n        }\n\n        keys.push(element.key);\n      },\n      decorateElement: function (element, placements) {\n        var extras = [];\n        var finishers = [];\n\n        for (var decorators = element.decorators, i = decorators.length - 1; i >= 0; i--) {\n          var keys = placements[element.placement];\n          keys.splice(keys.indexOf(element.key), 1);\n          var elementObject = this.fromElementDescriptor(element);\n          var elementFinisherExtras = this.toElementFinisherExtras((0, decorators[i])(elementObject) || elementObject);\n          element = elementFinisherExtras.element;\n          this.addElementPlacement(element, placements);\n\n          if (elementFinisherExtras.finisher) {\n            finishers.push(elementFinisherExtras.finisher);\n          }\n\n          var newExtras = elementFinisherExtras.extras;\n\n          if (newExtras) {\n            for (var j = 0; j < newExtras.length; j++) {\n              this.addElementPlacement(newExtras[j], placements);\n            }\n\n            extras.push.apply(extras, newExtras);\n          }\n        }\n\n        return {\n          element: element,\n          finishers: finishers,\n          extras: extras\n        };\n      },\n      decorateConstructor: function (elements, decorators) {\n        var finishers = [];\n\n        for (var i = decorators.length - 1; i >= 0; i--) {\n          var obj = this.fromClassDescriptor(elements);\n          var elementsAndFinisher = this.toClassDescriptor((0, decorators[i])(obj) || obj);\n\n          if (elementsAndFinisher.finisher !== undefined) {\n            finishers.push(elementsAndFinisher.finisher);\n          }\n\n          if (elementsAndFinisher.elements !== undefined) {\n            elements = elementsAndFinisher.elements;\n\n            for (var j = 0; j < elements.length - 1; j++) {\n              for (var k = j + 1; k < elements.length; k++) {\n                if (elements[j].key === elements[k].key && elements[j].placement === elements[k].placement) {\n                  throw new TypeError('Duplicated element (' + elements[j].key + ')');\n                }\n              }\n            }\n          }\n        }\n\n        return {\n          elements: elements,\n          finishers: finishers\n        };\n      },\n      fromElementDescriptor: function (element) {\n        var obj = {\n          kind: element.kind,\n          key: element.key,\n          placement: element.placement,\n          descriptor: element.descriptor\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        if (element.kind === 'field') obj.initializer = element.initializer;\n        return obj;\n      },\n      toElementDescriptors: function (elementObjects) {\n        if (elementObjects === undefined) return;\n        return _toArray(elementObjects).map(function (elementObject) {\n          var element = this.toElementDescriptor(elementObject);\n          this.disallowProperty(elementObject, 'finisher', 'An element descriptor');\n          this.disallowProperty(elementObject, 'extras', 'An element descriptor');\n          return element;\n        }, this);\n      },\n      toElementDescriptor: function (elementObject) {\n        var kind = String(elementObject.kind);\n\n        if (kind !== 'method' && kind !== 'field') {\n          throw new TypeError('An element descriptor\\'s .kind property must be either \"method\" or' + ' \"field\", but a decorator created an element descriptor with' + ' .kind \"' + kind + '\"');\n        }\n\n        var key = _toPropertyKey(elementObject.key);\n\n        var placement = String(elementObject.placement);\n\n        if (placement !== 'static' && placement !== 'prototype' && placement !== 'own') {\n          throw new TypeError('An element descriptor\\'s .placement property must be one of \"static\",' + ' \"prototype\" or \"own\", but a decorator created an element descriptor' + ' with .placement \"' + placement + '\"');\n        }\n\n        var descriptor = elementObject.descriptor;\n        this.disallowProperty(elementObject, 'elements', 'An element descriptor');\n        var element = {\n          kind: kind,\n          key: key,\n          placement: placement,\n          descriptor: Object.assign({}, descriptor)\n        };\n\n        if (kind !== 'field') {\n          this.disallowProperty(elementObject, 'initializer', 'A method descriptor');\n        } else {\n          this.disallowProperty(descriptor, 'get', 'The property descriptor of a field descriptor');\n          this.disallowProperty(descriptor, 'set', 'The property descriptor of a field descriptor');\n          this.disallowProperty(descriptor, 'value', 'The property descriptor of a field descriptor');\n          element.initializer = elementObject.initializer;\n        }\n\n        return element;\n      },\n      toElementFinisherExtras: function (elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n\n        var finisher = _optionalCallableProperty(elementObject, 'finisher');\n\n        var extras = this.toElementDescriptors(elementObject.extras);\n        return {\n          element: element,\n          finisher: finisher,\n          extras: extras\n        };\n      },\n      fromClassDescriptor: function (elements) {\n        var obj = {\n          kind: 'class',\n          elements: elements.map(this.fromElementDescriptor, this)\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        return obj;\n      },\n      toClassDescriptor: function (obj) {\n        var kind = String(obj.kind);\n\n        if (kind !== 'class') {\n          throw new TypeError('A class descriptor\\'s .kind property must be \"class\", but a decorator' + ' created a class descriptor with .kind \"' + kind + '\"');\n        }\n\n        this.disallowProperty(obj, 'key', 'A class descriptor');\n        this.disallowProperty(obj, 'placement', 'A class descriptor');\n        this.disallowProperty(obj, 'descriptor', 'A class descriptor');\n        this.disallowProperty(obj, 'initializer', 'A class descriptor');\n        this.disallowProperty(obj, 'extras', 'A class descriptor');\n\n        var finisher = _optionalCallableProperty(obj, 'finisher');\n\n        var elements = this.toElementDescriptors(obj.elements);\n        return {\n          elements: elements,\n          finisher: finisher\n        };\n      },\n      runClassFinishers: function (constructor, finishers) {\n        for (var i = 0; i < finishers.length; i++) {\n          var newConstructor = (0, finishers[i])(constructor);\n\n          if (newConstructor !== undefined) {\n            if (typeof newConstructor !== 'function') {\n              throw new TypeError('Finishers must return a constructor.');\n            }\n\n            constructor = newConstructor;\n          }\n        }\n\n        return constructor;\n      },\n      disallowProperty: function (obj, name, objectType) {\n        if (obj[name] !== undefined) {\n          throw new TypeError(objectType + \" can't have a .\" + name + ' property.');\n        }\n      }\n    };\n    return api;\n  }\n\n  function _createElementDescriptor(def) {\n    var key = _toPropertyKey(def.key);\n\n    var descriptor;\n\n    if (def.kind === 'method') {\n      descriptor = {\n        value: def.value,\n        writable: true,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'get') {\n      descriptor = {\n        get: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'set') {\n      descriptor = {\n        set: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'field') {\n      descriptor = {\n        configurable: true,\n        writable: true,\n        enumerable: true\n      };\n    }\n\n    var element = {\n      kind: def.kind === 'field' ? 'field' : 'method',\n      key: key,\n      placement: def.static ? 'static' : def.kind === 'field' ? 'own' : 'prototype',\n      descriptor: descriptor\n    };\n    if (def.decorators) element.decorators = def.decorators;\n    if (def.kind === 'field') element.initializer = def.value;\n    return element;\n  }\n\n  function _coalesceGetterSetter(element, other) {\n    if (element.descriptor.get !== undefined) {\n      other.descriptor.get = element.descriptor.get;\n    } else {\n      other.descriptor.set = element.descriptor.set;\n    }\n  }\n\n  function _coalesceClassElements(elements) {\n    var newElements = [];\n\n    var isSameElement = function (other) {\n      return other.kind === 'method' && other.key === element.key && other.placement === element.placement;\n    };\n\n    for (var i = 0; i < elements.length; i++) {\n      var element = elements[i];\n      var other;\n\n      if (element.kind === 'method' && (other = newElements.find(isSameElement))) {\n        if (_isDataDescriptor(element.descriptor) || _isDataDescriptor(other.descriptor)) {\n          if (_hasDecorators(element) || _hasDecorators(other)) {\n            throw new ReferenceError('Duplicated methods (' + element.key + \") can't be decorated.\");\n          }\n\n          other.descriptor = element.descriptor;\n        } else {\n          if (_hasDecorators(element)) {\n            if (_hasDecorators(other)) {\n              throw new ReferenceError(\"Decorators can't be placed on different accessors with for \" + 'the same property (' + element.key + ').');\n            }\n\n            other.decorators = element.decorators;\n          }\n\n          _coalesceGetterSetter(element, other);\n        }\n      } else {\n        newElements.push(element);\n      }\n    }\n\n    return newElements;\n  }\n\n  function _hasDecorators(element) {\n    return element.decorators && element.decorators.length;\n  }\n\n  function _isDataDescriptor(desc) {\n    return desc !== undefined && !(desc.value === undefined && desc.writable === undefined);\n  }\n\n  function _optionalCallableProperty(obj, name) {\n    var value = obj[name];\n\n    if (value !== undefined && typeof value !== 'function') {\n      throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n    }\n\n    return value;\n  }\n\n  function _classPrivateMethodGet(receiver, privateSet, fn) {\n    if (!privateSet.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    return fn;\n  }\n\n  function _classPrivateMethodSet() {\n    throw new TypeError('attempted to reassign private method');\n  }\n\n  function _wrapRegExp(re, groups) {\n    _wrapRegExp = function (re, groups) {\n      return new BabelRegExp(re, groups);\n    };\n\n    var _RegExp = _wrapNativeSuper(RegExp);\n\n    var _super = RegExp.prototype;\n\n    var _groups = new WeakMap();\n\n    function BabelRegExp(re, groups) {\n      var _this = _RegExp.call(this, re);\n\n      _groups.set(_this, groups);\n\n      return _this;\n    }\n\n    _inherits(BabelRegExp, _RegExp);\n\n    BabelRegExp.prototype.exec = function (str) {\n      var result = _super.exec.call(this, str);\n\n      if (result) result.groups = buildGroups(result, this);\n      return result;\n    };\n\n    BabelRegExp.prototype[Symbol.replace] = function (str, substitution) {\n      if (typeof substitution === 'string') {\n        var groups = _groups.get(this);\n\n        return _super[Symbol.replace].call(this, str, substitution.replace(/\\$<([^>]+)>/g, function (_, name) {\n          return '$' + groups[name];\n        }));\n      } else if (typeof substitution === 'function') {\n        var _this = this;\n\n        return _super[Symbol.replace].call(this, str, function () {\n          var args = [];\n          args.push.apply(args, arguments);\n\n          if (typeof args[args.length - 1] !== 'object') {\n            args.push(buildGroups(args, _this));\n          }\n\n          return substitution.apply(this, args);\n        });\n      } else {\n        return _super[Symbol.replace].call(this, str, substitution);\n      }\n    };\n\n    function buildGroups(result, re) {\n      var g = _groups.get(re);\n\n      return Object.keys(g).reduce(function (groups, name) {\n        groups[name] = result[g[name]];\n        return groups;\n      }, Object.create(null));\n    }\n\n    return _wrapRegExp.apply(this, arguments);\n  }\n\n  var vectorMultiply = function vectorMultiply(v, amount) {\n    return createVector(v.x * amount, v.y * amount);\n  };\n\n  var vectorAdd = function vectorAdd(a, b) {\n    return createVector(a.x + b.x, a.y + b.y);\n  };\n\n  var vectorNormalize = function vectorNormalize(v) {\n    var l = Math.sqrt(v.x * v.x + v.y * v.y);\n\n    if (l === 0) {\n      return {\n        x: 0,\n        y: 0\n      };\n    }\n\n    return createVector(v.x / l, v.y / l);\n  };\n\n  var vectorRotate = function vectorRotate(v, radians, origin) {\n    var cos = Math.cos(radians);\n    var sin = Math.sin(radians);\n    var t = createVector(v.x - origin.x, v.y - origin.y);\n    return createVector(origin.x + cos * t.x - sin * t.y, origin.y + sin * t.x + cos * t.y);\n  };\n\n  var createVector = function createVector() {\n    var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  var getMarkupValue = function getMarkupValue(value, size) {\n    var scalar = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    var axis = arguments.length > 3 ? arguments[3] : undefined;\n\n    if (typeof value === 'string') {\n      return parseFloat(value) * scalar;\n    }\n\n    if (typeof value === 'number') {\n      return value * (axis ? size[axis] : Math.min(size.width, size.height));\n    }\n\n    return;\n  };\n\n  var getMarkupStyles = function getMarkupStyles(markup, size, scale) {\n    var lineStyle = markup.borderStyle || markup.lineStyle || 'solid';\n    var fill = markup.backgroundColor || markup.fontColor || 'transparent';\n    var stroke = markup.borderColor || markup.lineColor || 'transparent';\n    var strokeWidth = getMarkupValue(markup.borderWidth || markup.lineWidth, size, scale);\n    var lineCap = markup.lineCap || 'round';\n    var lineJoin = markup.lineJoin || 'round';\n    var dashes = typeof lineStyle === 'string' ? '' : lineStyle.map(function (v) {\n      return getMarkupValue(v, size, scale);\n    }).join(',');\n    var opacity = markup.opacity || 1;\n    return {\n      'stroke-linecap': lineCap,\n      'stroke-linejoin': lineJoin,\n      'stroke-width': strokeWidth || 0,\n      'stroke-dasharray': dashes,\n      stroke: stroke,\n      fill: fill,\n      opacity: opacity\n    };\n  };\n\n  var isDefined = function isDefined(value) {\n    return value != null;\n  };\n\n  var getMarkupRect = function getMarkupRect(rect, size) {\n    var scalar = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    var left = getMarkupValue(rect.x, size, scalar, 'width') || getMarkupValue(rect.left, size, scalar, 'width');\n    var top = getMarkupValue(rect.y, size, scalar, 'height') || getMarkupValue(rect.top, size, scalar, 'height');\n    var width = getMarkupValue(rect.width, size, scalar, 'width');\n    var height = getMarkupValue(rect.height, size, scalar, 'height');\n    var right = getMarkupValue(rect.right, size, scalar, 'width');\n    var bottom = getMarkupValue(rect.bottom, size, scalar, 'height');\n\n    if (!isDefined(top)) {\n      if (isDefined(height) && isDefined(bottom)) {\n        top = size.height - height - bottom;\n      } else {\n        top = bottom;\n      }\n    }\n\n    if (!isDefined(left)) {\n      if (isDefined(width) && isDefined(right)) {\n        left = size.width - width - right;\n      } else {\n        left = right;\n      }\n    }\n\n    if (!isDefined(width)) {\n      if (isDefined(left) && isDefined(right)) {\n        width = size.width - left - right;\n      } else {\n        width = 0;\n      }\n    }\n\n    if (!isDefined(height)) {\n      if (isDefined(top) && isDefined(bottom)) {\n        height = size.height - top - bottom;\n      } else {\n        height = 0;\n      }\n    }\n\n    return {\n      x: left || 0,\n      y: top || 0,\n      width: width || 0,\n      height: height || 0\n    };\n  };\n\n  var pointsToPathShape = function pointsToPathShape(points) {\n    return points.map(function (point, index) {\n      return ''.concat(index === 0 ? 'M' : 'L', ' ').concat(point.x, ' ').concat(point.y);\n    }).join(' ');\n  };\n\n  var setAttributes = function setAttributes(element, attr) {\n    return Object.keys(attr).forEach(function (key) {\n      return element.setAttribute(key, attr[key]);\n    });\n  };\n\n  var ns = 'http://www.w3.org/2000/svg';\n\n  var svg = function svg(tag, attr) {\n    var element = document.createElementNS(ns, tag);\n\n    if (attr) {\n      setAttributes(element, attr);\n    }\n\n    return element;\n  };\n\n  var updateRect = function updateRect(element) {\n    return setAttributes(element, Object.assign({}, element.rect, element.styles));\n  };\n\n  var updateEllipse = function updateEllipse(element) {\n    var cx = element.rect.x + element.rect.width * 0.5;\n    var cy = element.rect.y + element.rect.height * 0.5;\n    var rx = element.rect.width * 0.5;\n    var ry = element.rect.height * 0.5;\n    return setAttributes(element, Object.assign({\n      cx: cx,\n      cy: cy,\n      rx: rx,\n      ry: ry\n    }, element.styles));\n  };\n\n  var IMAGE_FIT_STYLE = {\n    contain: 'xMidYMid meet',\n    cover: 'xMidYMid slice'\n  };\n\n  var updateImage = function updateImage(element, markup) {\n    setAttributes(element, Object.assign({}, element.rect, element.styles, {\n      preserveAspectRatio: IMAGE_FIT_STYLE[markup.fit] || 'none'\n    }));\n  };\n\n  var TEXT_ANCHOR = {\n    left: 'start',\n    center: 'middle',\n    right: 'end'\n  };\n\n  var updateText = function updateText(element, markup, size, scale) {\n    var fontSize = getMarkupValue(markup.fontSize, size, scale);\n    var fontFamily = markup.fontFamily || 'sans-serif';\n    var fontWeight = markup.fontWeight || 'normal';\n    var textAlign = TEXT_ANCHOR[markup.textAlign] || 'start';\n    setAttributes(element, Object.assign({}, element.rect, element.styles, {\n      'stroke-width': 0,\n      'font-weight': fontWeight,\n      'font-size': fontSize,\n      'font-family': fontFamily,\n      'text-anchor': textAlign\n    })); // update text\n\n    if (element.text !== markup.text) {\n      element.text = markup.text;\n      element.textContent = markup.text.length ? markup.text : ' ';\n    }\n  };\n\n  var updateLine = function updateLine(element, markup, size, scale) {\n    setAttributes(element, Object.assign({}, element.rect, element.styles, {\n      fill: 'none'\n    }));\n    var line = element.childNodes[0];\n    var begin = element.childNodes[1];\n    var end = element.childNodes[2];\n    var origin = element.rect;\n    var target = {\n      x: element.rect.x + element.rect.width,\n      y: element.rect.y + element.rect.height\n    };\n    setAttributes(line, {\n      x1: origin.x,\n      y1: origin.y,\n      x2: target.x,\n      y2: target.y\n    });\n    if (!markup.lineDecoration) return;\n    begin.style.display = 'none';\n    end.style.display = 'none';\n    var v = vectorNormalize({\n      x: target.x - origin.x,\n      y: target.y - origin.y\n    });\n    var l = getMarkupValue(0.05, size, scale);\n\n    if (markup.lineDecoration.indexOf('arrow-begin') !== -1) {\n      var arrowBeginRotationPoint = vectorMultiply(v, l);\n      var arrowBeginCenter = vectorAdd(origin, arrowBeginRotationPoint);\n      var arrowBeginA = vectorRotate(origin, 2, arrowBeginCenter);\n      var arrowBeginB = vectorRotate(origin, -2, arrowBeginCenter);\n      setAttributes(begin, {\n        style: 'display:block;',\n        d: 'M'.concat(arrowBeginA.x, ',').concat(arrowBeginA.y, ' L').concat(origin.x, ',').concat(origin.y, ' L').concat(arrowBeginB.x, ',').concat(arrowBeginB.y)\n      });\n    }\n\n    if (markup.lineDecoration.indexOf('arrow-end') !== -1) {\n      var arrowEndRotationPoint = vectorMultiply(v, -l);\n      var arrowEndCenter = vectorAdd(target, arrowEndRotationPoint);\n      var arrowEndA = vectorRotate(target, 2, arrowEndCenter);\n      var arrowEndB = vectorRotate(target, -2, arrowEndCenter);\n      setAttributes(end, {\n        style: 'display:block;',\n        d: 'M'.concat(arrowEndA.x, ',').concat(arrowEndA.y, ' L').concat(target.x, ',').concat(target.y, ' L').concat(arrowEndB.x, ',').concat(arrowEndB.y)\n      });\n    }\n  };\n\n  var updatePath = function updatePath(element, markup, size, scale) {\n    setAttributes(element, Object.assign({}, element.styles, {\n      fill: 'none',\n      d: pointsToPathShape(markup.points.map(function (point) {\n        return {\n          x: getMarkupValue(point.x, size, scale, 'width'),\n          y: getMarkupValue(point.y, size, scale, 'height')\n        };\n      }))\n    }));\n  };\n\n  var createShape = function createShape(node) {\n    return function (markup) {\n      return svg(node, {\n        id: markup.id\n      });\n    };\n  };\n\n  var createImage = function createImage(markup) {\n    var shape = svg('image', {\n      id: markup.id,\n      'stroke-linecap': 'round',\n      'stroke-linejoin': 'round',\n      opacity: '0'\n    });\n\n    shape.onload = function () {\n      shape.setAttribute('opacity', markup.opacity || 1);\n    };\n\n    shape.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', markup.src);\n    return shape;\n  };\n\n  var createLine = function createLine(markup) {\n    var shape = svg('g', {\n      id: markup.id,\n      'stroke-linecap': 'round',\n      'stroke-linejoin': 'round'\n    });\n    var line = svg('line');\n    shape.appendChild(line);\n    var begin = svg('path');\n    shape.appendChild(begin);\n    var end = svg('path');\n    shape.appendChild(end);\n    return shape;\n  };\n\n  var CREATE_TYPE_ROUTES = {\n    image: createImage,\n    rect: createShape('rect'),\n    ellipse: createShape('ellipse'),\n    text: createShape('text'),\n    path: createShape('path'),\n    line: createLine\n  };\n  var UPDATE_TYPE_ROUTES = {\n    rect: updateRect,\n    ellipse: updateEllipse,\n    image: updateImage,\n    text: updateText,\n    path: updatePath,\n    line: updateLine\n  };\n\n  var createMarkupByType = function createMarkupByType(type, markup) {\n    return CREATE_TYPE_ROUTES[type](markup);\n  };\n\n  var updateMarkupByType = function updateMarkupByType(element, type, markup, size, scale) {\n    if (type !== 'path') {\n      element.rect = getMarkupRect(markup, size, scale);\n    }\n\n    element.styles = getMarkupStyles(markup, size, scale);\n    UPDATE_TYPE_ROUTES[type](element, markup, size, scale);\n  };\n\n  var MARKUP_RECT = ['x', 'y', 'left', 'top', 'right', 'bottom', 'width', 'height'];\n\n  var toOptionalFraction = function toOptionalFraction(value) {\n    return typeof value === 'string' && /%/.test(value) ? parseFloat(value) / 100 : value;\n  }; // adds default markup properties, clones markup\n\n\n  var prepareMarkup = function prepareMarkup(markup) {\n    var _markup = _slicedToArray(markup, 2),\n        type = _markup[0],\n        props = _markup[1];\n\n    var rect = props.points ? {} : MARKUP_RECT.reduce(function (prev, curr) {\n      prev[curr] = toOptionalFraction(props[curr]);\n      return prev;\n    }, {});\n    return [type, Object.assign({\n      zIndex: 0\n    }, props, rect)];\n  };\n\n  var sortMarkupByZIndex = function sortMarkupByZIndex(a, b) {\n    if (a[1].zIndex > b[1].zIndex) {\n      return 1;\n    }\n\n    if (a[1].zIndex < b[1].zIndex) {\n      return -1;\n    }\n\n    return 0;\n  };\n\n  var createMarkupView = function createMarkupView(_) {\n    return _.utils.createView({\n      name: 'image-preview-markup',\n      tag: 'svg',\n      ignoreRect: true,\n      mixins: {\n        apis: ['width', 'height', 'crop', 'markup', 'resize', 'dirty']\n      },\n      write: function write(_ref) {\n        var root = _ref.root,\n            props = _ref.props;\n        if (!props.dirty) return;\n        var crop = props.crop,\n            resize = props.resize,\n            markup = props.markup;\n        var viewWidth = props.width;\n        var viewHeight = props.height;\n        var cropWidth = crop.width;\n        var cropHeight = crop.height;\n\n        if (resize) {\n          var _size = resize.size;\n          var outputWidth = _size && _size.width;\n          var outputHeight = _size && _size.height;\n          var outputFit = resize.mode;\n          var outputUpscale = resize.upscale;\n          if (outputWidth && !outputHeight) outputHeight = outputWidth;\n          if (outputHeight && !outputWidth) outputWidth = outputHeight;\n          var shouldUpscale = cropWidth < outputWidth && cropHeight < outputHeight;\n\n          if (!shouldUpscale || shouldUpscale && outputUpscale) {\n            var scalarWidth = outputWidth / cropWidth;\n            var scalarHeight = outputHeight / cropHeight;\n\n            if (outputFit === 'force') {\n              cropWidth = outputWidth;\n              cropHeight = outputHeight;\n            } else {\n              var scalar;\n\n              if (outputFit === 'cover') {\n                scalar = Math.max(scalarWidth, scalarHeight);\n              } else if (outputFit === 'contain') {\n                scalar = Math.min(scalarWidth, scalarHeight);\n              }\n\n              cropWidth = cropWidth * scalar;\n              cropHeight = cropHeight * scalar;\n            }\n          }\n        }\n\n        var size = {\n          width: viewWidth,\n          height: viewHeight\n        };\n        root.element.setAttribute('width', size.width);\n        root.element.setAttribute('height', size.height);\n        var scale = Math.min(viewWidth / cropWidth, viewHeight / cropHeight); // clear\n\n        root.element.innerHTML = ''; // get filter\n\n        var markupFilter = root.query('GET_IMAGE_PREVIEW_MARKUP_FILTER'); // draw new\n\n        markup.filter(markupFilter).map(prepareMarkup).sort(sortMarkupByZIndex).forEach(function (markup) {\n          var _markup = _slicedToArray(markup, 2),\n              type = _markup[0],\n              settings = _markup[1]; // create\n\n\n          var element = createMarkupByType(type, settings); // update\n\n          updateMarkupByType(element, type, settings, size, scale); // add\n\n          root.element.appendChild(element);\n        });\n      }\n    });\n  };\n\n  var createVector$1 = function createVector(x, y) {\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  var vectorDot = function vectorDot(a, b) {\n    return a.x * b.x + a.y * b.y;\n  };\n\n  var vectorSubtract = function vectorSubtract(a, b) {\n    return createVector$1(a.x - b.x, a.y - b.y);\n  };\n\n  var vectorDistanceSquared = function vectorDistanceSquared(a, b) {\n    return vectorDot(vectorSubtract(a, b), vectorSubtract(a, b));\n  };\n\n  var vectorDistance = function vectorDistance(a, b) {\n    return Math.sqrt(vectorDistanceSquared(a, b));\n  };\n\n  var getOffsetPointOnEdge = function getOffsetPointOnEdge(length, rotation) {\n    var a = length;\n    var A = 1.5707963267948966;\n    var B = rotation;\n    var C = 1.5707963267948966 - rotation;\n    var sinA = Math.sin(A);\n    var sinB = Math.sin(B);\n    var sinC = Math.sin(C);\n    var cosC = Math.cos(C);\n    var ratio = a / sinA;\n    var b = ratio * sinB;\n    var c = ratio * sinC;\n    return createVector$1(cosC * b, cosC * c);\n  };\n\n  var getRotatedRectSize = function getRotatedRectSize(rect, rotation) {\n    var w = rect.width;\n    var h = rect.height;\n    var hor = getOffsetPointOnEdge(w, rotation);\n    var ver = getOffsetPointOnEdge(h, rotation);\n    var tl = createVector$1(rect.x + Math.abs(hor.x), rect.y - Math.abs(hor.y));\n    var tr = createVector$1(rect.x + rect.width + Math.abs(ver.y), rect.y + Math.abs(ver.x));\n    var bl = createVector$1(rect.x - Math.abs(ver.y), rect.y + rect.height - Math.abs(ver.x));\n    return {\n      width: vectorDistance(tl, tr),\n      height: vectorDistance(tl, bl)\n    };\n  };\n\n  var calculateCanvasSize = function calculateCanvasSize(image, canvasAspectRatio) {\n    var zoom = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    var imageAspectRatio = image.height / image.width; // determine actual pixels on x and y axis\n\n    var canvasWidth = 1;\n    var canvasHeight = canvasAspectRatio;\n    var imgWidth = 1;\n    var imgHeight = imageAspectRatio;\n\n    if (imgHeight > canvasHeight) {\n      imgHeight = canvasHeight;\n      imgWidth = imgHeight / imageAspectRatio;\n    }\n\n    var scalar = Math.max(canvasWidth / imgWidth, canvasHeight / imgHeight);\n    var width = image.width / (zoom * scalar * imgWidth);\n    var height = width * canvasAspectRatio;\n    return {\n      width: width,\n      height: height\n    };\n  };\n\n  var getImageRectZoomFactor = function getImageRectZoomFactor(imageRect, cropRect, rotation, center) {\n    // calculate available space round image center position\n    var cx = center.x > 0.5 ? 1 - center.x : center.x;\n    var cy = center.y > 0.5 ? 1 - center.y : center.y;\n    var imageWidth = cx * 2 * imageRect.width;\n    var imageHeight = cy * 2 * imageRect.height; // calculate rotated crop rectangle size\n\n    var rotatedCropSize = getRotatedRectSize(cropRect, rotation); // calculate scalar required to fit image\n\n    return Math.max(rotatedCropSize.width / imageWidth, rotatedCropSize.height / imageHeight);\n  };\n\n  var getCenteredCropRect = function getCenteredCropRect(container, aspectRatio) {\n    var width = container.width;\n    var height = width * aspectRatio;\n\n    if (height > container.height) {\n      height = container.height;\n      width = height / aspectRatio;\n    }\n\n    var x = (container.width - width) * 0.5;\n    var y = (container.height - height) * 0.5;\n    return {\n      x: x,\n      y: y,\n      width: width,\n      height: height\n    };\n  };\n\n  var getCurrentCropSize = function getCurrentCropSize(imageSize) {\n    var crop = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var zoom = crop.zoom,\n        rotation = crop.rotation,\n        center = crop.center,\n        aspectRatio = crop.aspectRatio;\n    if (!aspectRatio) aspectRatio = imageSize.height / imageSize.width;\n    var canvasSize = calculateCanvasSize(imageSize, aspectRatio, zoom);\n    var canvasCenter = {\n      x: canvasSize.width * 0.5,\n      y: canvasSize.height * 0.5\n    };\n    var stage = {\n      x: 0,\n      y: 0,\n      width: canvasSize.width,\n      height: canvasSize.height,\n      center: canvasCenter\n    };\n    var shouldLimit = typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;\n    var stageZoomFactor = getImageRectZoomFactor(imageSize, getCenteredCropRect(stage, aspectRatio), rotation, shouldLimit ? center : {\n      x: 0.5,\n      y: 0.5\n    });\n    var scale = zoom * stageZoomFactor; // start drawing\n\n    return {\n      widthFloat: canvasSize.width / scale,\n      heightFloat: canvasSize.height / scale,\n      width: Math.round(canvasSize.width / scale),\n      height: Math.round(canvasSize.height / scale)\n    };\n  };\n\n  var IMAGE_SCALE_SPRING_PROPS = {\n    type: 'spring',\n    stiffness: 0.5,\n    damping: 0.45,\n    mass: 10\n  }; // does horizontal and vertical flipping\n\n  var createBitmapView = function createBitmapView(_) {\n    return _.utils.createView({\n      name: 'image-bitmap',\n      ignoreRect: true,\n      mixins: {\n        styles: ['scaleX', 'scaleY']\n      },\n      create: function create(_ref) {\n        var root = _ref.root,\n            props = _ref.props;\n        root.appendChild(props.image);\n      }\n    });\n  }; // shifts and rotates image\n\n\n  var createImageCanvasWrapper = function createImageCanvasWrapper(_) {\n    return _.utils.createView({\n      name: 'image-canvas-wrapper',\n      tag: 'div',\n      ignoreRect: true,\n      mixins: {\n        apis: ['crop', 'width', 'height'],\n        styles: ['originX', 'originY', 'translateX', 'translateY', 'scaleX', 'scaleY', 'rotateZ'],\n        animations: {\n          originX: IMAGE_SCALE_SPRING_PROPS,\n          originY: IMAGE_SCALE_SPRING_PROPS,\n          scaleX: IMAGE_SCALE_SPRING_PROPS,\n          scaleY: IMAGE_SCALE_SPRING_PROPS,\n          translateX: IMAGE_SCALE_SPRING_PROPS,\n          translateY: IMAGE_SCALE_SPRING_PROPS,\n          rotateZ: IMAGE_SCALE_SPRING_PROPS\n        }\n      },\n      create: function create(_ref2) {\n        var root = _ref2.root,\n            props = _ref2.props;\n        props.width = props.image.width;\n        props.height = props.image.height;\n        root.ref.bitmap = root.appendChildView(root.createChildView(createBitmapView(_), {\n          image: props.image\n        }));\n      },\n      write: function write(_ref3) {\n        var root = _ref3.root,\n            props = _ref3.props;\n        var flip = props.crop.flip;\n        var bitmap = root.ref.bitmap;\n        bitmap.scaleX = flip.horizontal ? -1 : 1;\n        bitmap.scaleY = flip.vertical ? -1 : 1;\n      }\n    });\n  }; // clips canvas to correct aspect ratio\n\n\n  var createClipView = function createClipView(_) {\n    return _.utils.createView({\n      name: 'image-clip',\n      tag: 'div',\n      ignoreRect: true,\n      mixins: {\n        apis: ['crop', 'markup', 'resize', 'width', 'height', 'dirty', 'background'],\n        styles: ['width', 'height', 'opacity'],\n        animations: {\n          opacity: {\n            type: 'tween',\n            duration: 250\n          }\n        }\n      },\n      didWriteView: function didWriteView(_ref4) {\n        var root = _ref4.root,\n            props = _ref4.props;\n        if (!props.background) return;\n        root.element.style.backgroundColor = props.background;\n      },\n      create: function create(_ref5) {\n        var root = _ref5.root,\n            props = _ref5.props;\n        root.ref.image = root.appendChildView(root.createChildView(createImageCanvasWrapper(_), Object.assign({}, props)));\n\n        root.ref.createMarkup = function () {\n          if (root.ref.markup) return;\n          root.ref.markup = root.appendChildView(root.createChildView(createMarkupView(_), Object.assign({}, props)));\n        };\n\n        root.ref.destroyMarkup = function () {\n          if (!root.ref.markup) return;\n          root.removeChildView(root.ref.markup);\n          root.ref.markup = null;\n        }; // set up transparency grid\n\n\n        var transparencyIndicator = root.query('GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR');\n        if (transparencyIndicator === null) return; // grid pattern\n\n        if (transparencyIndicator === 'grid') {\n          root.element.dataset.transparencyIndicator = transparencyIndicator;\n        } // basic color\n        else {\n            root.element.dataset.transparencyIndicator = 'color';\n          }\n      },\n      write: function write(_ref6) {\n        var root = _ref6.root,\n            props = _ref6.props,\n            shouldOptimize = _ref6.shouldOptimize;\n        var crop = props.crop,\n            markup = props.markup,\n            resize = props.resize,\n            dirty = props.dirty,\n            width = props.width,\n            height = props.height;\n        root.ref.image.crop = crop;\n        var stage = {\n          x: 0,\n          y: 0,\n          width: width,\n          height: height,\n          center: {\n            x: width * 0.5,\n            y: height * 0.5\n          }\n        };\n        var image = {\n          width: root.ref.image.width,\n          height: root.ref.image.height\n        };\n        var origin = {\n          x: crop.center.x * image.width,\n          y: crop.center.y * image.height\n        };\n        var translation = {\n          x: stage.center.x - image.width * crop.center.x,\n          y: stage.center.y - image.height * crop.center.y\n        };\n        var rotation = Math.PI * 2 + crop.rotation % (Math.PI * 2);\n        var cropAspectRatio = crop.aspectRatio || image.height / image.width;\n        var shouldLimit = typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;\n        var stageZoomFactor = getImageRectZoomFactor(image, getCenteredCropRect(stage, cropAspectRatio), rotation, shouldLimit ? crop.center : {\n          x: 0.5,\n          y: 0.5\n        });\n        var scale = crop.zoom * stageZoomFactor; // update markup view\n\n        if (markup && markup.length) {\n          root.ref.createMarkup();\n          root.ref.markup.width = width;\n          root.ref.markup.height = height;\n          root.ref.markup.resize = resize;\n          root.ref.markup.dirty = dirty;\n          root.ref.markup.markup = markup;\n          root.ref.markup.crop = getCurrentCropSize(image, crop);\n        } else if (root.ref.markup) {\n          root.ref.destroyMarkup();\n        } // update image view\n\n\n        var imageView = root.ref.image; // don't update clip layout\n\n        if (shouldOptimize) {\n          imageView.originX = null;\n          imageView.originY = null;\n          imageView.translateX = null;\n          imageView.translateY = null;\n          imageView.rotateZ = null;\n          imageView.scaleX = null;\n          imageView.scaleY = null;\n          return;\n        }\n\n        imageView.originX = origin.x;\n        imageView.originY = origin.y;\n        imageView.translateX = translation.x;\n        imageView.translateY = translation.y;\n        imageView.rotateZ = rotation;\n        imageView.scaleX = scale;\n        imageView.scaleY = scale;\n      }\n    });\n  };\n\n  var createImageView = function createImageView(_) {\n    return _.utils.createView({\n      name: 'image-preview',\n      tag: 'div',\n      ignoreRect: true,\n      mixins: {\n        apis: ['image', 'crop', 'markup', 'resize', 'dirty', 'background'],\n        styles: ['translateY', 'scaleX', 'scaleY', 'opacity'],\n        animations: {\n          scaleX: IMAGE_SCALE_SPRING_PROPS,\n          scaleY: IMAGE_SCALE_SPRING_PROPS,\n          translateY: IMAGE_SCALE_SPRING_PROPS,\n          opacity: {\n            type: 'tween',\n            duration: 400\n          }\n        }\n      },\n      create: function create(_ref7) {\n        var root = _ref7.root,\n            props = _ref7.props;\n        root.ref.clip = root.appendChildView(root.createChildView(createClipView(_), {\n          id: props.id,\n          image: props.image,\n          crop: props.crop,\n          markup: props.markup,\n          resize: props.resize,\n          dirty: props.dirty,\n          background: props.background\n        }));\n      },\n      write: function write(_ref8) {\n        var root = _ref8.root,\n            props = _ref8.props,\n            shouldOptimize = _ref8.shouldOptimize;\n        var clip = root.ref.clip;\n        var image = props.image,\n            crop = props.crop,\n            markup = props.markup,\n            resize = props.resize,\n            dirty = props.dirty;\n        clip.crop = crop;\n        clip.markup = markup;\n        clip.resize = resize;\n        clip.dirty = dirty; // don't update clip layout\n\n        clip.opacity = shouldOptimize ? 0 : 1; // don't re-render if optimizing or hidden (width will be zero resulting in weird animations)\n\n        if (shouldOptimize || root.rect.element.hidden) return; // calculate scaled preview image size\n\n        var imageAspectRatio = image.height / image.width;\n        var aspectRatio = crop.aspectRatio || imageAspectRatio; // calculate container size\n\n        var containerWidth = root.rect.inner.width;\n        var containerHeight = root.rect.inner.height;\n        var fixedPreviewHeight = root.query('GET_IMAGE_PREVIEW_HEIGHT');\n        var minPreviewHeight = root.query('GET_IMAGE_PREVIEW_MIN_HEIGHT');\n        var maxPreviewHeight = root.query('GET_IMAGE_PREVIEW_MAX_HEIGHT');\n        var panelAspectRatio = root.query('GET_PANEL_ASPECT_RATIO');\n        var allowMultiple = root.query('GET_ALLOW_MULTIPLE');\n\n        if (panelAspectRatio && !allowMultiple) {\n          fixedPreviewHeight = containerWidth * panelAspectRatio;\n          aspectRatio = panelAspectRatio;\n        } // determine clip width and height\n\n\n        var clipHeight = fixedPreviewHeight !== null ? fixedPreviewHeight : Math.max(minPreviewHeight, Math.min(containerWidth * aspectRatio, maxPreviewHeight));\n        var clipWidth = clipHeight / aspectRatio;\n\n        if (clipWidth > containerWidth) {\n          clipWidth = containerWidth;\n          clipHeight = clipWidth * aspectRatio;\n        }\n\n        if (clipHeight > containerHeight) {\n          clipHeight = containerHeight;\n          clipWidth = containerHeight / aspectRatio;\n        }\n\n        clip.width = clipWidth;\n        clip.height = clipHeight;\n      }\n    });\n  };\n\n  var SVG_MASK = '<svg width=\"500\" height=\"200\" viewBox=\"0 0 500 200\" preserveAspectRatio=\"none\">\\n    <defs>\\n        <radialGradient id=\"gradient-__UID__\" cx=\".5\" cy=\"1.25\" r=\"1.15\">\\n            <stop offset=\\'50%\\' stop-color=\\'#000000\\'/>\\n            <stop offset=\\'56%\\' stop-color=\\'#0a0a0a\\'/>\\n            <stop offset=\\'63%\\' stop-color=\\'#262626\\'/>\\n            <stop offset=\\'69%\\' stop-color=\\'#4f4f4f\\'/>\\n            <stop offset=\\'75%\\' stop-color=\\'#808080\\'/>\\n            <stop offset=\\'81%\\' stop-color=\\'#b1b1b1\\'/>\\n            <stop offset=\\'88%\\' stop-color=\\'#dadada\\'/>\\n            <stop offset=\\'94%\\' stop-color=\\'#f6f6f6\\'/>\\n            <stop offset=\\'100%\\' stop-color=\\'#ffffff\\'/>\\n        </radialGradient>\\n        <mask id=\"mask-__UID__\">\\n            <rect x=\"0\" y=\"0\" width=\"500\" height=\"200\" fill=\"url(#gradient-__UID__)\"></rect>\\n        </mask>\\n    </defs>\\n    <rect x=\"0\" width=\"500\" height=\"200\" fill=\"currentColor\" mask=\"url(#mask-__UID__)\"></rect>\\n</svg>';\n  var SVGMaskUniqueId = 0;\n\n  var createImageOverlayView = function createImageOverlayView(fpAPI) {\n    return fpAPI.utils.createView({\n      name: 'image-preview-overlay',\n      tag: 'div',\n      ignoreRect: true,\n      create: function create(_ref) {\n        var root = _ref.root,\n            props = _ref.props;\n        var mask = SVG_MASK;\n\n        if (document.querySelector('base')) {\n          var url = window.location.href.replace(window.location.hash, '');\n          mask = mask.replace(/url\\(\\#/g, 'url(' + url + '#');\n        }\n\n        SVGMaskUniqueId++;\n        root.element.classList.add('filepond--image-preview-overlay-'.concat(props.status));\n        root.element.innerHTML = mask.replace(/__UID__/g, SVGMaskUniqueId);\n      },\n      mixins: {\n        styles: ['opacity'],\n        animations: {\n          opacity: {\n            type: 'spring',\n            mass: 25\n          }\n        }\n      }\n    });\n  };\n  /**\n   * Bitmap Worker\n   */\n\n\n  var BitmapWorker = function BitmapWorker() {\n    self.onmessage = function (e) {\n      createImageBitmap(e.data.message.file).then(function (bitmap) {\n        self.postMessage({\n          id: e.data.id,\n          message: bitmap\n        }, [bitmap]);\n      });\n    };\n  };\n  /**\n   * ColorMatrix Worker\n   */\n\n\n  var ColorMatrixWorker = function ColorMatrixWorker() {\n    self.onmessage = function (e) {\n      var imageData = e.data.message.imageData;\n      var matrix = e.data.message.colorMatrix;\n      var data = imageData.data;\n      var l = data.length;\n      var m11 = matrix[0];\n      var m12 = matrix[1];\n      var m13 = matrix[2];\n      var m14 = matrix[3];\n      var m15 = matrix[4];\n      var m21 = matrix[5];\n      var m22 = matrix[6];\n      var m23 = matrix[7];\n      var m24 = matrix[8];\n      var m25 = matrix[9];\n      var m31 = matrix[10];\n      var m32 = matrix[11];\n      var m33 = matrix[12];\n      var m34 = matrix[13];\n      var m35 = matrix[14];\n      var m41 = matrix[15];\n      var m42 = matrix[16];\n      var m43 = matrix[17];\n      var m44 = matrix[18];\n      var m45 = matrix[19];\n      var index = 0,\n          r = 0.0,\n          g = 0.0,\n          b = 0.0,\n          a = 0.0;\n\n      for (; index < l; index += 4) {\n        r = data[index] / 255;\n        g = data[index + 1] / 255;\n        b = data[index + 2] / 255;\n        a = data[index + 3] / 255;\n        data[index] = Math.max(0, Math.min((r * m11 + g * m12 + b * m13 + a * m14 + m15) * 255, 255));\n        data[index + 1] = Math.max(0, Math.min((r * m21 + g * m22 + b * m23 + a * m24 + m25) * 255, 255));\n        data[index + 2] = Math.max(0, Math.min((r * m31 + g * m32 + b * m33 + a * m34 + m35) * 255, 255));\n        data[index + 3] = Math.max(0, Math.min((r * m41 + g * m42 + b * m43 + a * m44 + m45) * 255, 255));\n      }\n\n      self.postMessage({\n        id: e.data.id,\n        message: imageData\n      }, [imageData.data.buffer]);\n    };\n  };\n\n  var getImageSize = function getImageSize(url, cb) {\n    var image = new Image();\n\n    image.onload = function () {\n      var width = image.naturalWidth;\n      var height = image.naturalHeight;\n      image = null;\n      cb(width, height);\n    };\n\n    image.src = url;\n  };\n\n  var transforms = {\n    1: function _() {\n      return [1, 0, 0, 1, 0, 0];\n    },\n    2: function _(width) {\n      return [-1, 0, 0, 1, width, 0];\n    },\n    3: function _(width, height) {\n      return [-1, 0, 0, -1, width, height];\n    },\n    4: function _(width, height) {\n      return [1, 0, 0, -1, 0, height];\n    },\n    5: function _() {\n      return [0, 1, 1, 0, 0, 0];\n    },\n    6: function _(width, height) {\n      return [0, 1, -1, 0, height, 0];\n    },\n    7: function _(width, height) {\n      return [0, -1, -1, 0, height, width];\n    },\n    8: function _(width) {\n      return [0, -1, 1, 0, 0, width];\n    }\n  };\n\n  var fixImageOrientation = function fixImageOrientation(ctx, width, height, orientation) {\n    // no orientation supplied\n    if (orientation === -1) {\n      return;\n    }\n\n    ctx.transform.apply(ctx, transforms[orientation](width, height));\n  }; // draws the preview image to canvas\n\n\n  var createPreviewImage = function createPreviewImage(data, width, height, orientation) {\n    // can't draw on half pixels\n    width = Math.round(width);\n    height = Math.round(height); // draw image\n\n    var canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    var ctx = canvas.getContext('2d'); // if is rotated incorrectly swap width and height\n\n    if (orientation >= 5 && orientation <= 8) {\n      var _ref = [height, width];\n      width = _ref[0];\n      height = _ref[1];\n    } // correct image orientation\n\n\n    fixImageOrientation(ctx, width, height, orientation); // draw the image\n\n    ctx.drawImage(data, 0, 0, width, height);\n    return canvas;\n  };\n\n  var isBitmap = function isBitmap(file) {\n    return /^image/.test(file.type) && !/svg/.test(file.type);\n  };\n\n  var MAX_WIDTH = 10;\n  var MAX_HEIGHT = 10;\n\n  var calculateAverageColor = function calculateAverageColor(image) {\n    var scalar = Math.min(MAX_WIDTH / image.width, MAX_HEIGHT / image.height);\n    var canvas = document.createElement('canvas');\n    var ctx = canvas.getContext('2d');\n    var width = canvas.width = Math.ceil(image.width * scalar);\n    var height = canvas.height = Math.ceil(image.height * scalar);\n    ctx.drawImage(image, 0, 0, width, height);\n    var data = null;\n\n    try {\n      data = ctx.getImageData(0, 0, width, height).data;\n    } catch (e) {\n      return null;\n    }\n\n    var l = data.length;\n    var r = 0;\n    var g = 0;\n    var b = 0;\n    var i = 0;\n\n    for (; i < l; i += 4) {\n      r += data[i] * data[i];\n      g += data[i + 1] * data[i + 1];\n      b += data[i + 2] * data[i + 2];\n    }\n\n    r = averageColor(r, l);\n    g = averageColor(g, l);\n    b = averageColor(b, l);\n    return {\n      r: r,\n      g: g,\n      b: b\n    };\n  };\n\n  var averageColor = function averageColor(c, l) {\n    return Math.floor(Math.sqrt(c / (l / 4)));\n  };\n\n  var cloneCanvas = function cloneCanvas(origin, target) {\n    target = target || document.createElement('canvas');\n    target.width = origin.width;\n    target.height = origin.height;\n    var ctx = target.getContext('2d');\n    ctx.drawImage(origin, 0, 0);\n    return target;\n  };\n\n  var cloneImageData = function cloneImageData(imageData) {\n    var id;\n\n    try {\n      id = new ImageData(imageData.width, imageData.height);\n    } catch (e) {\n      var canvas = document.createElement('canvas');\n      var ctx = canvas.getContext('2d');\n      id = ctx.createImageData(imageData.width, imageData.height);\n    }\n\n    id.data.set(new Uint8ClampedArray(imageData.data));\n    return id;\n  };\n\n  var loadImage = function loadImage(url) {\n    return new Promise(function (resolve, reject) {\n      var img = new Image();\n      img.crossOrigin = 'Anonymous';\n\n      img.onload = function () {\n        resolve(img);\n      };\n\n      img.onerror = function (e) {\n        reject(e);\n      };\n\n      img.src = url;\n    });\n  };\n\n  var createImageWrapperView = function createImageWrapperView(_) {\n    // create overlay view\n    var OverlayView = createImageOverlayView(_);\n    var ImageView = createImageView(_);\n    var createWorker = _.utils.createWorker;\n\n    var applyFilter = function applyFilter(root, filter, target) {\n      return new Promise(function (resolve) {\n        // will store image data for future filter updates\n        if (!root.ref.imageData) {\n          root.ref.imageData = target.getContext('2d').getImageData(0, 0, target.width, target.height);\n        } // get image data reference\n\n\n        var imageData = cloneImageData(root.ref.imageData);\n\n        if (!filter || filter.length !== 20) {\n          target.getContext('2d').putImageData(imageData, 0, 0);\n          return resolve();\n        }\n\n        var worker = createWorker(ColorMatrixWorker);\n        worker.post({\n          imageData: imageData,\n          colorMatrix: filter\n        }, function (response) {\n          // apply filtered colors\n          target.getContext('2d').putImageData(response, 0, 0); // stop worker\n\n          worker.terminate(); // done!\n\n          resolve();\n        }, [imageData.data.buffer]);\n      });\n    };\n\n    var removeImageView = function removeImageView(root, imageView) {\n      root.removeChildView(imageView);\n      imageView.image.width = 1;\n      imageView.image.height = 1;\n\n      imageView._destroy();\n    }; // remove an image\n\n\n    var shiftImage = function shiftImage(_ref) {\n      var root = _ref.root;\n      var imageView = root.ref.images.shift();\n      imageView.opacity = 0;\n      imageView.translateY = -15;\n      root.ref.imageViewBin.push(imageView);\n      return imageView;\n    }; // add new image\n\n\n    var pushImage = function pushImage(_ref2) {\n      var root = _ref2.root,\n          props = _ref2.props,\n          image = _ref2.image;\n      var id = props.id;\n      var item = root.query('GET_ITEM', {\n        id: id\n      });\n      if (!item) return;\n      var crop = item.getMetadata('crop') || {\n        center: {\n          x: 0.5,\n          y: 0.5\n        },\n        flip: {\n          horizontal: false,\n          vertical: false\n        },\n        zoom: 1,\n        rotation: 0,\n        aspectRatio: null\n      };\n      var background = root.query('GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR');\n      var markup;\n      var resize;\n      var dirty = false;\n\n      if (root.query('GET_IMAGE_PREVIEW_MARKUP_SHOW')) {\n        markup = item.getMetadata('markup') || [];\n        resize = item.getMetadata('resize');\n        dirty = true;\n      } // append image presenter\n\n\n      var imageView = root.appendChildView(root.createChildView(ImageView, {\n        id: id,\n        image: image,\n        crop: crop,\n        resize: resize,\n        markup: markup,\n        dirty: dirty,\n        background: background,\n        opacity: 0,\n        scaleX: 1.15,\n        scaleY: 1.15,\n        translateY: 15\n      }), root.childViews.length);\n      root.ref.images.push(imageView); // reveal the preview image\n\n      imageView.opacity = 1;\n      imageView.scaleX = 1;\n      imageView.scaleY = 1;\n      imageView.translateY = 0; // the preview is now ready to be drawn\n\n      setTimeout(function () {\n        root.dispatch('DID_IMAGE_PREVIEW_SHOW', {\n          id: id\n        });\n      }, 250);\n    };\n\n    var updateImage = function updateImage(_ref3) {\n      var root = _ref3.root,\n          props = _ref3.props;\n      var item = root.query('GET_ITEM', {\n        id: props.id\n      });\n      if (!item) return;\n      var imageView = root.ref.images[root.ref.images.length - 1];\n      imageView.crop = item.getMetadata('crop');\n      imageView.background = root.query('GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR');\n\n      if (root.query('GET_IMAGE_PREVIEW_MARKUP_SHOW')) {\n        imageView.dirty = true;\n        imageView.resize = item.getMetadata('resize');\n        imageView.markup = item.getMetadata('markup');\n      }\n    }; // replace image preview\n\n\n    var didUpdateItemMetadata = function didUpdateItemMetadata(_ref4) {\n      var root = _ref4.root,\n          props = _ref4.props,\n          action = _ref4.action; // only filter and crop trigger redraw\n\n      if (!/crop|filter|markup|resize/.test(action.change.key)) return; // no images to update, exit\n\n      if (!root.ref.images.length) return; // no item found, exit\n\n      var item = root.query('GET_ITEM', {\n        id: props.id\n      });\n      if (!item) return; // for now, update existing image when filtering\n\n      if (/filter/.test(action.change.key)) {\n        var imageView = root.ref.images[root.ref.images.length - 1];\n        applyFilter(root, action.change.value, imageView.image);\n        return;\n      }\n\n      if (/crop|markup|resize/.test(action.change.key)) {\n        var crop = item.getMetadata('crop');\n        var image = root.ref.images[root.ref.images.length - 1]; // if aspect ratio has changed, we need to create a new image\n\n        if (crop && crop.aspectRatio && image.crop && image.crop.aspectRatio && Math.abs(crop.aspectRatio - image.crop.aspectRatio) > 0.00001) {\n          var _imageView = shiftImage({\n            root: root\n          });\n\n          pushImage({\n            root: root,\n            props: props,\n            image: cloneCanvas(_imageView.image)\n          });\n        } // if not, we can update the current image\n        else {\n            updateImage({\n              root: root,\n              props: props\n            });\n          }\n      }\n    };\n\n    var canCreateImageBitmap = function canCreateImageBitmap(file) {\n      // Firefox versions before 58 will freeze when running createImageBitmap\n      // in a Web Worker so we detect those versions and return false for support\n      var userAgent = window.navigator.userAgent;\n      var isFirefox = userAgent.match(/Firefox\\/([0-9]+)\\./);\n      var firefoxVersion = isFirefox ? parseInt(isFirefox[1]) : null;\n      if (firefoxVersion <= 58) return false;\n      return 'createImageBitmap' in window && isBitmap(file);\n    };\n    /**\n     * Write handler for when preview container has been created\n     */\n\n\n    var didCreatePreviewContainer = function didCreatePreviewContainer(_ref5) {\n      var root = _ref5.root,\n          props = _ref5.props;\n      var id = props.id; // we need to get the file data to determine the eventual image size\n\n      var item = root.query('GET_ITEM', id);\n      if (!item) return; // get url to file (we'll revoke it later on when done)\n\n      var fileURL = URL.createObjectURL(item.file); // determine image size of this item\n\n      getImageSize(fileURL, function (width, height) {\n        // we can now scale the panel to the final size\n        root.dispatch('DID_IMAGE_PREVIEW_CALCULATE_SIZE', {\n          id: id,\n          width: width,\n          height: height\n        });\n      });\n    };\n\n    var drawPreview = function drawPreview(_ref6) {\n      var root = _ref6.root,\n          props = _ref6.props;\n      var id = props.id; // we need to get the file data to determine the eventual image size\n\n      var item = root.query('GET_ITEM', id);\n      if (!item) return; // get url to file (we'll revoke it later on when done)\n\n      var fileURL = URL.createObjectURL(item.file); // fallback\n\n      var loadPreviewFallback = function loadPreviewFallback() {\n        // let's scale the image in the main thread :(\n        loadImage(fileURL).then(previewImageLoaded);\n      }; // image is now ready\n\n\n      var previewImageLoaded = function previewImageLoaded(imageData) {\n        // the file url is no longer needed\n        URL.revokeObjectURL(fileURL); // draw the scaled down version here and use that as source so bitmapdata can be closed\n        // orientation info\n\n        var exif = item.getMetadata('exif') || {};\n        var orientation = exif.orientation || -1; // get width and height from action, and swap if orientation is incorrect\n\n        var width = imageData.width,\n            height = imageData.height; // if no width or height, just return early.\n\n        if (!width || !height) return;\n\n        if (orientation >= 5 && orientation <= 8) {\n          var _ref7 = [height, width];\n          width = _ref7[0];\n          height = _ref7[1];\n        } // scale canvas based on pixel density\n        // we multiply by .75 as that creates smaller but still clear images on screens with high res displays\n\n\n        var pixelDensityFactor = Math.max(1, window.devicePixelRatio * 0.75); // we want as much pixels to work with as possible,\n        // this multiplies the minimum image resolution,\n        // so when zooming in it doesn't get too blurry\n\n        var zoomFactor = root.query('GET_IMAGE_PREVIEW_ZOOM_FACTOR'); // imaeg scale factor\n\n        var scaleFactor = zoomFactor * pixelDensityFactor; // calculate scaled preview image size\n\n        var previewImageRatio = height / width; // calculate image preview height and width\n\n        var previewContainerWidth = root.rect.element.width;\n        var previewContainerHeight = root.rect.element.height;\n        var imageWidth = previewContainerWidth;\n        var imageHeight = imageWidth * previewImageRatio;\n\n        if (previewImageRatio > 1) {\n          imageWidth = Math.min(width, previewContainerWidth * scaleFactor);\n          imageHeight = imageWidth * previewImageRatio;\n        } else {\n          imageHeight = Math.min(height, previewContainerHeight * scaleFactor);\n          imageWidth = imageHeight / previewImageRatio;\n        } // transfer to image tag so no canvas memory wasted on iOS\n\n\n        var previewImage = createPreviewImage(imageData, imageWidth, imageHeight, orientation); // done\n\n        var done = function done() {\n          // calculate average image color, disabled for now\n          var averageColor = root.query('GET_IMAGE_PREVIEW_CALCULATE_AVERAGE_IMAGE_COLOR') ? calculateAverageColor(data) : null;\n          item.setMetadata('color', averageColor, true); // data has been transferred to canvas ( if was ImageBitmap )\n\n          if ('close' in imageData) {\n            imageData.close();\n          } // show the overlay\n\n\n          root.ref.overlayShadow.opacity = 1; // create the first image\n\n          pushImage({\n            root: root,\n            props: props,\n            image: previewImage\n          });\n        }; // apply filter\n\n\n        var filter = item.getMetadata('filter');\n\n        if (filter) {\n          applyFilter(root, filter, previewImage).then(done);\n        } else {\n          done();\n        }\n      }; // if we support scaling using createImageBitmap we use a worker\n\n\n      if (canCreateImageBitmap(item.file)) {\n        // let's scale the image in a worker\n        var worker = createWorker(BitmapWorker);\n        worker.post({\n          file: item.file\n        }, function (imageBitmap) {\n          // destroy worker\n          worker.terminate(); // no bitmap returned, must be something wrong,\n          // try the oldschool way\n\n          if (!imageBitmap) {\n            loadPreviewFallback();\n            return;\n          } // yay we got our bitmap, let's continue showing the preview\n\n\n          previewImageLoaded(imageBitmap);\n        });\n      } else {\n        // create fallback preview\n        loadPreviewFallback();\n      }\n    };\n    /**\n     * Write handler for when the preview image is ready to be animated\n     */\n\n\n    var didDrawPreview = function didDrawPreview(_ref8) {\n      var root = _ref8.root; // get last added image\n\n      var image = root.ref.images[root.ref.images.length - 1];\n      image.translateY = 0;\n      image.scaleX = 1.0;\n      image.scaleY = 1.0;\n      image.opacity = 1;\n    };\n    /**\n     * Write handler for when the preview has been loaded\n     */\n\n\n    var restoreOverlay = function restoreOverlay(_ref9) {\n      var root = _ref9.root;\n      root.ref.overlayShadow.opacity = 1;\n      root.ref.overlayError.opacity = 0;\n      root.ref.overlaySuccess.opacity = 0;\n    };\n\n    var didThrowError = function didThrowError(_ref10) {\n      var root = _ref10.root;\n      root.ref.overlayShadow.opacity = 0.25;\n      root.ref.overlayError.opacity = 1;\n    };\n\n    var didCompleteProcessing = function didCompleteProcessing(_ref11) {\n      var root = _ref11.root;\n      root.ref.overlayShadow.opacity = 0.25;\n      root.ref.overlaySuccess.opacity = 1;\n    };\n    /**\n     * Constructor\n     */\n\n\n    var create = function create(_ref12) {\n      var root = _ref12.root; // image view\n\n      root.ref.images = []; // the preview image data (we need this to filter the image)\n\n      root.ref.imageData = null; // image bin\n\n      root.ref.imageViewBin = []; // image overlays\n\n      root.ref.overlayShadow = root.appendChildView(root.createChildView(OverlayView, {\n        opacity: 0,\n        status: 'idle'\n      }));\n      root.ref.overlaySuccess = root.appendChildView(root.createChildView(OverlayView, {\n        opacity: 0,\n        status: 'success'\n      }));\n      root.ref.overlayError = root.appendChildView(root.createChildView(OverlayView, {\n        opacity: 0,\n        status: 'failure'\n      }));\n    };\n\n    return _.utils.createView({\n      name: 'image-preview-wrapper',\n      create: create,\n      styles: ['height'],\n      apis: ['height'],\n      destroy: function destroy(_ref13) {\n        var root = _ref13.root; // we resize the image so memory on iOS 12 is released more quickly (it seems)\n\n        root.ref.images.forEach(function (imageView) {\n          imageView.image.width = 1;\n          imageView.image.height = 1;\n        });\n      },\n      didWriteView: function didWriteView(_ref14) {\n        var root = _ref14.root;\n        root.ref.images.forEach(function (imageView) {\n          imageView.dirty = false;\n        });\n      },\n      write: _.utils.createRoute({\n        // image preview stated\n        DID_IMAGE_PREVIEW_DRAW: didDrawPreview,\n        DID_IMAGE_PREVIEW_CONTAINER_CREATE: didCreatePreviewContainer,\n        DID_FINISH_CALCULATE_PREVIEWSIZE: drawPreview,\n        DID_UPDATE_ITEM_METADATA: didUpdateItemMetadata,\n        // file states\n        DID_THROW_ITEM_LOAD_ERROR: didThrowError,\n        DID_THROW_ITEM_PROCESSING_ERROR: didThrowError,\n        DID_THROW_ITEM_INVALID: didThrowError,\n        DID_COMPLETE_ITEM_PROCESSING: didCompleteProcessing,\n        DID_START_ITEM_PROCESSING: restoreOverlay,\n        DID_REVERT_ITEM_PROCESSING: restoreOverlay\n      }, function (_ref15) {\n        var root = _ref15.root; // views on death row\n\n        var viewsToRemove = root.ref.imageViewBin.filter(function (imageView) {\n          return imageView.opacity === 0;\n        }); // views to retain\n\n        root.ref.imageViewBin = root.ref.imageViewBin.filter(function (imageView) {\n          return imageView.opacity > 0;\n        }); // remove these views\n\n        viewsToRemove.forEach(function (imageView) {\n          return removeImageView(root, imageView);\n        });\n        viewsToRemove.length = 0;\n      })\n    });\n  };\n  /**\n   * Image Preview Plugin\n   */\n\n\n  var plugin = function plugin(fpAPI) {\n    var addFilter = fpAPI.addFilter,\n        utils = fpAPI.utils;\n    var Type = utils.Type,\n        createRoute = utils.createRoute,\n        isFile = utils.isFile; // imagePreviewView\n\n    var imagePreviewView = createImageWrapperView(fpAPI); // called for each view that is created right after the 'create' method\n\n    addFilter('CREATE_VIEW', function (viewAPI) {\n      // get reference to created view\n      var is = viewAPI.is,\n          view = viewAPI.view,\n          query = viewAPI.query; // only hook up to item view and only if is enabled for this cropper\n\n      if (!is('file') || !query('GET_ALLOW_IMAGE_PREVIEW')) return; // create the image preview plugin, but only do so if the item is an image\n\n      var didLoadItem = function didLoadItem(_ref) {\n        var root = _ref.root,\n            props = _ref.props;\n        var id = props.id;\n        var item = query('GET_ITEM', id); // item could theoretically have been removed in the mean time\n\n        if (!item || !isFile(item.file) || item.archived) return; // get the file object\n\n        var file = item.file; // exit if this is not an image\n\n        if (!isPreviewableImage(file)) return; // test if is filtered\n\n        if (!query('GET_IMAGE_PREVIEW_FILTER_ITEM')(item)) return; // exit if image size is too high and no createImageBitmap support\n        // this would simply bring the browser to its knees and that is not what we want\n\n        var supportsCreateImageBitmap = ('createImageBitmap' in (window || {}));\n        var maxPreviewFileSize = query('GET_IMAGE_PREVIEW_MAX_FILE_SIZE');\n        if (!supportsCreateImageBitmap && maxPreviewFileSize && file.size > maxPreviewFileSize) return; // set preview view\n\n        root.ref.imagePreview = view.appendChildView(view.createChildView(imagePreviewView, {\n          id: id\n        })); // update height if is fixed\n\n        var fixedPreviewHeight = root.query('GET_IMAGE_PREVIEW_HEIGHT');\n\n        if (fixedPreviewHeight) {\n          root.dispatch('DID_UPDATE_PANEL_HEIGHT', {\n            id: item.id,\n            height: fixedPreviewHeight\n          });\n        } // now ready\n\n\n        var queue = !supportsCreateImageBitmap && file.size > query('GET_IMAGE_PREVIEW_MAX_INSTANT_PREVIEW_FILE_SIZE');\n        root.dispatch('DID_IMAGE_PREVIEW_CONTAINER_CREATE', {\n          id: id\n        }, queue);\n      };\n\n      var rescaleItem = function rescaleItem(root, props) {\n        if (!root.ref.imagePreview) return;\n        var id = props.id; // get item\n\n        var item = root.query('GET_ITEM', {\n          id: id\n        });\n        if (!item) return; // if is fixed height or panel has aspect ratio, exit here, height has already been defined\n\n        var panelAspectRatio = root.query('GET_PANEL_ASPECT_RATIO');\n        var itemPanelAspectRatio = root.query('GET_ITEM_PANEL_ASPECT_RATIO');\n        var fixedHeight = root.query('GET_IMAGE_PREVIEW_HEIGHT');\n        if (panelAspectRatio || itemPanelAspectRatio || fixedHeight) return; // no data!\n\n        var _root$ref = root.ref,\n            imageWidth = _root$ref.imageWidth,\n            imageHeight = _root$ref.imageHeight;\n        if (!imageWidth || !imageHeight) return; // get height min and max\n\n        var minPreviewHeight = root.query('GET_IMAGE_PREVIEW_MIN_HEIGHT');\n        var maxPreviewHeight = root.query('GET_IMAGE_PREVIEW_MAX_HEIGHT'); // orientation info\n\n        var exif = item.getMetadata('exif') || {};\n        var orientation = exif.orientation || -1; // get width and height from action, and swap of orientation is incorrect\n\n        if (orientation >= 5 && orientation <= 8) {\n          var _ref2 = [imageHeight, imageWidth];\n          imageWidth = _ref2[0];\n          imageHeight = _ref2[1];\n        } // scale up width and height when we're dealing with an SVG\n\n\n        if (!isBitmap(item.file) || root.query('GET_IMAGE_PREVIEW_UPSCALE')) {\n          var scalar = 2048 / imageWidth;\n          imageWidth *= scalar;\n          imageHeight *= scalar;\n        } // image aspect ratio\n\n\n        var imageAspectRatio = imageHeight / imageWidth; // we need the item to get to the crop size\n\n        var previewAspectRatio = (item.getMetadata('crop') || {}).aspectRatio || imageAspectRatio; // preview height range\n\n        var previewHeightMax = Math.max(minPreviewHeight, Math.min(imageHeight, maxPreviewHeight));\n        var itemWidth = root.rect.element.width;\n        var previewHeight = Math.min(itemWidth * previewAspectRatio, previewHeightMax); // request update to panel height\n\n        root.dispatch('DID_UPDATE_PANEL_HEIGHT', {\n          id: item.id,\n          height: previewHeight\n        });\n      };\n\n      var didResizeView = function didResizeView(_ref3) {\n        var root = _ref3.root; // actions in next write operation\n\n        root.ref.shouldRescale = true;\n      };\n\n      var didUpdateItemMetadata = function didUpdateItemMetadata(_ref4) {\n        var root = _ref4.root,\n            action = _ref4.action;\n        if (action.change.key !== 'crop') return; // actions in next write operation\n\n        root.ref.shouldRescale = true;\n      };\n\n      var didCalculatePreviewSize = function didCalculatePreviewSize(_ref5) {\n        var root = _ref5.root,\n            action = _ref5.action; // remember dimensions\n\n        root.ref.imageWidth = action.width;\n        root.ref.imageHeight = action.height; // actions in next write operation\n\n        root.ref.shouldRescale = true;\n        root.ref.shouldDrawPreview = true; // as image load could take a while and fire when draw loop is resting we need to give it a kick\n\n        root.dispatch('KICK');\n      }; // start writing\n\n\n      view.registerWriter(createRoute({\n        DID_RESIZE_ROOT: didResizeView,\n        DID_STOP_RESIZE: didResizeView,\n        DID_LOAD_ITEM: didLoadItem,\n        DID_IMAGE_PREVIEW_CALCULATE_SIZE: didCalculatePreviewSize,\n        DID_UPDATE_ITEM_METADATA: didUpdateItemMetadata\n      }, function (_ref6) {\n        var root = _ref6.root,\n            props = _ref6.props; // no preview view attached\n\n        if (!root.ref.imagePreview) return; // don't do anything while hidden\n\n        if (root.rect.element.hidden) return; // resize the item panel\n\n        if (root.ref.shouldRescale) {\n          rescaleItem(root, props);\n          root.ref.shouldRescale = false;\n        }\n\n        if (root.ref.shouldDrawPreview) {\n          // queue till next frame so we're sure the height has been applied this forces the draw image call inside the wrapper view to use the correct height\n          requestAnimationFrame(function () {\n            // this requestAnimationFrame nesting is horrible but it fixes an issue with 100hz displays on Chrome\n            // https://github.com/pqina/filepond-plugin-image-preview/issues/57\n            requestAnimationFrame(function () {\n              root.dispatch('DID_FINISH_CALCULATE_PREVIEWSIZE', {\n                id: props.id\n              });\n            });\n          });\n          root.ref.shouldDrawPreview = false;\n        }\n      }));\n    }); // expose plugin\n\n    return {\n      options: {\n        // Enable or disable image preview\n        allowImagePreview: [true, Type.BOOLEAN],\n        // filters file items to determine which are shown as preview\n        imagePreviewFilterItem: [function () {\n          return true;\n        }, Type.FUNCTION],\n        // Fixed preview height\n        imagePreviewHeight: [null, Type.INT],\n        // Min image height\n        imagePreviewMinHeight: [44, Type.INT],\n        // Max image height\n        imagePreviewMaxHeight: [256, Type.INT],\n        // Max size of preview file for when createImageBitmap is not supported\n        imagePreviewMaxFileSize: [null, Type.INT],\n        // The amount of extra pixels added to the image preview to allow comfortable zooming\n        imagePreviewZoomFactor: [2, Type.INT],\n        // Should we upscale small images to fit the max bounding box of the preview area\n        imagePreviewUpscale: [false, Type.BOOLEAN],\n        // Max size of preview file that we allow to try to instant preview if createImageBitmap is not supported, else image is queued for loading\n        imagePreviewMaxInstantPreviewFileSize: [1000000, Type.INT],\n        // Style of the transparancy indicator used behind images\n        imagePreviewTransparencyIndicator: [null, Type.STRING],\n        // Enables or disables reading average image color\n        imagePreviewCalculateAverageImageColor: [false, Type.BOOLEAN],\n        // Enables or disables the previewing of markup\n        imagePreviewMarkupShow: [true, Type.BOOLEAN],\n        // Allows filtering of markup to only show certain shapes\n        imagePreviewMarkupFilter: [function () {\n          return true;\n        }, Type.FUNCTION]\n      }\n    };\n  }; // fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags\n\n\n  var isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined';\n\n  if (isBrowser) {\n    document.dispatchEvent(new CustomEvent('FilePond:pluginloaded', {\n      detail: plugin\n    }));\n  }\n\n  return plugin;\n});","map":{"version":3,"sources":["/Users/cici-psy/Documents/GitHub/arc-art-critique/arc-frontend/node_modules/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"],"names":["global","factory","exports","module","define","amd","self","FilePondPluginImagePreview","isPreviewableImage","file","test","type","_typeof","obj","Symbol","iterator","constructor","prototype","REACT_ELEMENT_TYPE","_jsx","props","key","children","for","defaultProps","childrenLength","arguments","length","propName","childArray","Array","i","$$typeof","undefined","ref","_owner","_asyncIterator","iterable","method","asyncIterator","call","TypeError","_AwaitValue","value","wrapped","_AsyncGenerator","gen","front","back","send","arg","Promise","resolve","reject","request","next","resume","result","wrappedAwait","then","settle","done","err","_invoke","return","throw","_wrapAsyncGenerator","fn","apply","_awaitAsyncGenerator","_asyncGeneratorDelegate","inner","awaitWrap","iter","waiting","pump","asyncGeneratorStep","_next","_throw","info","error","_asyncToGenerator","args","_classCallCheck","instance","Constructor","_defineProperties","target","descriptor","enumerable","configurable","writable","Object","defineProperty","_createClass","protoProps","staticProps","_defineEnumerableProperties","descs","desc","getOwnPropertySymbols","objectSymbols","sym","_defaults","defaults","keys","getOwnPropertyNames","getOwnPropertyDescriptor","_defineProperty","_extends","assign","source","hasOwnProperty","_objectSpread","ownKeys","concat","filter","forEach","_inherits","subClass","superClass","create","_setPrototypeOf","_inheritsLoose","__proto__","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","p","isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","toString","e","_construct","Parent","Class","a","push","Function","bind","_isNativeFunction","indexOf","_wrapNativeSuper","_cache","Map","has","get","set","Wrapper","_instanceof","left","right","hasInstance","_interopRequireDefault","__esModule","default","_interopRequireWildcard","newObj","_newArrowCheck","innerThis","boundThis","_objectDestructuringEmpty","_objectWithoutPropertiesLoose","excluded","sourceKeys","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","ReferenceError","_possibleConstructorReturn","_superPropBase","object","property","_get","receiver","base","_set","isStrict","s","Error","_taggedTemplateLiteral","strings","raw","slice","freeze","defineProperties","_taggedTemplateLiteralLoose","_temporalRef","val","name","_temporalUndefined","_readOnlyError","_classNameTDZError","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","_slicedToArrayLoose","_iterableToArrayLimitLoose","_toArray","_iterableToArray","_toConsumableArray","_arrayWithoutHoles","_nonIterableSpread","isArray","arr2","from","_arr","_n","_d","_e","_i","_s","_iterator","_step","_skipFirstGeneratorNext","it","_toPrimitive","input","hint","prim","toPrimitive","res","String","Number","_toPropertyKey","_initializerWarningHelper","context","_initializerDefineProperty","initializer","_applyDecoratedDescriptor","decorators","reverse","reduce","decorator","id","_classPrivateFieldLooseKey","_classPrivateFieldLooseBase","privateKey","_classPrivateFieldGet","privateMap","_classPrivateFieldSet","_classStaticPrivateFieldSpecGet","classConstructor","_classStaticPrivateFieldSpecSet","_classStaticPrivateMethodGet","_classStaticPrivateMethodSet","_decorate","mixins","api","_getDecoratorsApi","r","initialize","O","initializeInstanceElements","decorated","elements","decorateClass","_coalesceClassElements","d","map","_createElementDescriptor","initializeClassElements","F","runClassFinishers","finishers","elementsDefinitionOrder","kind","element","placement","defineClassElement","proto","newElements","placements","static","own","addElementPlacement","_hasDecorators","elementFinishersExtras","decorateElement","extras","decorateConstructor","silent","splice","elementObject","fromElementDescriptor","elementFinisherExtras","toElementFinisherExtras","finisher","newExtras","j","fromClassDescriptor","elementsAndFinisher","toClassDescriptor","k","toStringTag","toElementDescriptors","elementObjects","toElementDescriptor","disallowProperty","_optionalCallableProperty","newConstructor","objectType","def","_coalesceGetterSetter","other","isSameElement","find","_isDataDescriptor","_classPrivateMethodGet","privateSet","_classPrivateMethodSet","_wrapRegExp","re","groups","BabelRegExp","_RegExp","RegExp","_super","_groups","WeakMap","_this","exec","str","buildGroups","replace","substitution","_","g","vectorMultiply","v","amount","createVector","x","y","vectorAdd","b","vectorNormalize","l","Math","sqrt","vectorRotate","radians","origin","cos","sin","t","getMarkupValue","size","scalar","axis","parseFloat","min","width","height","getMarkupStyles","markup","scale","lineStyle","borderStyle","fill","backgroundColor","fontColor","stroke","borderColor","lineColor","strokeWidth","borderWidth","lineWidth","lineCap","lineJoin","dashes","join","opacity","isDefined","getMarkupRect","rect","top","bottom","pointsToPathShape","points","point","index","setAttributes","attr","setAttribute","ns","svg","tag","document","createElementNS","updateRect","styles","updateEllipse","cx","cy","rx","ry","IMAGE_FIT_STYLE","contain","cover","updateImage","preserveAspectRatio","fit","TEXT_ANCHOR","center","updateText","fontSize","fontFamily","fontWeight","textAlign","text","textContent","updateLine","line","childNodes","begin","end","x1","y1","x2","y2","lineDecoration","style","display","arrowBeginRotationPoint","arrowBeginCenter","arrowBeginA","arrowBeginB","arrowEndRotationPoint","arrowEndCenter","arrowEndA","arrowEndB","updatePath","createShape","node","createImage","shape","onload","setAttributeNS","src","createLine","appendChild","CREATE_TYPE_ROUTES","image","ellipse","path","UPDATE_TYPE_ROUTES","createMarkupByType","updateMarkupByType","MARKUP_RECT","toOptionalFraction","prepareMarkup","_markup","prev","curr","zIndex","sortMarkupByZIndex","createMarkupView","utils","createView","ignoreRect","apis","write","_ref","root","dirty","crop","resize","viewWidth","viewHeight","cropWidth","cropHeight","_size","outputWidth","outputHeight","outputFit","mode","outputUpscale","upscale","shouldUpscale","scalarWidth","scalarHeight","max","innerHTML","markupFilter","query","sort","settings","createVector$1","vectorDot","vectorSubtract","vectorDistanceSquared","vectorDistance","getOffsetPointOnEdge","rotation","A","B","C","sinA","sinB","sinC","cosC","ratio","c","getRotatedRectSize","w","h","hor","ver","tl","abs","tr","bl","calculateCanvasSize","canvasAspectRatio","zoom","imageAspectRatio","canvasWidth","canvasHeight","imgWidth","imgHeight","getImageRectZoomFactor","imageRect","cropRect","imageWidth","imageHeight","rotatedCropSize","getCenteredCropRect","container","aspectRatio","getCurrentCropSize","imageSize","canvasSize","canvasCenter","stage","shouldLimit","scaleToFit","stageZoomFactor","widthFloat","heightFloat","round","IMAGE_SCALE_SPRING_PROPS","stiffness","damping","mass","createBitmapView","createImageCanvasWrapper","animations","originX","originY","scaleX","scaleY","translateX","translateY","rotateZ","_ref2","bitmap","appendChildView","createChildView","_ref3","flip","horizontal","vertical","createClipView","duration","didWriteView","_ref4","background","_ref5","createMarkup","destroyMarkup","removeChildView","transparencyIndicator","dataset","_ref6","shouldOptimize","translation","PI","cropAspectRatio","imageView","createImageView","_ref7","clip","_ref8","hidden","containerWidth","containerHeight","fixedPreviewHeight","minPreviewHeight","maxPreviewHeight","panelAspectRatio","allowMultiple","clipHeight","clipWidth","SVG_MASK","SVGMaskUniqueId","createImageOverlayView","fpAPI","mask","querySelector","url","window","location","href","hash","classList","add","status","BitmapWorker","onmessage","createImageBitmap","data","message","postMessage","ColorMatrixWorker","imageData","matrix","colorMatrix","m11","m12","m13","m14","m15","m21","m22","m23","m24","m25","m31","m32","m33","m34","m35","m41","m42","m43","m44","m45","buffer","getImageSize","cb","Image","naturalWidth","naturalHeight","transforms","fixImageOrientation","ctx","orientation","transform","createPreviewImage","canvas","createElement","getContext","drawImage","isBitmap","MAX_WIDTH","MAX_HEIGHT","calculateAverageColor","ceil","getImageData","averageColor","floor","cloneCanvas","cloneImageData","ImageData","createImageData","Uint8ClampedArray","loadImage","img","crossOrigin","onerror","createImageWrapperView","OverlayView","ImageView","createWorker","applyFilter","putImageData","worker","post","response","terminate","removeImageView","_destroy","shiftImage","images","shift","imageViewBin","pushImage","item","getMetadata","childViews","setTimeout","dispatch","didUpdateItemMetadata","action","change","_imageView","canCreateImageBitmap","userAgent","navigator","isFirefox","match","firefoxVersion","parseInt","didCreatePreviewContainer","fileURL","URL","createObjectURL","drawPreview","loadPreviewFallback","previewImageLoaded","revokeObjectURL","exif","pixelDensityFactor","devicePixelRatio","zoomFactor","scaleFactor","previewImageRatio","previewContainerWidth","previewContainerHeight","previewImage","setMetadata","close","overlayShadow","imageBitmap","didDrawPreview","restoreOverlay","_ref9","overlayError","overlaySuccess","didThrowError","_ref10","didCompleteProcessing","_ref11","_ref12","destroy","_ref13","_ref14","createRoute","DID_IMAGE_PREVIEW_DRAW","DID_IMAGE_PREVIEW_CONTAINER_CREATE","DID_FINISH_CALCULATE_PREVIEWSIZE","DID_UPDATE_ITEM_METADATA","DID_THROW_ITEM_LOAD_ERROR","DID_THROW_ITEM_PROCESSING_ERROR","DID_THROW_ITEM_INVALID","DID_COMPLETE_ITEM_PROCESSING","DID_START_ITEM_PROCESSING","DID_REVERT_ITEM_PROCESSING","_ref15","viewsToRemove","plugin","addFilter","Type","isFile","imagePreviewView","viewAPI","is","view","didLoadItem","archived","supportsCreateImageBitmap","maxPreviewFileSize","imagePreview","queue","rescaleItem","itemPanelAspectRatio","fixedHeight","_root$ref","previewAspectRatio","previewHeightMax","itemWidth","previewHeight","didResizeView","shouldRescale","didCalculatePreviewSize","shouldDrawPreview","registerWriter","DID_RESIZE_ROOT","DID_STOP_RESIZE","DID_LOAD_ITEM","DID_IMAGE_PREVIEW_CALCULATE_SIZE","requestAnimationFrame","options","allowImagePreview","BOOLEAN","imagePreviewFilterItem","FUNCTION","imagePreviewHeight","INT","imagePreviewMinHeight","imagePreviewMaxHeight","imagePreviewMaxFileSize","imagePreviewZoomFactor","imagePreviewUpscale","imagePreviewMaxInstantPreviewFileSize","imagePreviewTransparencyIndicator","STRING","imagePreviewCalculateAverageImageColor","imagePreviewMarkupShow","imagePreviewMarkupFilter","isBrowser","dispatchEvent","CustomEvent","detail"],"mappings":"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","sourcesContent":["/*!\n * FilePondPluginImagePreview 4.6.10\n * Licensed under MIT, https://opensource.org/licenses/MIT/\n * Please visit https://pqina.nl/filepond/ for details.\n */\n\n/* eslint-disable */\n\n(function(global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined'\n    ? (module.exports = factory())\n    : typeof define === 'function' && define.amd\n    ? define(factory)\n    : ((global = global || self),\n      (global.FilePondPluginImagePreview = factory()));\n})(this, function() {\n  'use strict';\n\n  // test if file is of type image and can be viewed in canvas\n  var isPreviewableImage = function isPreviewableImage(file) {\n    return /^image/.test(file.type);\n  };\n\n  function _typeof(obj) {\n    if (typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol') {\n      _typeof = function(obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function(obj) {\n        return obj &&\n          typeof Symbol === 'function' &&\n          obj.constructor === Symbol &&\n          obj !== Symbol.prototype\n          ? 'symbol'\n          : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  var REACT_ELEMENT_TYPE;\n\n  function _jsx(type, props, key, children) {\n    if (!REACT_ELEMENT_TYPE) {\n      REACT_ELEMENT_TYPE =\n        (typeof Symbol === 'function' &&\n          Symbol.for &&\n          Symbol.for('react.element')) ||\n        0xeac7;\n    }\n\n    var defaultProps = type && type.defaultProps;\n    var childrenLength = arguments.length - 3;\n\n    if (!props && childrenLength !== 0) {\n      props = {\n        children: void 0\n      };\n    }\n\n    if (props && defaultProps) {\n      for (var propName in defaultProps) {\n        if (props[propName] === void 0) {\n          props[propName] = defaultProps[propName];\n        }\n      }\n    } else if (!props) {\n      props = defaultProps || {};\n    }\n\n    if (childrenLength === 1) {\n      props.children = children;\n    } else if (childrenLength > 1) {\n      var childArray = new Array(childrenLength);\n\n      for (var i = 0; i < childrenLength; i++) {\n        childArray[i] = arguments[i + 3];\n      }\n\n      props.children = childArray;\n    }\n\n    return {\n      $$typeof: REACT_ELEMENT_TYPE,\n      type: type,\n      key: key === undefined ? null : '' + key,\n      ref: null,\n      props: props,\n      _owner: null\n    };\n  }\n\n  function _asyncIterator(iterable) {\n    var method;\n\n    if (typeof Symbol === 'function') {\n      if (Symbol.asyncIterator) {\n        method = iterable[Symbol.asyncIterator];\n        if (method != null) return method.call(iterable);\n      }\n\n      if (Symbol.iterator) {\n        method = iterable[Symbol.iterator];\n        if (method != null) return method.call(iterable);\n      }\n    }\n\n    throw new TypeError('Object is not async iterable');\n  }\n\n  function _AwaitValue(value) {\n    this.wrapped = value;\n  }\n\n  function _AsyncGenerator(gen) {\n    var front, back;\n\n    function send(key, arg) {\n      return new Promise(function(resolve, reject) {\n        var request = {\n          key: key,\n          arg: arg,\n          resolve: resolve,\n          reject: reject,\n          next: null\n        };\n\n        if (back) {\n          back = back.next = request;\n        } else {\n          front = back = request;\n          resume(key, arg);\n        }\n      });\n    }\n\n    function resume(key, arg) {\n      try {\n        var result = gen[key](arg);\n        var value = result.value;\n        var wrappedAwait = value instanceof _AwaitValue;\n        Promise.resolve(wrappedAwait ? value.wrapped : value).then(\n          function(arg) {\n            if (wrappedAwait) {\n              resume('next', arg);\n              return;\n            }\n\n            settle(result.done ? 'return' : 'normal', arg);\n          },\n          function(err) {\n            resume('throw', err);\n          }\n        );\n      } catch (err) {\n        settle('throw', err);\n      }\n    }\n\n    function settle(type, value) {\n      switch (type) {\n        case 'return':\n          front.resolve({\n            value: value,\n            done: true\n          });\n          break;\n\n        case 'throw':\n          front.reject(value);\n          break;\n\n        default:\n          front.resolve({\n            value: value,\n            done: false\n          });\n          break;\n      }\n\n      front = front.next;\n\n      if (front) {\n        resume(front.key, front.arg);\n      } else {\n        back = null;\n      }\n    }\n\n    this._invoke = send;\n\n    if (typeof gen.return !== 'function') {\n      this.return = undefined;\n    }\n  }\n\n  if (typeof Symbol === 'function' && Symbol.asyncIterator) {\n    _AsyncGenerator.prototype[Symbol.asyncIterator] = function() {\n      return this;\n    };\n  }\n\n  _AsyncGenerator.prototype.next = function(arg) {\n    return this._invoke('next', arg);\n  };\n\n  _AsyncGenerator.prototype.throw = function(arg) {\n    return this._invoke('throw', arg);\n  };\n\n  _AsyncGenerator.prototype.return = function(arg) {\n    return this._invoke('return', arg);\n  };\n\n  function _wrapAsyncGenerator(fn) {\n    return function() {\n      return new _AsyncGenerator(fn.apply(this, arguments));\n    };\n  }\n\n  function _awaitAsyncGenerator(value) {\n    return new _AwaitValue(value);\n  }\n\n  function _asyncGeneratorDelegate(inner, awaitWrap) {\n    var iter = {},\n      waiting = false;\n\n    function pump(key, value) {\n      waiting = true;\n      value = new Promise(function(resolve) {\n        resolve(inner[key](value));\n      });\n      return {\n        done: false,\n        value: awaitWrap(value)\n      };\n    }\n\n    if (typeof Symbol === 'function' && Symbol.iterator) {\n      iter[Symbol.iterator] = function() {\n        return this;\n      };\n    }\n\n    iter.next = function(value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump('next', value);\n    };\n\n    if (typeof inner.throw === 'function') {\n      iter.throw = function(value) {\n        if (waiting) {\n          waiting = false;\n          throw value;\n        }\n\n        return pump('throw', value);\n      };\n    }\n\n    if (typeof inner.return === 'function') {\n      iter.return = function(value) {\n        return pump('return', value);\n      };\n    }\n\n    return iter;\n  }\n\n  function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n      var info = gen[key](arg);\n      var value = info.value;\n    } catch (error) {\n      reject(error);\n      return;\n    }\n\n    if (info.done) {\n      resolve(value);\n    } else {\n      Promise.resolve(value).then(_next, _throw);\n    }\n  }\n\n  function _asyncToGenerator(fn) {\n    return function() {\n      var self = this,\n        args = arguments;\n      return new Promise(function(resolve, reject) {\n        var gen = fn.apply(self, args);\n\n        function _next(value) {\n          asyncGeneratorStep(\n            gen,\n            resolve,\n            reject,\n            _next,\n            _throw,\n            'next',\n            value\n          );\n        }\n\n        function _throw(err) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);\n        }\n\n        _next(undefined);\n      });\n    };\n  }\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError('Cannot call a class as a function');\n    }\n  }\n\n  function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if ('value' in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  function _createClass(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n    return Constructor;\n  }\n\n  function _defineEnumerableProperties(obj, descs) {\n    for (var key in descs) {\n      var desc = descs[key];\n      desc.configurable = desc.enumerable = true;\n      if ('value' in desc) desc.writable = true;\n      Object.defineProperty(obj, key, desc);\n    }\n\n    if (Object.getOwnPropertySymbols) {\n      var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n      for (var i = 0; i < objectSymbols.length; i++) {\n        var sym = objectSymbols[i];\n        var desc = descs[sym];\n        desc.configurable = desc.enumerable = true;\n        if ('value' in desc) desc.writable = true;\n        Object.defineProperty(obj, sym, desc);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defaults(obj, defaults) {\n    var keys = Object.getOwnPropertyNames(defaults);\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n      var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n      if (value && value.configurable && obj[key] === undefined) {\n        Object.defineProperty(obj, key, value);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defineProperty(obj, key, value) {\n    if (key in obj) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n    } else {\n      obj[key] = value;\n    }\n\n    return obj;\n  }\n\n  function _extends() {\n    _extends =\n      Object.assign ||\n      function(target) {\n        for (var i = 1; i < arguments.length; i++) {\n          var source = arguments[i];\n\n          for (var key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n              target[key] = source[key];\n            }\n          }\n        }\n\n        return target;\n      };\n\n    return _extends.apply(this, arguments);\n  }\n\n  function _objectSpread(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n      var ownKeys = Object.keys(source);\n\n      if (typeof Object.getOwnPropertySymbols === 'function') {\n        ownKeys = ownKeys.concat(\n          Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n          })\n        );\n      }\n\n      ownKeys.forEach(function(key) {\n        _defineProperty(target, key, source[key]);\n      });\n    }\n\n    return target;\n  }\n\n  function _inherits(subClass, superClass) {\n    if (typeof superClass !== 'function' && superClass !== null) {\n      throw new TypeError('Super expression must either be null or a function');\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) _setPrototypeOf(subClass, superClass);\n  }\n\n  function _inheritsLoose(subClass, superClass) {\n    subClass.prototype = Object.create(superClass.prototype);\n    subClass.prototype.constructor = subClass;\n    subClass.__proto__ = superClass;\n  }\n\n  function _getPrototypeOf(o) {\n    _getPrototypeOf = Object.setPrototypeOf\n      ? Object.getPrototypeOf\n      : function _getPrototypeOf(o) {\n          return o.__proto__ || Object.getPrototypeOf(o);\n        };\n    return _getPrototypeOf(o);\n  }\n\n  function _setPrototypeOf(o, p) {\n    _setPrototypeOf =\n      Object.setPrototypeOf ||\n      function _setPrototypeOf(o, p) {\n        o.__proto__ = p;\n        return o;\n      };\n\n    return _setPrototypeOf(o, p);\n  }\n\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === 'function') return true;\n\n    try {\n      Date.prototype.toString.call(Reflect.construct(Date, [], function() {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  function _construct(Parent, args, Class) {\n    if (isNativeReflectConstruct()) {\n      _construct = Reflect.construct;\n    } else {\n      _construct = function _construct(Parent, args, Class) {\n        var a = [null];\n        a.push.apply(a, args);\n        var Constructor = Function.bind.apply(Parent, a);\n        var instance = new Constructor();\n        if (Class) _setPrototypeOf(instance, Class.prototype);\n        return instance;\n      };\n    }\n\n    return _construct.apply(null, arguments);\n  }\n\n  function _isNativeFunction(fn) {\n    return Function.toString.call(fn).indexOf('[native code]') !== -1;\n  }\n\n  function _wrapNativeSuper(Class) {\n    var _cache = typeof Map === 'function' ? new Map() : undefined;\n\n    _wrapNativeSuper = function _wrapNativeSuper(Class) {\n      if (Class === null || !_isNativeFunction(Class)) return Class;\n\n      if (typeof Class !== 'function') {\n        throw new TypeError(\n          'Super expression must either be null or a function'\n        );\n      }\n\n      if (typeof _cache !== 'undefined') {\n        if (_cache.has(Class)) return _cache.get(Class);\n\n        _cache.set(Class, Wrapper);\n      }\n\n      function Wrapper() {\n        return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n      }\n\n      Wrapper.prototype = Object.create(Class.prototype, {\n        constructor: {\n          value: Wrapper,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n      return _setPrototypeOf(Wrapper, Class);\n    };\n\n    return _wrapNativeSuper(Class);\n  }\n\n  function _instanceof(left, right) {\n    if (\n      right != null &&\n      typeof Symbol !== 'undefined' &&\n      right[Symbol.hasInstance]\n    ) {\n      return right[Symbol.hasInstance](left);\n    } else {\n      return left instanceof right;\n    }\n  }\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule\n      ? obj\n      : {\n          default: obj\n        };\n  }\n\n  function _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            var desc =\n              Object.defineProperty && Object.getOwnPropertyDescriptor\n                ? Object.getOwnPropertyDescriptor(obj, key)\n                : {};\n\n            if (desc.get || desc.set) {\n              Object.defineProperty(newObj, key, desc);\n            } else {\n              newObj[key] = obj[key];\n            }\n          }\n        }\n      }\n\n      newObj.default = obj;\n      return newObj;\n    }\n  }\n\n  function _newArrowCheck(innerThis, boundThis) {\n    if (innerThis !== boundThis) {\n      throw new TypeError('Cannot instantiate an arrow function');\n    }\n  }\n\n  function _objectDestructuringEmpty(obj) {\n    if (obj == null) throw new TypeError('Cannot destructure undefined');\n  }\n\n  function _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n\n    for (i = 0; i < sourceKeys.length; i++) {\n      key = sourceKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      target[key] = source[key];\n    }\n\n    return target;\n  }\n\n  function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n\n    var key, i;\n\n    if (Object.getOwnPropertySymbols) {\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\n        key = sourceSymbolKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  function _assertThisInitialized(self) {\n    if (self === void 0) {\n      throw new ReferenceError(\n        \"this hasn't been initialised - super() hasn't been called\"\n      );\n    }\n\n    return self;\n  }\n\n  function _possibleConstructorReturn(self, call) {\n    if (call && (typeof call === 'object' || typeof call === 'function')) {\n      return call;\n    }\n\n    return _assertThisInitialized(self);\n  }\n\n  function _superPropBase(object, property) {\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\n      object = _getPrototypeOf(object);\n      if (object === null) break;\n    }\n\n    return object;\n  }\n\n  function _get(target, property, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.get) {\n      _get = Reflect.get;\n    } else {\n      _get = function _get(target, property, receiver) {\n        var base = _superPropBase(target, property);\n\n        if (!base) return;\n        var desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.get) {\n          return desc.get.call(receiver);\n        }\n\n        return desc.value;\n      };\n    }\n\n    return _get(target, property, receiver || target);\n  }\n\n  function set(target, property, value, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.set) {\n      set = Reflect.set;\n    } else {\n      set = function set(target, property, value, receiver) {\n        var base = _superPropBase(target, property);\n\n        var desc;\n\n        if (base) {\n          desc = Object.getOwnPropertyDescriptor(base, property);\n\n          if (desc.set) {\n            desc.set.call(receiver, value);\n            return true;\n          } else if (!desc.writable) {\n            return false;\n          }\n        }\n\n        desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n        if (desc) {\n          if (!desc.writable) {\n            return false;\n          }\n\n          desc.value = value;\n          Object.defineProperty(receiver, property, desc);\n        } else {\n          _defineProperty(receiver, property, value);\n        }\n\n        return true;\n      };\n    }\n\n    return set(target, property, value, receiver);\n  }\n\n  function _set(target, property, value, receiver, isStrict) {\n    var s = set(target, property, value, receiver || target);\n\n    if (!s && isStrict) {\n      throw new Error('failed to set property');\n    }\n\n    return value;\n  }\n\n  function _taggedTemplateLiteral(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    return Object.freeze(\n      Object.defineProperties(strings, {\n        raw: {\n          value: Object.freeze(raw)\n        }\n      })\n    );\n  }\n\n  function _taggedTemplateLiteralLoose(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    strings.raw = raw;\n    return strings;\n  }\n\n  function _temporalRef(val, name) {\n    if (val === _temporalUndefined) {\n      throw new ReferenceError(name + ' is not defined - temporal dead zone');\n    } else {\n      return val;\n    }\n  }\n\n  function _readOnlyError(name) {\n    throw new Error('\"' + name + '\" is read-only');\n  }\n\n  function _classNameTDZError(name) {\n    throw new Error(\n      'Class \"' + name + '\" cannot be referenced in computed property keys.'\n    );\n  }\n\n  var _temporalUndefined = {};\n\n  function _slicedToArray(arr, i) {\n    return (\n      _arrayWithHoles(arr) ||\n      _iterableToArrayLimit(arr, i) ||\n      _nonIterableRest()\n    );\n  }\n\n  function _slicedToArrayLoose(arr, i) {\n    return (\n      _arrayWithHoles(arr) ||\n      _iterableToArrayLimitLoose(arr, i) ||\n      _nonIterableRest()\n    );\n  }\n\n  function _toArray(arr) {\n    return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n  }\n\n  function _toConsumableArray(arr) {\n    return (\n      _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread()\n    );\n  }\n\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) {\n      for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++)\n        arr2[i] = arr[i];\n\n      return arr2;\n    }\n  }\n\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n\n  function _iterableToArray(iter) {\n    if (\n      Symbol.iterator in Object(iter) ||\n      Object.prototype.toString.call(iter) === '[object Arguments]'\n    )\n      return Array.from(iter);\n  }\n\n  function _iterableToArrayLimit(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (\n        var _i = arr[Symbol.iterator](), _s;\n        !(_n = (_s = _i.next()).done);\n        _n = true\n      ) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i['return'] != null) _i['return']();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  function _iterableToArrayLimitLoose(arr, i) {\n    var _arr = [];\n\n    for (\n      var _iterator = arr[Symbol.iterator](), _step;\n      !(_step = _iterator.next()).done;\n\n    ) {\n      _arr.push(_step.value);\n\n      if (i && _arr.length === i) break;\n    }\n\n    return _arr;\n  }\n\n  function _nonIterableSpread() {\n    throw new TypeError('Invalid attempt to spread non-iterable instance');\n  }\n\n  function _nonIterableRest() {\n    throw new TypeError('Invalid attempt to destructure non-iterable instance');\n  }\n\n  function _skipFirstGeneratorNext(fn) {\n    return function() {\n      var it = fn.apply(this, arguments);\n      it.next();\n      return it;\n    };\n  }\n\n  function _toPrimitive(input, hint) {\n    if (typeof input !== 'object' || input === null) return input;\n    var prim = input[Symbol.toPrimitive];\n\n    if (prim !== undefined) {\n      var res = prim.call(input, hint || 'default');\n      if (typeof res !== 'object') return res;\n      throw new TypeError('@@toPrimitive must return a primitive value.');\n    }\n\n    return (hint === 'string' ? String : Number)(input);\n  }\n\n  function _toPropertyKey(arg) {\n    var key = _toPrimitive(arg, 'string');\n\n    return typeof key === 'symbol' ? key : String(key);\n  }\n\n  function _initializerWarningHelper(descriptor, context) {\n    throw new Error(\n      'Decorating class property failed. Please ensure that ' +\n        'proposal-class-properties is enabled and set to use loose mode. ' +\n        'To use proposal-class-properties in spec mode with decorators, wait for ' +\n        'the next major version of decorators in stage 2.'\n    );\n  }\n\n  function _initializerDefineProperty(target, property, descriptor, context) {\n    if (!descriptor) return;\n    Object.defineProperty(target, property, {\n      enumerable: descriptor.enumerable,\n      configurable: descriptor.configurable,\n      writable: descriptor.writable,\n      value: descriptor.initializer\n        ? descriptor.initializer.call(context)\n        : void 0\n    });\n  }\n\n  function _applyDecoratedDescriptor(\n    target,\n    property,\n    decorators,\n    descriptor,\n    context\n  ) {\n    var desc = {};\n    Object.keys(descriptor).forEach(function(key) {\n      desc[key] = descriptor[key];\n    });\n    desc.enumerable = !!desc.enumerable;\n    desc.configurable = !!desc.configurable;\n\n    if ('value' in desc || desc.initializer) {\n      desc.writable = true;\n    }\n\n    desc = decorators\n      .slice()\n      .reverse()\n      .reduce(function(desc, decorator) {\n        return decorator(target, property, desc) || desc;\n      }, desc);\n\n    if (context && desc.initializer !== void 0) {\n      desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n      desc.initializer = undefined;\n    }\n\n    if (desc.initializer === void 0) {\n      Object.defineProperty(target, property, desc);\n      desc = null;\n    }\n\n    return desc;\n  }\n\n  var id = 0;\n\n  function _classPrivateFieldLooseKey(name) {\n    return '__private_' + id++ + '_' + name;\n  }\n\n  function _classPrivateFieldLooseBase(receiver, privateKey) {\n    if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n      throw new TypeError('attempted to use private field on non-instance');\n    }\n\n    return receiver;\n  }\n\n  function _classPrivateFieldGet(receiver, privateMap) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.get) {\n      return descriptor.get.call(receiver);\n    }\n\n    return descriptor.value;\n  }\n\n  function _classPrivateFieldSet(receiver, privateMap, value) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.set) {\n      descriptor.set.call(receiver, value);\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      descriptor.value = value;\n    }\n\n    return value;\n  }\n\n  function _classStaticPrivateFieldSpecGet(\n    receiver,\n    classConstructor,\n    descriptor\n  ) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return descriptor.value;\n  }\n\n  function _classStaticPrivateFieldSpecSet(\n    receiver,\n    classConstructor,\n    descriptor,\n    value\n  ) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    if (!descriptor.writable) {\n      throw new TypeError('attempted to set read only private field');\n    }\n\n    descriptor.value = value;\n    return value;\n  }\n\n  function _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return method;\n  }\n\n  function _classStaticPrivateMethodSet() {\n    throw new TypeError('attempted to set read only static private field');\n  }\n\n  function _decorate(decorators, factory, superClass, mixins) {\n    var api = _getDecoratorsApi();\n\n    if (mixins) {\n      for (var i = 0; i < mixins.length; i++) {\n        api = mixins[i](api);\n      }\n    }\n\n    var r = factory(function initialize(O) {\n      api.initializeInstanceElements(O, decorated.elements);\n    }, superClass);\n    var decorated = api.decorateClass(\n      _coalesceClassElements(r.d.map(_createElementDescriptor)),\n      decorators\n    );\n    api.initializeClassElements(r.F, decorated.elements);\n    return api.runClassFinishers(r.F, decorated.finishers);\n  }\n\n  function _getDecoratorsApi() {\n    _getDecoratorsApi = function() {\n      return api;\n    };\n\n    var api = {\n      elementsDefinitionOrder: [['method'], ['field']],\n      initializeInstanceElements: function(O, elements) {\n        ['method', 'field'].forEach(function(kind) {\n          elements.forEach(function(element) {\n            if (element.kind === kind && element.placement === 'own') {\n              this.defineClassElement(O, element);\n            }\n          }, this);\n        }, this);\n      },\n      initializeClassElements: function(F, elements) {\n        var proto = F.prototype;\n        ['method', 'field'].forEach(function(kind) {\n          elements.forEach(function(element) {\n            var placement = element.placement;\n\n            if (\n              element.kind === kind &&\n              (placement === 'static' || placement === 'prototype')\n            ) {\n              var receiver = placement === 'static' ? F : proto;\n              this.defineClassElement(receiver, element);\n            }\n          }, this);\n        }, this);\n      },\n      defineClassElement: function(receiver, element) {\n        var descriptor = element.descriptor;\n\n        if (element.kind === 'field') {\n          var initializer = element.initializer;\n          descriptor = {\n            enumerable: descriptor.enumerable,\n            writable: descriptor.writable,\n            configurable: descriptor.configurable,\n            value: initializer === void 0 ? void 0 : initializer.call(receiver)\n          };\n        }\n\n        Object.defineProperty(receiver, element.key, descriptor);\n      },\n      decorateClass: function(elements, decorators) {\n        var newElements = [];\n        var finishers = [];\n        var placements = {\n          static: [],\n          prototype: [],\n          own: []\n        };\n        elements.forEach(function(element) {\n          this.addElementPlacement(element, placements);\n        }, this);\n        elements.forEach(function(element) {\n          if (!_hasDecorators(element)) return newElements.push(element);\n          var elementFinishersExtras = this.decorateElement(\n            element,\n            placements\n          );\n          newElements.push(elementFinishersExtras.element);\n          newElements.push.apply(newElements, elementFinishersExtras.extras);\n          finishers.push.apply(finishers, elementFinishersExtras.finishers);\n        }, this);\n\n        if (!decorators) {\n          return {\n            elements: newElements,\n            finishers: finishers\n          };\n        }\n\n        var result = this.decorateConstructor(newElements, decorators);\n        finishers.push.apply(finishers, result.finishers);\n        result.finishers = finishers;\n        return result;\n      },\n      addElementPlacement: function(element, placements, silent) {\n        var keys = placements[element.placement];\n\n        if (!silent && keys.indexOf(element.key) !== -1) {\n          throw new TypeError('Duplicated element (' + element.key + ')');\n        }\n\n        keys.push(element.key);\n      },\n      decorateElement: function(element, placements) {\n        var extras = [];\n        var finishers = [];\n\n        for (\n          var decorators = element.decorators, i = decorators.length - 1;\n          i >= 0;\n          i--\n        ) {\n          var keys = placements[element.placement];\n          keys.splice(keys.indexOf(element.key), 1);\n          var elementObject = this.fromElementDescriptor(element);\n          var elementFinisherExtras = this.toElementFinisherExtras(\n            (0, decorators[i])(elementObject) || elementObject\n          );\n          element = elementFinisherExtras.element;\n          this.addElementPlacement(element, placements);\n\n          if (elementFinisherExtras.finisher) {\n            finishers.push(elementFinisherExtras.finisher);\n          }\n\n          var newExtras = elementFinisherExtras.extras;\n\n          if (newExtras) {\n            for (var j = 0; j < newExtras.length; j++) {\n              this.addElementPlacement(newExtras[j], placements);\n            }\n\n            extras.push.apply(extras, newExtras);\n          }\n        }\n\n        return {\n          element: element,\n          finishers: finishers,\n          extras: extras\n        };\n      },\n      decorateConstructor: function(elements, decorators) {\n        var finishers = [];\n\n        for (var i = decorators.length - 1; i >= 0; i--) {\n          var obj = this.fromClassDescriptor(elements);\n          var elementsAndFinisher = this.toClassDescriptor(\n            (0, decorators[i])(obj) || obj\n          );\n\n          if (elementsAndFinisher.finisher !== undefined) {\n            finishers.push(elementsAndFinisher.finisher);\n          }\n\n          if (elementsAndFinisher.elements !== undefined) {\n            elements = elementsAndFinisher.elements;\n\n            for (var j = 0; j < elements.length - 1; j++) {\n              for (var k = j + 1; k < elements.length; k++) {\n                if (\n                  elements[j].key === elements[k].key &&\n                  elements[j].placement === elements[k].placement\n                ) {\n                  throw new TypeError(\n                    'Duplicated element (' + elements[j].key + ')'\n                  );\n                }\n              }\n            }\n          }\n        }\n\n        return {\n          elements: elements,\n          finishers: finishers\n        };\n      },\n      fromElementDescriptor: function(element) {\n        var obj = {\n          kind: element.kind,\n          key: element.key,\n          placement: element.placement,\n          descriptor: element.descriptor\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        if (element.kind === 'field') obj.initializer = element.initializer;\n        return obj;\n      },\n      toElementDescriptors: function(elementObjects) {\n        if (elementObjects === undefined) return;\n        return _toArray(elementObjects).map(function(elementObject) {\n          var element = this.toElementDescriptor(elementObject);\n          this.disallowProperty(\n            elementObject,\n            'finisher',\n            'An element descriptor'\n          );\n          this.disallowProperty(\n            elementObject,\n            'extras',\n            'An element descriptor'\n          );\n          return element;\n        }, this);\n      },\n      toElementDescriptor: function(elementObject) {\n        var kind = String(elementObject.kind);\n\n        if (kind !== 'method' && kind !== 'field') {\n          throw new TypeError(\n            'An element descriptor\\'s .kind property must be either \"method\" or' +\n              ' \"field\", but a decorator created an element descriptor with' +\n              ' .kind \"' +\n              kind +\n              '\"'\n          );\n        }\n\n        var key = _toPropertyKey(elementObject.key);\n\n        var placement = String(elementObject.placement);\n\n        if (\n          placement !== 'static' &&\n          placement !== 'prototype' &&\n          placement !== 'own'\n        ) {\n          throw new TypeError(\n            'An element descriptor\\'s .placement property must be one of \"static\",' +\n              ' \"prototype\" or \"own\", but a decorator created an element descriptor' +\n              ' with .placement \"' +\n              placement +\n              '\"'\n          );\n        }\n\n        var descriptor = elementObject.descriptor;\n        this.disallowProperty(\n          elementObject,\n          'elements',\n          'An element descriptor'\n        );\n        var element = {\n          kind: kind,\n          key: key,\n          placement: placement,\n          descriptor: Object.assign({}, descriptor)\n        };\n\n        if (kind !== 'field') {\n          this.disallowProperty(\n            elementObject,\n            'initializer',\n            'A method descriptor'\n          );\n        } else {\n          this.disallowProperty(\n            descriptor,\n            'get',\n            'The property descriptor of a field descriptor'\n          );\n          this.disallowProperty(\n            descriptor,\n            'set',\n            'The property descriptor of a field descriptor'\n          );\n          this.disallowProperty(\n            descriptor,\n            'value',\n            'The property descriptor of a field descriptor'\n          );\n          element.initializer = elementObject.initializer;\n        }\n\n        return element;\n      },\n      toElementFinisherExtras: function(elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n\n        var finisher = _optionalCallableProperty(elementObject, 'finisher');\n\n        var extras = this.toElementDescriptors(elementObject.extras);\n        return {\n          element: element,\n          finisher: finisher,\n          extras: extras\n        };\n      },\n      fromClassDescriptor: function(elements) {\n        var obj = {\n          kind: 'class',\n          elements: elements.map(this.fromElementDescriptor, this)\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        return obj;\n      },\n      toClassDescriptor: function(obj) {\n        var kind = String(obj.kind);\n\n        if (kind !== 'class') {\n          throw new TypeError(\n            'A class descriptor\\'s .kind property must be \"class\", but a decorator' +\n              ' created a class descriptor with .kind \"' +\n              kind +\n              '\"'\n          );\n        }\n\n        this.disallowProperty(obj, 'key', 'A class descriptor');\n        this.disallowProperty(obj, 'placement', 'A class descriptor');\n        this.disallowProperty(obj, 'descriptor', 'A class descriptor');\n        this.disallowProperty(obj, 'initializer', 'A class descriptor');\n        this.disallowProperty(obj, 'extras', 'A class descriptor');\n\n        var finisher = _optionalCallableProperty(obj, 'finisher');\n\n        var elements = this.toElementDescriptors(obj.elements);\n        return {\n          elements: elements,\n          finisher: finisher\n        };\n      },\n      runClassFinishers: function(constructor, finishers) {\n        for (var i = 0; i < finishers.length; i++) {\n          var newConstructor = (0, finishers[i])(constructor);\n\n          if (newConstructor !== undefined) {\n            if (typeof newConstructor !== 'function') {\n              throw new TypeError('Finishers must return a constructor.');\n            }\n\n            constructor = newConstructor;\n          }\n        }\n\n        return constructor;\n      },\n      disallowProperty: function(obj, name, objectType) {\n        if (obj[name] !== undefined) {\n          throw new TypeError(\n            objectType + \" can't have a .\" + name + ' property.'\n          );\n        }\n      }\n    };\n    return api;\n  }\n\n  function _createElementDescriptor(def) {\n    var key = _toPropertyKey(def.key);\n\n    var descriptor;\n\n    if (def.kind === 'method') {\n      descriptor = {\n        value: def.value,\n        writable: true,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'get') {\n      descriptor = {\n        get: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'set') {\n      descriptor = {\n        set: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'field') {\n      descriptor = {\n        configurable: true,\n        writable: true,\n        enumerable: true\n      };\n    }\n\n    var element = {\n      kind: def.kind === 'field' ? 'field' : 'method',\n      key: key,\n      placement: def.static\n        ? 'static'\n        : def.kind === 'field'\n        ? 'own'\n        : 'prototype',\n      descriptor: descriptor\n    };\n    if (def.decorators) element.decorators = def.decorators;\n    if (def.kind === 'field') element.initializer = def.value;\n    return element;\n  }\n\n  function _coalesceGetterSetter(element, other) {\n    if (element.descriptor.get !== undefined) {\n      other.descriptor.get = element.descriptor.get;\n    } else {\n      other.descriptor.set = element.descriptor.set;\n    }\n  }\n\n  function _coalesceClassElements(elements) {\n    var newElements = [];\n\n    var isSameElement = function(other) {\n      return (\n        other.kind === 'method' &&\n        other.key === element.key &&\n        other.placement === element.placement\n      );\n    };\n\n    for (var i = 0; i < elements.length; i++) {\n      var element = elements[i];\n      var other;\n\n      if (\n        element.kind === 'method' &&\n        (other = newElements.find(isSameElement))\n      ) {\n        if (\n          _isDataDescriptor(element.descriptor) ||\n          _isDataDescriptor(other.descriptor)\n        ) {\n          if (_hasDecorators(element) || _hasDecorators(other)) {\n            throw new ReferenceError(\n              'Duplicated methods (' + element.key + \") can't be decorated.\"\n            );\n          }\n\n          other.descriptor = element.descriptor;\n        } else {\n          if (_hasDecorators(element)) {\n            if (_hasDecorators(other)) {\n              throw new ReferenceError(\n                \"Decorators can't be placed on different accessors with for \" +\n                  'the same property (' +\n                  element.key +\n                  ').'\n              );\n            }\n\n            other.decorators = element.decorators;\n          }\n\n          _coalesceGetterSetter(element, other);\n        }\n      } else {\n        newElements.push(element);\n      }\n    }\n\n    return newElements;\n  }\n\n  function _hasDecorators(element) {\n    return element.decorators && element.decorators.length;\n  }\n\n  function _isDataDescriptor(desc) {\n    return (\n      desc !== undefined &&\n      !(desc.value === undefined && desc.writable === undefined)\n    );\n  }\n\n  function _optionalCallableProperty(obj, name) {\n    var value = obj[name];\n\n    if (value !== undefined && typeof value !== 'function') {\n      throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n    }\n\n    return value;\n  }\n\n  function _classPrivateMethodGet(receiver, privateSet, fn) {\n    if (!privateSet.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    return fn;\n  }\n\n  function _classPrivateMethodSet() {\n    throw new TypeError('attempted to reassign private method');\n  }\n\n  function _wrapRegExp(re, groups) {\n    _wrapRegExp = function(re, groups) {\n      return new BabelRegExp(re, groups);\n    };\n\n    var _RegExp = _wrapNativeSuper(RegExp);\n\n    var _super = RegExp.prototype;\n\n    var _groups = new WeakMap();\n\n    function BabelRegExp(re, groups) {\n      var _this = _RegExp.call(this, re);\n\n      _groups.set(_this, groups);\n\n      return _this;\n    }\n\n    _inherits(BabelRegExp, _RegExp);\n\n    BabelRegExp.prototype.exec = function(str) {\n      var result = _super.exec.call(this, str);\n\n      if (result) result.groups = buildGroups(result, this);\n      return result;\n    };\n\n    BabelRegExp.prototype[Symbol.replace] = function(str, substitution) {\n      if (typeof substitution === 'string') {\n        var groups = _groups.get(this);\n\n        return _super[Symbol.replace].call(\n          this,\n          str,\n          substitution.replace(/\\$<([^>]+)>/g, function(_, name) {\n            return '$' + groups[name];\n          })\n        );\n      } else if (typeof substitution === 'function') {\n        var _this = this;\n\n        return _super[Symbol.replace].call(this, str, function() {\n          var args = [];\n          args.push.apply(args, arguments);\n\n          if (typeof args[args.length - 1] !== 'object') {\n            args.push(buildGroups(args, _this));\n          }\n\n          return substitution.apply(this, args);\n        });\n      } else {\n        return _super[Symbol.replace].call(this, str, substitution);\n      }\n    };\n\n    function buildGroups(result, re) {\n      var g = _groups.get(re);\n\n      return Object.keys(g).reduce(function(groups, name) {\n        groups[name] = result[g[name]];\n        return groups;\n      }, Object.create(null));\n    }\n\n    return _wrapRegExp.apply(this, arguments);\n  }\n\n  var vectorMultiply = function vectorMultiply(v, amount) {\n    return createVector(v.x * amount, v.y * amount);\n  };\n\n  var vectorAdd = function vectorAdd(a, b) {\n    return createVector(a.x + b.x, a.y + b.y);\n  };\n\n  var vectorNormalize = function vectorNormalize(v) {\n    var l = Math.sqrt(v.x * v.x + v.y * v.y);\n    if (l === 0) {\n      return {\n        x: 0,\n        y: 0\n      };\n    }\n    return createVector(v.x / l, v.y / l);\n  };\n\n  var vectorRotate = function vectorRotate(v, radians, origin) {\n    var cos = Math.cos(radians);\n    var sin = Math.sin(radians);\n    var t = createVector(v.x - origin.x, v.y - origin.y);\n    return createVector(\n      origin.x + cos * t.x - sin * t.y,\n      origin.y + sin * t.x + cos * t.y\n    );\n  };\n\n  var createVector = function createVector() {\n    var x =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var y =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    return { x: x, y: y };\n  };\n\n  var getMarkupValue = function getMarkupValue(value, size) {\n    var scalar =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    var axis = arguments.length > 3 ? arguments[3] : undefined;\n    if (typeof value === 'string') {\n      return parseFloat(value) * scalar;\n    }\n    if (typeof value === 'number') {\n      return value * (axis ? size[axis] : Math.min(size.width, size.height));\n    }\n    return;\n  };\n\n  var getMarkupStyles = function getMarkupStyles(markup, size, scale) {\n    var lineStyle = markup.borderStyle || markup.lineStyle || 'solid';\n    var fill = markup.backgroundColor || markup.fontColor || 'transparent';\n    var stroke = markup.borderColor || markup.lineColor || 'transparent';\n    var strokeWidth = getMarkupValue(\n      markup.borderWidth || markup.lineWidth,\n      size,\n      scale\n    );\n    var lineCap = markup.lineCap || 'round';\n    var lineJoin = markup.lineJoin || 'round';\n    var dashes =\n      typeof lineStyle === 'string'\n        ? ''\n        : lineStyle\n            .map(function(v) {\n              return getMarkupValue(v, size, scale);\n            })\n            .join(',');\n    var opacity = markup.opacity || 1;\n    return {\n      'stroke-linecap': lineCap,\n      'stroke-linejoin': lineJoin,\n      'stroke-width': strokeWidth || 0,\n      'stroke-dasharray': dashes,\n      stroke: stroke,\n      fill: fill,\n      opacity: opacity\n    };\n  };\n\n  var isDefined = function isDefined(value) {\n    return value != null;\n  };\n\n  var getMarkupRect = function getMarkupRect(rect, size) {\n    var scalar =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n\n    var left =\n      getMarkupValue(rect.x, size, scalar, 'width') ||\n      getMarkupValue(rect.left, size, scalar, 'width');\n    var top =\n      getMarkupValue(rect.y, size, scalar, 'height') ||\n      getMarkupValue(rect.top, size, scalar, 'height');\n    var width = getMarkupValue(rect.width, size, scalar, 'width');\n    var height = getMarkupValue(rect.height, size, scalar, 'height');\n    var right = getMarkupValue(rect.right, size, scalar, 'width');\n    var bottom = getMarkupValue(rect.bottom, size, scalar, 'height');\n\n    if (!isDefined(top)) {\n      if (isDefined(height) && isDefined(bottom)) {\n        top = size.height - height - bottom;\n      } else {\n        top = bottom;\n      }\n    }\n\n    if (!isDefined(left)) {\n      if (isDefined(width) && isDefined(right)) {\n        left = size.width - width - right;\n      } else {\n        left = right;\n      }\n    }\n\n    if (!isDefined(width)) {\n      if (isDefined(left) && isDefined(right)) {\n        width = size.width - left - right;\n      } else {\n        width = 0;\n      }\n    }\n\n    if (!isDefined(height)) {\n      if (isDefined(top) && isDefined(bottom)) {\n        height = size.height - top - bottom;\n      } else {\n        height = 0;\n      }\n    }\n\n    return {\n      x: left || 0,\n      y: top || 0,\n      width: width || 0,\n      height: height || 0\n    };\n  };\n\n  var pointsToPathShape = function pointsToPathShape(points) {\n    return points\n      .map(function(point, index) {\n        return ''\n          .concat(index === 0 ? 'M' : 'L', ' ')\n          .concat(point.x, ' ')\n          .concat(point.y);\n      })\n      .join(' ');\n  };\n\n  var setAttributes = function setAttributes(element, attr) {\n    return Object.keys(attr).forEach(function(key) {\n      return element.setAttribute(key, attr[key]);\n    });\n  };\n\n  var ns = 'http://www.w3.org/2000/svg';\n  var svg = function svg(tag, attr) {\n    var element = document.createElementNS(ns, tag);\n    if (attr) {\n      setAttributes(element, attr);\n    }\n    return element;\n  };\n\n  var updateRect = function updateRect(element) {\n    return setAttributes(\n      element,\n      Object.assign({}, element.rect, element.styles)\n    );\n  };\n\n  var updateEllipse = function updateEllipse(element) {\n    var cx = element.rect.x + element.rect.width * 0.5;\n    var cy = element.rect.y + element.rect.height * 0.5;\n    var rx = element.rect.width * 0.5;\n    var ry = element.rect.height * 0.5;\n    return setAttributes(\n      element,\n      Object.assign(\n        {\n          cx: cx,\n          cy: cy,\n          rx: rx,\n          ry: ry\n        },\n        element.styles\n      )\n    );\n  };\n\n  var IMAGE_FIT_STYLE = {\n    contain: 'xMidYMid meet',\n    cover: 'xMidYMid slice'\n  };\n\n  var updateImage = function updateImage(element, markup) {\n    setAttributes(\n      element,\n      Object.assign({}, element.rect, element.styles, {\n        preserveAspectRatio: IMAGE_FIT_STYLE[markup.fit] || 'none'\n      })\n    );\n  };\n\n  var TEXT_ANCHOR = {\n    left: 'start',\n    center: 'middle',\n    right: 'end'\n  };\n\n  var updateText = function updateText(element, markup, size, scale) {\n    var fontSize = getMarkupValue(markup.fontSize, size, scale);\n    var fontFamily = markup.fontFamily || 'sans-serif';\n    var fontWeight = markup.fontWeight || 'normal';\n    var textAlign = TEXT_ANCHOR[markup.textAlign] || 'start';\n\n    setAttributes(\n      element,\n      Object.assign({}, element.rect, element.styles, {\n        'stroke-width': 0,\n        'font-weight': fontWeight,\n        'font-size': fontSize,\n        'font-family': fontFamily,\n        'text-anchor': textAlign\n      })\n    );\n\n    // update text\n    if (element.text !== markup.text) {\n      element.text = markup.text;\n      element.textContent = markup.text.length ? markup.text : ' ';\n    }\n  };\n\n  var updateLine = function updateLine(element, markup, size, scale) {\n    setAttributes(\n      element,\n      Object.assign({}, element.rect, element.styles, {\n        fill: 'none'\n      })\n    );\n\n    var line = element.childNodes[0];\n    var begin = element.childNodes[1];\n    var end = element.childNodes[2];\n\n    var origin = element.rect;\n\n    var target = {\n      x: element.rect.x + element.rect.width,\n      y: element.rect.y + element.rect.height\n    };\n\n    setAttributes(line, {\n      x1: origin.x,\n      y1: origin.y,\n      x2: target.x,\n      y2: target.y\n    });\n\n    if (!markup.lineDecoration) return;\n\n    begin.style.display = 'none';\n    end.style.display = 'none';\n\n    var v = vectorNormalize({\n      x: target.x - origin.x,\n      y: target.y - origin.y\n    });\n\n    var l = getMarkupValue(0.05, size, scale);\n\n    if (markup.lineDecoration.indexOf('arrow-begin') !== -1) {\n      var arrowBeginRotationPoint = vectorMultiply(v, l);\n      var arrowBeginCenter = vectorAdd(origin, arrowBeginRotationPoint);\n      var arrowBeginA = vectorRotate(origin, 2, arrowBeginCenter);\n      var arrowBeginB = vectorRotate(origin, -2, arrowBeginCenter);\n\n      setAttributes(begin, {\n        style: 'display:block;',\n        d: 'M'\n          .concat(arrowBeginA.x, ',')\n          .concat(arrowBeginA.y, ' L')\n          .concat(origin.x, ',')\n          .concat(origin.y, ' L')\n          .concat(arrowBeginB.x, ',')\n          .concat(arrowBeginB.y)\n      });\n    }\n\n    if (markup.lineDecoration.indexOf('arrow-end') !== -1) {\n      var arrowEndRotationPoint = vectorMultiply(v, -l);\n      var arrowEndCenter = vectorAdd(target, arrowEndRotationPoint);\n      var arrowEndA = vectorRotate(target, 2, arrowEndCenter);\n      var arrowEndB = vectorRotate(target, -2, arrowEndCenter);\n\n      setAttributes(end, {\n        style: 'display:block;',\n        d: 'M'\n          .concat(arrowEndA.x, ',')\n          .concat(arrowEndA.y, ' L')\n          .concat(target.x, ',')\n          .concat(target.y, ' L')\n          .concat(arrowEndB.x, ',')\n          .concat(arrowEndB.y)\n      });\n    }\n  };\n\n  var updatePath = function updatePath(element, markup, size, scale) {\n    setAttributes(\n      element,\n      Object.assign({}, element.styles, {\n        fill: 'none',\n        d: pointsToPathShape(\n          markup.points.map(function(point) {\n            return {\n              x: getMarkupValue(point.x, size, scale, 'width'),\n              y: getMarkupValue(point.y, size, scale, 'height')\n            };\n          })\n        )\n      })\n    );\n  };\n\n  var createShape = function createShape(node) {\n    return function(markup) {\n      return svg(node, { id: markup.id });\n    };\n  };\n\n  var createImage = function createImage(markup) {\n    var shape = svg('image', {\n      id: markup.id,\n      'stroke-linecap': 'round',\n      'stroke-linejoin': 'round',\n      opacity: '0'\n    });\n\n    shape.onload = function() {\n      shape.setAttribute('opacity', markup.opacity || 1);\n    };\n    shape.setAttributeNS(\n      'http://www.w3.org/1999/xlink',\n      'xlink:href',\n      markup.src\n    );\n    return shape;\n  };\n\n  var createLine = function createLine(markup) {\n    var shape = svg('g', {\n      id: markup.id,\n      'stroke-linecap': 'round',\n      'stroke-linejoin': 'round'\n    });\n\n    var line = svg('line');\n    shape.appendChild(line);\n\n    var begin = svg('path');\n    shape.appendChild(begin);\n\n    var end = svg('path');\n    shape.appendChild(end);\n\n    return shape;\n  };\n\n  var CREATE_TYPE_ROUTES = {\n    image: createImage,\n    rect: createShape('rect'),\n    ellipse: createShape('ellipse'),\n    text: createShape('text'),\n    path: createShape('path'),\n    line: createLine\n  };\n\n  var UPDATE_TYPE_ROUTES = {\n    rect: updateRect,\n    ellipse: updateEllipse,\n    image: updateImage,\n    text: updateText,\n    path: updatePath,\n    line: updateLine\n  };\n\n  var createMarkupByType = function createMarkupByType(type, markup) {\n    return CREATE_TYPE_ROUTES[type](markup);\n  };\n\n  var updateMarkupByType = function updateMarkupByType(\n    element,\n    type,\n    markup,\n    size,\n    scale\n  ) {\n    if (type !== 'path') {\n      element.rect = getMarkupRect(markup, size, scale);\n    }\n    element.styles = getMarkupStyles(markup, size, scale);\n    UPDATE_TYPE_ROUTES[type](element, markup, size, scale);\n  };\n\n  var MARKUP_RECT = [\n    'x',\n    'y',\n    'left',\n    'top',\n    'right',\n    'bottom',\n    'width',\n    'height'\n  ];\n\n  var toOptionalFraction = function toOptionalFraction(value) {\n    return typeof value === 'string' && /%/.test(value)\n      ? parseFloat(value) / 100\n      : value;\n  };\n\n  // adds default markup properties, clones markup\n  var prepareMarkup = function prepareMarkup(markup) {\n    var _markup = _slicedToArray(markup, 2),\n      type = _markup[0],\n      props = _markup[1];\n\n    var rect = props.points\n      ? {}\n      : MARKUP_RECT.reduce(function(prev, curr) {\n          prev[curr] = toOptionalFraction(props[curr]);\n          return prev;\n        }, {});\n\n    return [\n      type,\n      Object.assign(\n        {\n          zIndex: 0\n        },\n        props,\n        rect\n      )\n    ];\n  };\n\n  var sortMarkupByZIndex = function sortMarkupByZIndex(a, b) {\n    if (a[1].zIndex > b[1].zIndex) {\n      return 1;\n    }\n    if (a[1].zIndex < b[1].zIndex) {\n      return -1;\n    }\n    return 0;\n  };\n\n  var createMarkupView = function createMarkupView(_) {\n    return _.utils.createView({\n      name: 'image-preview-markup',\n      tag: 'svg',\n      ignoreRect: true,\n      mixins: {\n        apis: ['width', 'height', 'crop', 'markup', 'resize', 'dirty']\n      },\n\n      write: function write(_ref) {\n        var root = _ref.root,\n          props = _ref.props;\n\n        if (!props.dirty) return;\n        var crop = props.crop,\n          resize = props.resize,\n          markup = props.markup;\n\n        var viewWidth = props.width;\n        var viewHeight = props.height;\n\n        var cropWidth = crop.width;\n        var cropHeight = crop.height;\n\n        if (resize) {\n          var _size = resize.size;\n\n          var outputWidth = _size && _size.width;\n          var outputHeight = _size && _size.height;\n          var outputFit = resize.mode;\n          var outputUpscale = resize.upscale;\n\n          if (outputWidth && !outputHeight) outputHeight = outputWidth;\n          if (outputHeight && !outputWidth) outputWidth = outputHeight;\n\n          var shouldUpscale =\n            cropWidth < outputWidth && cropHeight < outputHeight;\n\n          if (!shouldUpscale || (shouldUpscale && outputUpscale)) {\n            var scalarWidth = outputWidth / cropWidth;\n            var scalarHeight = outputHeight / cropHeight;\n\n            if (outputFit === 'force') {\n              cropWidth = outputWidth;\n              cropHeight = outputHeight;\n            } else {\n              var scalar;\n              if (outputFit === 'cover') {\n                scalar = Math.max(scalarWidth, scalarHeight);\n              } else if (outputFit === 'contain') {\n                scalar = Math.min(scalarWidth, scalarHeight);\n              }\n              cropWidth = cropWidth * scalar;\n              cropHeight = cropHeight * scalar;\n            }\n          }\n        }\n\n        var size = {\n          width: viewWidth,\n          height: viewHeight\n        };\n\n        root.element.setAttribute('width', size.width);\n        root.element.setAttribute('height', size.height);\n\n        var scale = Math.min(viewWidth / cropWidth, viewHeight / cropHeight);\n\n        // clear\n        root.element.innerHTML = '';\n\n        // get filter\n        var markupFilter = root.query('GET_IMAGE_PREVIEW_MARKUP_FILTER');\n\n        // draw new\n        markup\n          .filter(markupFilter)\n          .map(prepareMarkup)\n          .sort(sortMarkupByZIndex)\n          .forEach(function(markup) {\n            var _markup = _slicedToArray(markup, 2),\n              type = _markup[0],\n              settings = _markup[1];\n\n            // create\n            var element = createMarkupByType(type, settings);\n\n            // update\n            updateMarkupByType(element, type, settings, size, scale);\n\n            // add\n            root.element.appendChild(element);\n          });\n      }\n    });\n  };\n\n  var createVector$1 = function createVector(x, y) {\n    return { x: x, y: y };\n  };\n\n  var vectorDot = function vectorDot(a, b) {\n    return a.x * b.x + a.y * b.y;\n  };\n\n  var vectorSubtract = function vectorSubtract(a, b) {\n    return createVector$1(a.x - b.x, a.y - b.y);\n  };\n\n  var vectorDistanceSquared = function vectorDistanceSquared(a, b) {\n    return vectorDot(vectorSubtract(a, b), vectorSubtract(a, b));\n  };\n\n  var vectorDistance = function vectorDistance(a, b) {\n    return Math.sqrt(vectorDistanceSquared(a, b));\n  };\n\n  var getOffsetPointOnEdge = function getOffsetPointOnEdge(length, rotation) {\n    var a = length;\n\n    var A = 1.5707963267948966;\n    var B = rotation;\n    var C = 1.5707963267948966 - rotation;\n\n    var sinA = Math.sin(A);\n    var sinB = Math.sin(B);\n    var sinC = Math.sin(C);\n    var cosC = Math.cos(C);\n    var ratio = a / sinA;\n    var b = ratio * sinB;\n    var c = ratio * sinC;\n\n    return createVector$1(cosC * b, cosC * c);\n  };\n\n  var getRotatedRectSize = function getRotatedRectSize(rect, rotation) {\n    var w = rect.width;\n    var h = rect.height;\n\n    var hor = getOffsetPointOnEdge(w, rotation);\n    var ver = getOffsetPointOnEdge(h, rotation);\n\n    var tl = createVector$1(rect.x + Math.abs(hor.x), rect.y - Math.abs(hor.y));\n\n    var tr = createVector$1(\n      rect.x + rect.width + Math.abs(ver.y),\n      rect.y + Math.abs(ver.x)\n    );\n\n    var bl = createVector$1(\n      rect.x - Math.abs(ver.y),\n      rect.y + rect.height - Math.abs(ver.x)\n    );\n\n    return {\n      width: vectorDistance(tl, tr),\n      height: vectorDistance(tl, bl)\n    };\n  };\n\n  var calculateCanvasSize = function calculateCanvasSize(\n    image,\n    canvasAspectRatio\n  ) {\n    var zoom =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n\n    var imageAspectRatio = image.height / image.width;\n\n    // determine actual pixels on x and y axis\n    var canvasWidth = 1;\n    var canvasHeight = canvasAspectRatio;\n    var imgWidth = 1;\n    var imgHeight = imageAspectRatio;\n    if (imgHeight > canvasHeight) {\n      imgHeight = canvasHeight;\n      imgWidth = imgHeight / imageAspectRatio;\n    }\n\n    var scalar = Math.max(canvasWidth / imgWidth, canvasHeight / imgHeight);\n    var width = image.width / (zoom * scalar * imgWidth);\n    var height = width * canvasAspectRatio;\n\n    return {\n      width: width,\n      height: height\n    };\n  };\n\n  var getImageRectZoomFactor = function getImageRectZoomFactor(\n    imageRect,\n    cropRect,\n    rotation,\n    center\n  ) {\n    // calculate available space round image center position\n    var cx = center.x > 0.5 ? 1 - center.x : center.x;\n    var cy = center.y > 0.5 ? 1 - center.y : center.y;\n    var imageWidth = cx * 2 * imageRect.width;\n    var imageHeight = cy * 2 * imageRect.height;\n\n    // calculate rotated crop rectangle size\n    var rotatedCropSize = getRotatedRectSize(cropRect, rotation);\n\n    // calculate scalar required to fit image\n    return Math.max(\n      rotatedCropSize.width / imageWidth,\n      rotatedCropSize.height / imageHeight\n    );\n  };\n\n  var getCenteredCropRect = function getCenteredCropRect(\n    container,\n    aspectRatio\n  ) {\n    var width = container.width;\n    var height = width * aspectRatio;\n    if (height > container.height) {\n      height = container.height;\n      width = height / aspectRatio;\n    }\n    var x = (container.width - width) * 0.5;\n    var y = (container.height - height) * 0.5;\n\n    return {\n      x: x,\n      y: y,\n      width: width,\n      height: height\n    };\n  };\n\n  var getCurrentCropSize = function getCurrentCropSize(imageSize) {\n    var crop =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var zoom = crop.zoom,\n      rotation = crop.rotation,\n      center = crop.center,\n      aspectRatio = crop.aspectRatio;\n\n    if (!aspectRatio) aspectRatio = imageSize.height / imageSize.width;\n\n    var canvasSize = calculateCanvasSize(imageSize, aspectRatio, zoom);\n\n    var canvasCenter = {\n      x: canvasSize.width * 0.5,\n      y: canvasSize.height * 0.5\n    };\n\n    var stage = {\n      x: 0,\n      y: 0,\n      width: canvasSize.width,\n      height: canvasSize.height,\n      center: canvasCenter\n    };\n\n    var shouldLimit = typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;\n\n    var stageZoomFactor = getImageRectZoomFactor(\n      imageSize,\n      getCenteredCropRect(stage, aspectRatio),\n      rotation,\n      shouldLimit ? center : { x: 0.5, y: 0.5 }\n    );\n\n    var scale = zoom * stageZoomFactor;\n\n    // start drawing\n    return {\n      widthFloat: canvasSize.width / scale,\n      heightFloat: canvasSize.height / scale,\n      width: Math.round(canvasSize.width / scale),\n      height: Math.round(canvasSize.height / scale)\n    };\n  };\n\n  var IMAGE_SCALE_SPRING_PROPS = {\n    type: 'spring',\n    stiffness: 0.5,\n    damping: 0.45,\n    mass: 10\n  };\n\n  // does horizontal and vertical flipping\n  var createBitmapView = function createBitmapView(_) {\n    return _.utils.createView({\n      name: 'image-bitmap',\n      ignoreRect: true,\n      mixins: { styles: ['scaleX', 'scaleY'] },\n      create: function create(_ref) {\n        var root = _ref.root,\n          props = _ref.props;\n        root.appendChild(props.image);\n      }\n    });\n  };\n\n  // shifts and rotates image\n  var createImageCanvasWrapper = function createImageCanvasWrapper(_) {\n    return _.utils.createView({\n      name: 'image-canvas-wrapper',\n      tag: 'div',\n      ignoreRect: true,\n      mixins: {\n        apis: ['crop', 'width', 'height'],\n\n        styles: [\n          'originX',\n          'originY',\n          'translateX',\n          'translateY',\n          'scaleX',\n          'scaleY',\n          'rotateZ'\n        ],\n\n        animations: {\n          originX: IMAGE_SCALE_SPRING_PROPS,\n          originY: IMAGE_SCALE_SPRING_PROPS,\n          scaleX: IMAGE_SCALE_SPRING_PROPS,\n          scaleY: IMAGE_SCALE_SPRING_PROPS,\n          translateX: IMAGE_SCALE_SPRING_PROPS,\n          translateY: IMAGE_SCALE_SPRING_PROPS,\n          rotateZ: IMAGE_SCALE_SPRING_PROPS\n        }\n      },\n\n      create: function create(_ref2) {\n        var root = _ref2.root,\n          props = _ref2.props;\n        props.width = props.image.width;\n        props.height = props.image.height;\n        root.ref.bitmap = root.appendChildView(\n          root.createChildView(createBitmapView(_), { image: props.image })\n        );\n      },\n      write: function write(_ref3) {\n        var root = _ref3.root,\n          props = _ref3.props;\n        var flip = props.crop.flip;\n        var bitmap = root.ref.bitmap;\n        bitmap.scaleX = flip.horizontal ? -1 : 1;\n        bitmap.scaleY = flip.vertical ? -1 : 1;\n      }\n    });\n  };\n\n  // clips canvas to correct aspect ratio\n  var createClipView = function createClipView(_) {\n    return _.utils.createView({\n      name: 'image-clip',\n      tag: 'div',\n      ignoreRect: true,\n      mixins: {\n        apis: [\n          'crop',\n          'markup',\n          'resize',\n          'width',\n          'height',\n          'dirty',\n          'background'\n        ],\n\n        styles: ['width', 'height', 'opacity'],\n        animations: {\n          opacity: { type: 'tween', duration: 250 }\n        }\n      },\n\n      didWriteView: function didWriteView(_ref4) {\n        var root = _ref4.root,\n          props = _ref4.props;\n        if (!props.background) return;\n        root.element.style.backgroundColor = props.background;\n      },\n      create: function create(_ref5) {\n        var root = _ref5.root,\n          props = _ref5.props;\n\n        root.ref.image = root.appendChildView(\n          root.createChildView(\n            createImageCanvasWrapper(_),\n            Object.assign({}, props)\n          )\n        );\n\n        root.ref.createMarkup = function() {\n          if (root.ref.markup) return;\n          root.ref.markup = root.appendChildView(\n            root.createChildView(createMarkupView(_), Object.assign({}, props))\n          );\n        };\n\n        root.ref.destroyMarkup = function() {\n          if (!root.ref.markup) return;\n          root.removeChildView(root.ref.markup);\n          root.ref.markup = null;\n        };\n\n        // set up transparency grid\n        var transparencyIndicator = root.query(\n          'GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR'\n        );\n        if (transparencyIndicator === null) return;\n\n        // grid pattern\n        if (transparencyIndicator === 'grid') {\n          root.element.dataset.transparencyIndicator = transparencyIndicator;\n        }\n        // basic color\n        else {\n          root.element.dataset.transparencyIndicator = 'color';\n        }\n      },\n      write: function write(_ref6) {\n        var root = _ref6.root,\n          props = _ref6.props,\n          shouldOptimize = _ref6.shouldOptimize;\n        var crop = props.crop,\n          markup = props.markup,\n          resize = props.resize,\n          dirty = props.dirty,\n          width = props.width,\n          height = props.height;\n\n        root.ref.image.crop = crop;\n\n        var stage = {\n          x: 0,\n          y: 0,\n          width: width,\n          height: height,\n          center: {\n            x: width * 0.5,\n            y: height * 0.5\n          }\n        };\n\n        var image = {\n          width: root.ref.image.width,\n          height: root.ref.image.height\n        };\n\n        var origin = {\n          x: crop.center.x * image.width,\n          y: crop.center.y * image.height\n        };\n\n        var translation = {\n          x: stage.center.x - image.width * crop.center.x,\n          y: stage.center.y - image.height * crop.center.y\n        };\n\n        var rotation = Math.PI * 2 + (crop.rotation % (Math.PI * 2));\n\n        var cropAspectRatio = crop.aspectRatio || image.height / image.width;\n\n        var shouldLimit =\n          typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;\n\n        var stageZoomFactor = getImageRectZoomFactor(\n          image,\n          getCenteredCropRect(stage, cropAspectRatio),\n\n          rotation,\n          shouldLimit ? crop.center : { x: 0.5, y: 0.5 }\n        );\n\n        var scale = crop.zoom * stageZoomFactor;\n\n        // update markup view\n        if (markup && markup.length) {\n          root.ref.createMarkup();\n          root.ref.markup.width = width;\n          root.ref.markup.height = height;\n          root.ref.markup.resize = resize;\n          root.ref.markup.dirty = dirty;\n          root.ref.markup.markup = markup;\n          root.ref.markup.crop = getCurrentCropSize(image, crop);\n        } else if (root.ref.markup) {\n          root.ref.destroyMarkup();\n        }\n\n        // update image view\n        var imageView = root.ref.image;\n\n        // don't update clip layout\n        if (shouldOptimize) {\n          imageView.originX = null;\n          imageView.originY = null;\n          imageView.translateX = null;\n          imageView.translateY = null;\n          imageView.rotateZ = null;\n          imageView.scaleX = null;\n          imageView.scaleY = null;\n          return;\n        }\n\n        imageView.originX = origin.x;\n        imageView.originY = origin.y;\n        imageView.translateX = translation.x;\n        imageView.translateY = translation.y;\n        imageView.rotateZ = rotation;\n        imageView.scaleX = scale;\n        imageView.scaleY = scale;\n      }\n    });\n  };\n\n  var createImageView = function createImageView(_) {\n    return _.utils.createView({\n      name: 'image-preview',\n      tag: 'div',\n      ignoreRect: true,\n      mixins: {\n        apis: ['image', 'crop', 'markup', 'resize', 'dirty', 'background'],\n\n        styles: ['translateY', 'scaleX', 'scaleY', 'opacity'],\n\n        animations: {\n          scaleX: IMAGE_SCALE_SPRING_PROPS,\n          scaleY: IMAGE_SCALE_SPRING_PROPS,\n          translateY: IMAGE_SCALE_SPRING_PROPS,\n          opacity: { type: 'tween', duration: 400 }\n        }\n      },\n\n      create: function create(_ref7) {\n        var root = _ref7.root,\n          props = _ref7.props;\n        root.ref.clip = root.appendChildView(\n          root.createChildView(createClipView(_), {\n            id: props.id,\n            image: props.image,\n            crop: props.crop,\n            markup: props.markup,\n            resize: props.resize,\n            dirty: props.dirty,\n            background: props.background\n          })\n        );\n      },\n      write: function write(_ref8) {\n        var root = _ref8.root,\n          props = _ref8.props,\n          shouldOptimize = _ref8.shouldOptimize;\n        var clip = root.ref.clip;\n        var image = props.image,\n          crop = props.crop,\n          markup = props.markup,\n          resize = props.resize,\n          dirty = props.dirty;\n\n        clip.crop = crop;\n        clip.markup = markup;\n        clip.resize = resize;\n        clip.dirty = dirty;\n\n        // don't update clip layout\n        clip.opacity = shouldOptimize ? 0 : 1;\n\n        // don't re-render if optimizing or hidden (width will be zero resulting in weird animations)\n        if (shouldOptimize || root.rect.element.hidden) return;\n\n        // calculate scaled preview image size\n        var imageAspectRatio = image.height / image.width;\n        var aspectRatio = crop.aspectRatio || imageAspectRatio;\n\n        // calculate container size\n        var containerWidth = root.rect.inner.width;\n        var containerHeight = root.rect.inner.height;\n\n        var fixedPreviewHeight = root.query('GET_IMAGE_PREVIEW_HEIGHT');\n        var minPreviewHeight = root.query('GET_IMAGE_PREVIEW_MIN_HEIGHT');\n        var maxPreviewHeight = root.query('GET_IMAGE_PREVIEW_MAX_HEIGHT');\n\n        var panelAspectRatio = root.query('GET_PANEL_ASPECT_RATIO');\n        var allowMultiple = root.query('GET_ALLOW_MULTIPLE');\n\n        if (panelAspectRatio && !allowMultiple) {\n          fixedPreviewHeight = containerWidth * panelAspectRatio;\n          aspectRatio = panelAspectRatio;\n        }\n\n        // determine clip width and height\n        var clipHeight =\n          fixedPreviewHeight !== null\n            ? fixedPreviewHeight\n            : Math.max(\n                minPreviewHeight,\n                Math.min(containerWidth * aspectRatio, maxPreviewHeight)\n              );\n\n        var clipWidth = clipHeight / aspectRatio;\n        if (clipWidth > containerWidth) {\n          clipWidth = containerWidth;\n          clipHeight = clipWidth * aspectRatio;\n        }\n\n        if (clipHeight > containerHeight) {\n          clipHeight = containerHeight;\n          clipWidth = containerHeight / aspectRatio;\n        }\n\n        clip.width = clipWidth;\n        clip.height = clipHeight;\n      }\n    });\n  };\n\n  var SVG_MASK =\n    '<svg width=\"500\" height=\"200\" viewBox=\"0 0 500 200\" preserveAspectRatio=\"none\">\\n    <defs>\\n        <radialGradient id=\"gradient-__UID__\" cx=\".5\" cy=\"1.25\" r=\"1.15\">\\n            <stop offset=\\'50%\\' stop-color=\\'#000000\\'/>\\n            <stop offset=\\'56%\\' stop-color=\\'#0a0a0a\\'/>\\n            <stop offset=\\'63%\\' stop-color=\\'#262626\\'/>\\n            <stop offset=\\'69%\\' stop-color=\\'#4f4f4f\\'/>\\n            <stop offset=\\'75%\\' stop-color=\\'#808080\\'/>\\n            <stop offset=\\'81%\\' stop-color=\\'#b1b1b1\\'/>\\n            <stop offset=\\'88%\\' stop-color=\\'#dadada\\'/>\\n            <stop offset=\\'94%\\' stop-color=\\'#f6f6f6\\'/>\\n            <stop offset=\\'100%\\' stop-color=\\'#ffffff\\'/>\\n        </radialGradient>\\n        <mask id=\"mask-__UID__\">\\n            <rect x=\"0\" y=\"0\" width=\"500\" height=\"200\" fill=\"url(#gradient-__UID__)\"></rect>\\n        </mask>\\n    </defs>\\n    <rect x=\"0\" width=\"500\" height=\"200\" fill=\"currentColor\" mask=\"url(#mask-__UID__)\"></rect>\\n</svg>';\n\n  var SVGMaskUniqueId = 0;\n\n  var createImageOverlayView = function createImageOverlayView(fpAPI) {\n    return fpAPI.utils.createView({\n      name: 'image-preview-overlay',\n      tag: 'div',\n      ignoreRect: true,\n      create: function create(_ref) {\n        var root = _ref.root,\n          props = _ref.props;\n        var mask = SVG_MASK;\n        if (document.querySelector('base')) {\n          var url = window.location.href.replace(window.location.hash, '');\n          mask = mask.replace(/url\\(\\#/g, 'url(' + url + '#');\n        }\n\n        SVGMaskUniqueId++;\n        root.element.classList.add(\n          'filepond--image-preview-overlay-'.concat(props.status)\n        );\n\n        root.element.innerHTML = mask.replace(/__UID__/g, SVGMaskUniqueId);\n      },\n      mixins: {\n        styles: ['opacity'],\n        animations: {\n          opacity: { type: 'spring', mass: 25 }\n        }\n      }\n    });\n  };\n\n  /**\n   * Bitmap Worker\n   */\n  var BitmapWorker = function BitmapWorker() {\n    self.onmessage = function(e) {\n      createImageBitmap(e.data.message.file).then(function(bitmap) {\n        self.postMessage({ id: e.data.id, message: bitmap }, [bitmap]);\n      });\n    };\n  };\n\n  /**\n   * ColorMatrix Worker\n   */\n  var ColorMatrixWorker = function ColorMatrixWorker() {\n    self.onmessage = function(e) {\n      var imageData = e.data.message.imageData;\n      var matrix = e.data.message.colorMatrix;\n\n      var data = imageData.data;\n      var l = data.length;\n\n      var m11 = matrix[0];\n      var m12 = matrix[1];\n      var m13 = matrix[2];\n      var m14 = matrix[3];\n      var m15 = matrix[4];\n\n      var m21 = matrix[5];\n      var m22 = matrix[6];\n      var m23 = matrix[7];\n      var m24 = matrix[8];\n      var m25 = matrix[9];\n\n      var m31 = matrix[10];\n      var m32 = matrix[11];\n      var m33 = matrix[12];\n      var m34 = matrix[13];\n      var m35 = matrix[14];\n\n      var m41 = matrix[15];\n      var m42 = matrix[16];\n      var m43 = matrix[17];\n      var m44 = matrix[18];\n      var m45 = matrix[19];\n\n      var index = 0,\n        r = 0.0,\n        g = 0.0,\n        b = 0.0,\n        a = 0.0;\n\n      for (; index < l; index += 4) {\n        r = data[index] / 255;\n        g = data[index + 1] / 255;\n        b = data[index + 2] / 255;\n        a = data[index + 3] / 255;\n        data[index] = Math.max(\n          0,\n          Math.min((r * m11 + g * m12 + b * m13 + a * m14 + m15) * 255, 255)\n        );\n        data[index + 1] = Math.max(\n          0,\n          Math.min((r * m21 + g * m22 + b * m23 + a * m24 + m25) * 255, 255)\n        );\n        data[index + 2] = Math.max(\n          0,\n          Math.min((r * m31 + g * m32 + b * m33 + a * m34 + m35) * 255, 255)\n        );\n        data[index + 3] = Math.max(\n          0,\n          Math.min((r * m41 + g * m42 + b * m43 + a * m44 + m45) * 255, 255)\n        );\n      }\n\n      self.postMessage({ id: e.data.id, message: imageData }, [\n        imageData.data.buffer\n      ]);\n    };\n  };\n\n  var getImageSize = function getImageSize(url, cb) {\n    var image = new Image();\n    image.onload = function() {\n      var width = image.naturalWidth;\n      var height = image.naturalHeight;\n      image = null;\n      cb(width, height);\n    };\n    image.src = url;\n  };\n\n  var transforms = {\n    1: function _() {\n      return [1, 0, 0, 1, 0, 0];\n    },\n    2: function _(width) {\n      return [-1, 0, 0, 1, width, 0];\n    },\n    3: function _(width, height) {\n      return [-1, 0, 0, -1, width, height];\n    },\n    4: function _(width, height) {\n      return [1, 0, 0, -1, 0, height];\n    },\n    5: function _() {\n      return [0, 1, 1, 0, 0, 0];\n    },\n    6: function _(width, height) {\n      return [0, 1, -1, 0, height, 0];\n    },\n    7: function _(width, height) {\n      return [0, -1, -1, 0, height, width];\n    },\n    8: function _(width) {\n      return [0, -1, 1, 0, 0, width];\n    }\n  };\n\n  var fixImageOrientation = function fixImageOrientation(\n    ctx,\n    width,\n    height,\n    orientation\n  ) {\n    // no orientation supplied\n    if (orientation === -1) {\n      return;\n    }\n\n    ctx.transform.apply(ctx, transforms[orientation](width, height));\n  };\n\n  // draws the preview image to canvas\n  var createPreviewImage = function createPreviewImage(\n    data,\n    width,\n    height,\n    orientation\n  ) {\n    // can't draw on half pixels\n    width = Math.round(width);\n    height = Math.round(height);\n\n    // draw image\n    var canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    var ctx = canvas.getContext('2d');\n\n    // if is rotated incorrectly swap width and height\n    if (orientation >= 5 && orientation <= 8) {\n      var _ref = [height, width];\n      width = _ref[0];\n      height = _ref[1];\n    }\n\n    // correct image orientation\n    fixImageOrientation(ctx, width, height, orientation);\n\n    // draw the image\n    ctx.drawImage(data, 0, 0, width, height);\n\n    return canvas;\n  };\n\n  var isBitmap = function isBitmap(file) {\n    return /^image/.test(file.type) && !/svg/.test(file.type);\n  };\n\n  var MAX_WIDTH = 10;\n  var MAX_HEIGHT = 10;\n\n  var calculateAverageColor = function calculateAverageColor(image) {\n    var scalar = Math.min(MAX_WIDTH / image.width, MAX_HEIGHT / image.height);\n\n    var canvas = document.createElement('canvas');\n    var ctx = canvas.getContext('2d');\n    var width = (canvas.width = Math.ceil(image.width * scalar));\n    var height = (canvas.height = Math.ceil(image.height * scalar));\n    ctx.drawImage(image, 0, 0, width, height);\n    var data = null;\n    try {\n      data = ctx.getImageData(0, 0, width, height).data;\n    } catch (e) {\n      return null;\n    }\n    var l = data.length;\n\n    var r = 0;\n    var g = 0;\n    var b = 0;\n    var i = 0;\n\n    for (; i < l; i += 4) {\n      r += data[i] * data[i];\n      g += data[i + 1] * data[i + 1];\n      b += data[i + 2] * data[i + 2];\n    }\n\n    r = averageColor(r, l);\n    g = averageColor(g, l);\n    b = averageColor(b, l);\n\n    return { r: r, g: g, b: b };\n  };\n\n  var averageColor = function averageColor(c, l) {\n    return Math.floor(Math.sqrt(c / (l / 4)));\n  };\n\n  var cloneCanvas = function cloneCanvas(origin, target) {\n    target = target || document.createElement('canvas');\n    target.width = origin.width;\n    target.height = origin.height;\n    var ctx = target.getContext('2d');\n    ctx.drawImage(origin, 0, 0);\n    return target;\n  };\n\n  var cloneImageData = function cloneImageData(imageData) {\n    var id;\n    try {\n      id = new ImageData(imageData.width, imageData.height);\n    } catch (e) {\n      var canvas = document.createElement('canvas');\n      var ctx = canvas.getContext('2d');\n      id = ctx.createImageData(imageData.width, imageData.height);\n    }\n    id.data.set(new Uint8ClampedArray(imageData.data));\n    return id;\n  };\n\n  var loadImage = function loadImage(url) {\n    return new Promise(function(resolve, reject) {\n      var img = new Image();\n      img.crossOrigin = 'Anonymous';\n      img.onload = function() {\n        resolve(img);\n      };\n      img.onerror = function(e) {\n        reject(e);\n      };\n      img.src = url;\n    });\n  };\n\n  var createImageWrapperView = function createImageWrapperView(_) {\n    // create overlay view\n    var OverlayView = createImageOverlayView(_);\n\n    var ImageView = createImageView(_);\n    var createWorker = _.utils.createWorker;\n\n    var applyFilter = function applyFilter(root, filter, target) {\n      return new Promise(function(resolve) {\n        // will store image data for future filter updates\n        if (!root.ref.imageData) {\n          root.ref.imageData = target\n            .getContext('2d')\n            .getImageData(0, 0, target.width, target.height);\n        }\n\n        // get image data reference\n        var imageData = cloneImageData(root.ref.imageData);\n\n        if (!filter || filter.length !== 20) {\n          target.getContext('2d').putImageData(imageData, 0, 0);\n          return resolve();\n        }\n\n        var worker = createWorker(ColorMatrixWorker);\n        worker.post(\n          {\n            imageData: imageData,\n            colorMatrix: filter\n          },\n\n          function(response) {\n            // apply filtered colors\n            target.getContext('2d').putImageData(response, 0, 0);\n\n            // stop worker\n            worker.terminate();\n\n            // done!\n            resolve();\n          },\n          [imageData.data.buffer]\n        );\n      });\n    };\n\n    var removeImageView = function removeImageView(root, imageView) {\n      root.removeChildView(imageView);\n      imageView.image.width = 1;\n      imageView.image.height = 1;\n      imageView._destroy();\n    };\n\n    // remove an image\n    var shiftImage = function shiftImage(_ref) {\n      var root = _ref.root;\n      var imageView = root.ref.images.shift();\n      imageView.opacity = 0;\n      imageView.translateY = -15;\n      root.ref.imageViewBin.push(imageView);\n      return imageView;\n    };\n\n    // add new image\n    var pushImage = function pushImage(_ref2) {\n      var root = _ref2.root,\n        props = _ref2.props,\n        image = _ref2.image;\n      var id = props.id;\n      var item = root.query('GET_ITEM', { id: id });\n      if (!item) return;\n\n      var crop = item.getMetadata('crop') || {\n        center: {\n          x: 0.5,\n          y: 0.5\n        },\n\n        flip: {\n          horizontal: false,\n          vertical: false\n        },\n\n        zoom: 1,\n        rotation: 0,\n        aspectRatio: null\n      };\n\n      var background = root.query(\n        'GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR'\n      );\n\n      var markup;\n      var resize;\n      var dirty = false;\n      if (root.query('GET_IMAGE_PREVIEW_MARKUP_SHOW')) {\n        markup = item.getMetadata('markup') || [];\n        resize = item.getMetadata('resize');\n        dirty = true;\n      }\n\n      // append image presenter\n      var imageView = root.appendChildView(\n        root.createChildView(ImageView, {\n          id: id,\n          image: image,\n          crop: crop,\n          resize: resize,\n          markup: markup,\n          dirty: dirty,\n          background: background,\n          opacity: 0,\n          scaleX: 1.15,\n          scaleY: 1.15,\n          translateY: 15\n        }),\n\n        root.childViews.length\n      );\n\n      root.ref.images.push(imageView);\n\n      // reveal the preview image\n      imageView.opacity = 1;\n      imageView.scaleX = 1;\n      imageView.scaleY = 1;\n      imageView.translateY = 0;\n\n      // the preview is now ready to be drawn\n      setTimeout(function() {\n        root.dispatch('DID_IMAGE_PREVIEW_SHOW', { id: id });\n      }, 250);\n    };\n\n    var updateImage = function updateImage(_ref3) {\n      var root = _ref3.root,\n        props = _ref3.props;\n      var item = root.query('GET_ITEM', { id: props.id });\n      if (!item) return;\n      var imageView = root.ref.images[root.ref.images.length - 1];\n      imageView.crop = item.getMetadata('crop');\n      imageView.background = root.query(\n        'GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR'\n      );\n\n      if (root.query('GET_IMAGE_PREVIEW_MARKUP_SHOW')) {\n        imageView.dirty = true;\n        imageView.resize = item.getMetadata('resize');\n        imageView.markup = item.getMetadata('markup');\n      }\n    };\n\n    // replace image preview\n    var didUpdateItemMetadata = function didUpdateItemMetadata(_ref4) {\n      var root = _ref4.root,\n        props = _ref4.props,\n        action = _ref4.action;\n      // only filter and crop trigger redraw\n      if (!/crop|filter|markup|resize/.test(action.change.key)) return;\n\n      // no images to update, exit\n      if (!root.ref.images.length) return;\n\n      // no item found, exit\n      var item = root.query('GET_ITEM', { id: props.id });\n      if (!item) return;\n\n      // for now, update existing image when filtering\n      if (/filter/.test(action.change.key)) {\n        var imageView = root.ref.images[root.ref.images.length - 1];\n        applyFilter(root, action.change.value, imageView.image);\n        return;\n      }\n\n      if (/crop|markup|resize/.test(action.change.key)) {\n        var crop = item.getMetadata('crop');\n        var image = root.ref.images[root.ref.images.length - 1];\n\n        // if aspect ratio has changed, we need to create a new image\n        if (\n          crop &&\n          crop.aspectRatio &&\n          image.crop &&\n          image.crop.aspectRatio &&\n          Math.abs(crop.aspectRatio - image.crop.aspectRatio) > 0.00001\n        ) {\n          var _imageView = shiftImage({ root: root });\n          pushImage({\n            root: root,\n            props: props,\n            image: cloneCanvas(_imageView.image)\n          });\n        }\n        // if not, we can update the current image\n        else {\n          updateImage({ root: root, props: props });\n        }\n      }\n    };\n\n    var canCreateImageBitmap = function canCreateImageBitmap(file) {\n      // Firefox versions before 58 will freeze when running createImageBitmap\n      // in a Web Worker so we detect those versions and return false for support\n      var userAgent = window.navigator.userAgent;\n      var isFirefox = userAgent.match(/Firefox\\/([0-9]+)\\./);\n      var firefoxVersion = isFirefox ? parseInt(isFirefox[1]) : null;\n      if (firefoxVersion <= 58) return false;\n\n      return 'createImageBitmap' in window && isBitmap(file);\n    };\n\n    /**\n     * Write handler for when preview container has been created\n     */\n    var didCreatePreviewContainer = function didCreatePreviewContainer(_ref5) {\n      var root = _ref5.root,\n        props = _ref5.props;\n      var id = props.id;\n\n      // we need to get the file data to determine the eventual image size\n      var item = root.query('GET_ITEM', id);\n      if (!item) return;\n\n      // get url to file (we'll revoke it later on when done)\n      var fileURL = URL.createObjectURL(item.file);\n\n      // determine image size of this item\n      getImageSize(fileURL, function(width, height) {\n        // we can now scale the panel to the final size\n        root.dispatch('DID_IMAGE_PREVIEW_CALCULATE_SIZE', {\n          id: id,\n          width: width,\n          height: height\n        });\n      });\n    };\n\n    var drawPreview = function drawPreview(_ref6) {\n      var root = _ref6.root,\n        props = _ref6.props;\n      var id = props.id;\n\n      // we need to get the file data to determine the eventual image size\n      var item = root.query('GET_ITEM', id);\n      if (!item) return;\n\n      // get url to file (we'll revoke it later on when done)\n      var fileURL = URL.createObjectURL(item.file);\n\n      // fallback\n      var loadPreviewFallback = function loadPreviewFallback() {\n        // let's scale the image in the main thread :(\n        loadImage(fileURL).then(previewImageLoaded);\n      };\n\n      // image is now ready\n      var previewImageLoaded = function previewImageLoaded(imageData) {\n        // the file url is no longer needed\n        URL.revokeObjectURL(fileURL);\n\n        // draw the scaled down version here and use that as source so bitmapdata can be closed\n        // orientation info\n        var exif = item.getMetadata('exif') || {};\n        var orientation = exif.orientation || -1;\n\n        // get width and height from action, and swap if orientation is incorrect\n        var width = imageData.width,\n          height = imageData.height;\n\n        // if no width or height, just return early.\n        if (!width || !height) return;\n\n        if (orientation >= 5 && orientation <= 8) {\n          var _ref7 = [height, width];\n          width = _ref7[0];\n          height = _ref7[1];\n        }\n\n        // scale canvas based on pixel density\n        // we multiply by .75 as that creates smaller but still clear images on screens with high res displays\n        var pixelDensityFactor = Math.max(1, window.devicePixelRatio * 0.75);\n\n        // we want as much pixels to work with as possible,\n        // this multiplies the minimum image resolution,\n        // so when zooming in it doesn't get too blurry\n        var zoomFactor = root.query('GET_IMAGE_PREVIEW_ZOOM_FACTOR');\n\n        // imaeg scale factor\n        var scaleFactor = zoomFactor * pixelDensityFactor;\n\n        // calculate scaled preview image size\n        var previewImageRatio = height / width;\n\n        // calculate image preview height and width\n        var previewContainerWidth = root.rect.element.width;\n        var previewContainerHeight = root.rect.element.height;\n\n        var imageWidth = previewContainerWidth;\n        var imageHeight = imageWidth * previewImageRatio;\n\n        if (previewImageRatio > 1) {\n          imageWidth = Math.min(width, previewContainerWidth * scaleFactor);\n          imageHeight = imageWidth * previewImageRatio;\n        } else {\n          imageHeight = Math.min(height, previewContainerHeight * scaleFactor);\n          imageWidth = imageHeight / previewImageRatio;\n        }\n\n        // transfer to image tag so no canvas memory wasted on iOS\n        var previewImage = createPreviewImage(\n          imageData,\n          imageWidth,\n          imageHeight,\n          orientation\n        );\n\n        // done\n        var done = function done() {\n          // calculate average image color, disabled for now\n          var averageColor = root.query(\n            'GET_IMAGE_PREVIEW_CALCULATE_AVERAGE_IMAGE_COLOR'\n          )\n            ? calculateAverageColor(data)\n            : null;\n          item.setMetadata('color', averageColor, true);\n\n          // data has been transferred to canvas ( if was ImageBitmap )\n          if ('close' in imageData) {\n            imageData.close();\n          }\n\n          // show the overlay\n          root.ref.overlayShadow.opacity = 1;\n\n          // create the first image\n          pushImage({ root: root, props: props, image: previewImage });\n        };\n\n        // apply filter\n        var filter = item.getMetadata('filter');\n        if (filter) {\n          applyFilter(root, filter, previewImage).then(done);\n        } else {\n          done();\n        }\n      };\n\n      // if we support scaling using createImageBitmap we use a worker\n      if (canCreateImageBitmap(item.file)) {\n        // let's scale the image in a worker\n        var worker = createWorker(BitmapWorker);\n\n        worker.post(\n          {\n            file: item.file\n          },\n\n          function(imageBitmap) {\n            // destroy worker\n            worker.terminate();\n\n            // no bitmap returned, must be something wrong,\n            // try the oldschool way\n            if (!imageBitmap) {\n              loadPreviewFallback();\n              return;\n            }\n\n            // yay we got our bitmap, let's continue showing the preview\n            previewImageLoaded(imageBitmap);\n          }\n        );\n      } else {\n        // create fallback preview\n        loadPreviewFallback();\n      }\n    };\n\n    /**\n     * Write handler for when the preview image is ready to be animated\n     */\n    var didDrawPreview = function didDrawPreview(_ref8) {\n      var root = _ref8.root;\n      // get last added image\n      var image = root.ref.images[root.ref.images.length - 1];\n      image.translateY = 0;\n      image.scaleX = 1.0;\n      image.scaleY = 1.0;\n      image.opacity = 1;\n    };\n\n    /**\n     * Write handler for when the preview has been loaded\n     */\n    var restoreOverlay = function restoreOverlay(_ref9) {\n      var root = _ref9.root;\n      root.ref.overlayShadow.opacity = 1;\n      root.ref.overlayError.opacity = 0;\n      root.ref.overlaySuccess.opacity = 0;\n    };\n\n    var didThrowError = function didThrowError(_ref10) {\n      var root = _ref10.root;\n      root.ref.overlayShadow.opacity = 0.25;\n      root.ref.overlayError.opacity = 1;\n    };\n\n    var didCompleteProcessing = function didCompleteProcessing(_ref11) {\n      var root = _ref11.root;\n      root.ref.overlayShadow.opacity = 0.25;\n      root.ref.overlaySuccess.opacity = 1;\n    };\n\n    /**\n     * Constructor\n     */\n    var create = function create(_ref12) {\n      var root = _ref12.root;\n      // image view\n      root.ref.images = [];\n\n      // the preview image data (we need this to filter the image)\n      root.ref.imageData = null;\n\n      // image bin\n      root.ref.imageViewBin = [];\n\n      // image overlays\n      root.ref.overlayShadow = root.appendChildView(\n        root.createChildView(OverlayView, {\n          opacity: 0,\n          status: 'idle'\n        })\n      );\n\n      root.ref.overlaySuccess = root.appendChildView(\n        root.createChildView(OverlayView, {\n          opacity: 0,\n          status: 'success'\n        })\n      );\n\n      root.ref.overlayError = root.appendChildView(\n        root.createChildView(OverlayView, {\n          opacity: 0,\n          status: 'failure'\n        })\n      );\n    };\n\n    return _.utils.createView({\n      name: 'image-preview-wrapper',\n      create: create,\n      styles: ['height'],\n      apis: ['height'],\n      destroy: function destroy(_ref13) {\n        var root = _ref13.root;\n        // we resize the image so memory on iOS 12 is released more quickly (it seems)\n        root.ref.images.forEach(function(imageView) {\n          imageView.image.width = 1;\n          imageView.image.height = 1;\n        });\n      },\n      didWriteView: function didWriteView(_ref14) {\n        var root = _ref14.root;\n        root.ref.images.forEach(function(imageView) {\n          imageView.dirty = false;\n        });\n      },\n      write: _.utils.createRoute(\n        {\n          // image preview stated\n          DID_IMAGE_PREVIEW_DRAW: didDrawPreview,\n          DID_IMAGE_PREVIEW_CONTAINER_CREATE: didCreatePreviewContainer,\n          DID_FINISH_CALCULATE_PREVIEWSIZE: drawPreview,\n          DID_UPDATE_ITEM_METADATA: didUpdateItemMetadata,\n\n          // file states\n          DID_THROW_ITEM_LOAD_ERROR: didThrowError,\n          DID_THROW_ITEM_PROCESSING_ERROR: didThrowError,\n          DID_THROW_ITEM_INVALID: didThrowError,\n          DID_COMPLETE_ITEM_PROCESSING: didCompleteProcessing,\n          DID_START_ITEM_PROCESSING: restoreOverlay,\n          DID_REVERT_ITEM_PROCESSING: restoreOverlay\n        },\n\n        function(_ref15) {\n          var root = _ref15.root;\n          // views on death row\n          var viewsToRemove = root.ref.imageViewBin.filter(function(imageView) {\n            return imageView.opacity === 0;\n          });\n\n          // views to retain\n          root.ref.imageViewBin = root.ref.imageViewBin.filter(function(\n            imageView\n          ) {\n            return imageView.opacity > 0;\n          });\n\n          // remove these views\n          viewsToRemove.forEach(function(imageView) {\n            return removeImageView(root, imageView);\n          });\n          viewsToRemove.length = 0;\n        }\n      )\n    });\n  };\n\n  /**\n   * Image Preview Plugin\n   */\n  var plugin = function plugin(fpAPI) {\n    var addFilter = fpAPI.addFilter,\n      utils = fpAPI.utils;\n    var Type = utils.Type,\n      createRoute = utils.createRoute,\n      isFile = utils.isFile;\n\n    // imagePreviewView\n    var imagePreviewView = createImageWrapperView(fpAPI);\n\n    // called for each view that is created right after the 'create' method\n    addFilter('CREATE_VIEW', function(viewAPI) {\n      // get reference to created view\n      var is = viewAPI.is,\n        view = viewAPI.view,\n        query = viewAPI.query;\n\n      // only hook up to item view and only if is enabled for this cropper\n      if (!is('file') || !query('GET_ALLOW_IMAGE_PREVIEW')) return;\n\n      // create the image preview plugin, but only do so if the item is an image\n      var didLoadItem = function didLoadItem(_ref) {\n        var root = _ref.root,\n          props = _ref.props;\n        var id = props.id;\n        var item = query('GET_ITEM', id);\n\n        // item could theoretically have been removed in the mean time\n        if (!item || !isFile(item.file) || item.archived) return;\n\n        // get the file object\n        var file = item.file;\n\n        // exit if this is not an image\n        if (!isPreviewableImage(file)) return;\n\n        // test if is filtered\n        if (!query('GET_IMAGE_PREVIEW_FILTER_ITEM')(item)) return;\n\n        // exit if image size is too high and no createImageBitmap support\n        // this would simply bring the browser to its knees and that is not what we want\n        var supportsCreateImageBitmap = 'createImageBitmap' in (window || {});\n        var maxPreviewFileSize = query('GET_IMAGE_PREVIEW_MAX_FILE_SIZE');\n        if (\n          !supportsCreateImageBitmap &&\n          maxPreviewFileSize &&\n          file.size > maxPreviewFileSize\n        )\n          return;\n\n        // set preview view\n        root.ref.imagePreview = view.appendChildView(\n          view.createChildView(imagePreviewView, { id: id })\n        );\n\n        // update height if is fixed\n        var fixedPreviewHeight = root.query('GET_IMAGE_PREVIEW_HEIGHT');\n        if (fixedPreviewHeight) {\n          root.dispatch('DID_UPDATE_PANEL_HEIGHT', {\n            id: item.id,\n            height: fixedPreviewHeight\n          });\n        }\n\n        // now ready\n        var queue =\n          !supportsCreateImageBitmap &&\n          file.size > query('GET_IMAGE_PREVIEW_MAX_INSTANT_PREVIEW_FILE_SIZE');\n        root.dispatch('DID_IMAGE_PREVIEW_CONTAINER_CREATE', { id: id }, queue);\n      };\n\n      var rescaleItem = function rescaleItem(root, props) {\n        if (!root.ref.imagePreview) return;\n        var id = props.id;\n\n        // get item\n        var item = root.query('GET_ITEM', { id: id });\n        if (!item) return;\n\n        // if is fixed height or panel has aspect ratio, exit here, height has already been defined\n        var panelAspectRatio = root.query('GET_PANEL_ASPECT_RATIO');\n        var itemPanelAspectRatio = root.query('GET_ITEM_PANEL_ASPECT_RATIO');\n        var fixedHeight = root.query('GET_IMAGE_PREVIEW_HEIGHT');\n        if (panelAspectRatio || itemPanelAspectRatio || fixedHeight) return;\n\n        // no data!\n        var _root$ref = root.ref,\n          imageWidth = _root$ref.imageWidth,\n          imageHeight = _root$ref.imageHeight;\n        if (!imageWidth || !imageHeight) return;\n\n        // get height min and max\n        var minPreviewHeight = root.query('GET_IMAGE_PREVIEW_MIN_HEIGHT');\n        var maxPreviewHeight = root.query('GET_IMAGE_PREVIEW_MAX_HEIGHT');\n\n        // orientation info\n        var exif = item.getMetadata('exif') || {};\n        var orientation = exif.orientation || -1;\n\n        // get width and height from action, and swap of orientation is incorrect\n        if (orientation >= 5 && orientation <= 8) {\n          var _ref2 = [imageHeight, imageWidth];\n          imageWidth = _ref2[0];\n          imageHeight = _ref2[1];\n        }\n\n        // scale up width and height when we're dealing with an SVG\n        if (!isBitmap(item.file) || root.query('GET_IMAGE_PREVIEW_UPSCALE')) {\n          var scalar = 2048 / imageWidth;\n          imageWidth *= scalar;\n          imageHeight *= scalar;\n        }\n\n        // image aspect ratio\n        var imageAspectRatio = imageHeight / imageWidth;\n\n        // we need the item to get to the crop size\n        var previewAspectRatio =\n          (item.getMetadata('crop') || {}).aspectRatio || imageAspectRatio;\n\n        // preview height range\n        var previewHeightMax = Math.max(\n          minPreviewHeight,\n          Math.min(imageHeight, maxPreviewHeight)\n        );\n\n        var itemWidth = root.rect.element.width;\n        var previewHeight = Math.min(\n          itemWidth * previewAspectRatio,\n          previewHeightMax\n        );\n\n        // request update to panel height\n        root.dispatch('DID_UPDATE_PANEL_HEIGHT', {\n          id: item.id,\n          height: previewHeight\n        });\n      };\n\n      var didResizeView = function didResizeView(_ref3) {\n        var root = _ref3.root;\n        // actions in next write operation\n        root.ref.shouldRescale = true;\n      };\n\n      var didUpdateItemMetadata = function didUpdateItemMetadata(_ref4) {\n        var root = _ref4.root,\n          action = _ref4.action;\n        if (action.change.key !== 'crop') return;\n\n        // actions in next write operation\n        root.ref.shouldRescale = true;\n      };\n\n      var didCalculatePreviewSize = function didCalculatePreviewSize(_ref5) {\n        var root = _ref5.root,\n          action = _ref5.action;\n        // remember dimensions\n        root.ref.imageWidth = action.width;\n        root.ref.imageHeight = action.height;\n\n        // actions in next write operation\n        root.ref.shouldRescale = true;\n        root.ref.shouldDrawPreview = true;\n\n        // as image load could take a while and fire when draw loop is resting we need to give it a kick\n        root.dispatch('KICK');\n      };\n\n      // start writing\n      view.registerWriter(\n        createRoute(\n          {\n            DID_RESIZE_ROOT: didResizeView,\n            DID_STOP_RESIZE: didResizeView,\n            DID_LOAD_ITEM: didLoadItem,\n            DID_IMAGE_PREVIEW_CALCULATE_SIZE: didCalculatePreviewSize,\n            DID_UPDATE_ITEM_METADATA: didUpdateItemMetadata\n          },\n\n          function(_ref6) {\n            var root = _ref6.root,\n              props = _ref6.props;\n            // no preview view attached\n            if (!root.ref.imagePreview) return;\n\n            // don't do anything while hidden\n            if (root.rect.element.hidden) return;\n\n            // resize the item panel\n            if (root.ref.shouldRescale) {\n              rescaleItem(root, props);\n              root.ref.shouldRescale = false;\n            }\n\n            if (root.ref.shouldDrawPreview) {\n              // queue till next frame so we're sure the height has been applied this forces the draw image call inside the wrapper view to use the correct height\n              requestAnimationFrame(function() {\n                // this requestAnimationFrame nesting is horrible but it fixes an issue with 100hz displays on Chrome\n                // https://github.com/pqina/filepond-plugin-image-preview/issues/57\n                requestAnimationFrame(function() {\n                  root.dispatch('DID_FINISH_CALCULATE_PREVIEWSIZE', {\n                    id: props.id\n                  });\n                });\n              });\n\n              root.ref.shouldDrawPreview = false;\n            }\n          }\n        )\n      );\n    });\n\n    // expose plugin\n    return {\n      options: {\n        // Enable or disable image preview\n        allowImagePreview: [true, Type.BOOLEAN],\n\n        // filters file items to determine which are shown as preview\n        imagePreviewFilterItem: [\n          function() {\n            return true;\n          },\n          Type.FUNCTION\n        ],\n\n        // Fixed preview height\n        imagePreviewHeight: [null, Type.INT],\n\n        // Min image height\n        imagePreviewMinHeight: [44, Type.INT],\n\n        // Max image height\n        imagePreviewMaxHeight: [256, Type.INT],\n\n        // Max size of preview file for when createImageBitmap is not supported\n        imagePreviewMaxFileSize: [null, Type.INT],\n\n        // The amount of extra pixels added to the image preview to allow comfortable zooming\n        imagePreviewZoomFactor: [2, Type.INT],\n\n        // Should we upscale small images to fit the max bounding box of the preview area\n        imagePreviewUpscale: [false, Type.BOOLEAN],\n\n        // Max size of preview file that we allow to try to instant preview if createImageBitmap is not supported, else image is queued for loading\n        imagePreviewMaxInstantPreviewFileSize: [1000000, Type.INT],\n\n        // Style of the transparancy indicator used behind images\n        imagePreviewTransparencyIndicator: [null, Type.STRING],\n\n        // Enables or disables reading average image color\n        imagePreviewCalculateAverageImageColor: [false, Type.BOOLEAN],\n\n        // Enables or disables the previewing of markup\n        imagePreviewMarkupShow: [true, Type.BOOLEAN],\n\n        // Allows filtering of markup to only show certain shapes\n        imagePreviewMarkupFilter: [\n          function() {\n            return true;\n          },\n          Type.FUNCTION\n        ]\n      }\n    };\n  };\n\n  // fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags\n  var isBrowser =\n    typeof window !== 'undefined' && typeof window.document !== 'undefined';\n  if (isBrowser) {\n    document.dispatchEvent(\n      new CustomEvent('FilePond:pluginloaded', { detail: plugin })\n    );\n  }\n\n  return plugin;\n});\n"]},"metadata":{},"sourceType":"script"}